<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://img.mknight.cn/2018/1545104669394.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://img.mknight.cn/2018/1545104669394.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"econow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Medivh&#39;s castle">
<meta property="og:url" content="https://econow.cn/page/8/index.html">
<meta property="og:site_name" content="Medivh&#39;s castle">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="medivh">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://econow.cn/page/8/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/8/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Medivh's castle</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Medivh's castle</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">数据蜘蛛工作室</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">medivh</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">95</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">48</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/%E8%A7%86%E9%A2%91%E6%8A%80%E6%9C%AF%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%A7%86%E9%A2%91%E6%8A%80%E6%9C%AF%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3" class="post-title-link" itemprop="url">视频技术的简单理解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-26 10:28:13" itemprop="dateCreated datePublished" datetime="2022-09-26T10:28:13+08:00">2022-09-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-30 17:45:56" itemprop="dateModified" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前看到一些视频类APP可以播放VIP或者付费视频，当时很奇怪怎么做到的。只能确定一点，APP的作者肯定不是用的自己的服务器作为播放源。后来看到一些课程，才逐步明白了其中的一些道理。因此，记录一下这一历程。</p>
<h3 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h3><h4 id="问题一、为什么不能直接使用标签？"><a href="#问题一、为什么不能直接使用标签？" class="headerlink" title="问题一、为什么不能直接使用&lt;video src=&quot;xxx.mp4&quot;&gt;&lt;/video&gt;标签？"></a>问题一、为什么不能直接使用<code>&lt;video src=&quot;xxx.mp4&quot;&gt;&lt;/video&gt;</code>标签？</h4><p>大部分懂点HTML的都会认为要想在网页上播放视频，肯定会优先直接使用<code>video</code>标签。但是大部分视频网站会直接这么用吗？</p>
<p>答案是不会，一部电影2个G，要让用户直接下载完才可以观看吗？用户肯定会骂街。此处的视频播放指在线视频，主动下载或缓存的不在讨论范围内。这时候有些人会想到流媒体，这的确是一个方向。</p>
<h4 id="问题二、一般的视频网站是怎么来优化用户体验的？"><a href="#问题二、一般的视频网站是怎么来优化用户体验的？" class="headerlink" title="问题二、一般的视频网站是怎么来优化用户体验的？"></a>问题二、一般的视频网站是怎么来优化用户体验的？</h4><p>用户上传视频后会有以下流程进行处理：</p>
<ol>
<li>转码。将视频按照不同的分辨率处理，比如360P、720、1080P和2K等等，满足在不同网络环境下的加载速度</li>
<li>切片。比如把1小时的视频按分钟拆分为60份，用户在拖动进度条的时候可以快速加载，只需要加载三五个切片就可以了。快速加载，充分利用带宽，减少服务器压力。</li>
</ol>
<p>需要文件记录：</p>
<ol>
<li>视频播放顺序</li>
<li>视频存放路径</li>
</ol>
<blockquote>
<p>知识点： M3U文件。1. 文件是否有加密 2. 文件地址<br>视频播放顺序则是从上到下。</p>
</blockquote>
<p><img src="https://img.mknight.cn/medivh/1664160498186.png" alt="1664160498186.png"></p>
<p>M3U、text、json &#x3D;&gt; 文本</p>
<p>文件读写</p>
<h4 id="问题三、抓取视频的套路？"><a href="#问题三、抓取视频的套路？" class="headerlink" title="问题三、抓取视频的套路？"></a>问题三、抓取视频的套路？</h4><p>基本步骤；</p>
<ol>
<li>找到m3u8文件</li>
<li>通过m3u8下载ts文件</li>
<li>通过手段把ts文件合并为一个视频文件</li>
</ol>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><ol>
<li>拿到页面源代码</li>
<li>从源代码提前m3u8文件的URL</li>
<li>下载m3u8</li>
<li>读取m3u8文件，下载视频</li>
<li>合并视频</li>
</ol>
<h3 id="以91kanju-com为例"><a href="#以91kanju-com为例" class="headerlink" title="以91kanju.com为例"></a>以91kanju.com为例</h3><p>首先打开目标视频的URL，查看源代码，然后从源代码里找到带有<code>m3u8</code>的部分<br><img src="https://img.mknight.cn/medivh/1664177762869.png" alt="1664177762869.png"></p>
<p><img src="https://img.mknight.cn/medivh/1664177786615.png" alt="1664177786615.png"></p>
<p>下载m3u8文件，获取其中内容。<br><img src="https://img.mknight.cn/medivh/1664177844442.png" alt="1664177844442.png"></p>
<p>代码示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># obj = re.compile(r&quot;url: &#x27;(?P&lt;url&gt;.*?)&#x27;,&quot;,re.S)</span></span><br><span class="line"><span class="comment"># url = &#x27;https://www.91kanju.com/vod-play/54812-1-2.html&#x27;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># resp = requests.get(url=url,headers=headers).text</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># m3u8_url = obj.search(resp).group(&quot;url&quot;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># print(m3u8_url)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># #下载m3u8文件</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># resp2 = requests.get(url=m3u8_url,headers=headers)</span></span><br><span class="line"><span class="comment"># with open(&quot;哲仁王后.m3u8&quot;,mode=&#x27;wb&#x27;) as fp:</span></span><br><span class="line"><span class="comment">#     fp.write(resp2.content)</span></span><br><span class="line"><span class="comment">#本地缓存到m3u8文件后将上面注释掉</span></span><br><span class="line">n = <span class="number">1</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;哲仁王后.m3u8&quot;</span>,mode=<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> fp:</span><br><span class="line">        line = line.strip()</span><br><span class="line">        <span class="keyword">if</span> line.startswith(<span class="string">&quot;#&quot;</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> n&lt;<span class="number">10</span>:</span><br><span class="line"></span><br><span class="line">            temp = <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27;0&#x27;</span> + <span class="built_in">str</span>(n)</span><br><span class="line">        <span class="keyword">elif</span> <span class="number">10</span>&lt;=n&lt;<span class="number">100</span>:</span><br><span class="line">            temp = <span class="string">&#x27;0&#x27;</span> + <span class="built_in">str</span>(n)</span><br><span class="line">        resp3 = requests.get(url=line,headers=headers)</span><br><span class="line">        f = <span class="built_in">open</span>(<span class="string">f&quot;video/<span class="subst">&#123;temp&#125;</span>.ts&quot;</span>,mode=<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">        f.write(resp3.content)</span><br><span class="line">        f.close()</span><br><span class="line">        resp3.close()</span><br><span class="line">        n+=<span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(temp)</span><br></pre></td></tr></table></figure>

<p>最后一步合并视频的方式就各显神通吧。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>事实证明和最初预想的完全不一样。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/%E5%B0%86Python%E4%BD%9C%E4%B8%BA%E4%B8%80%E4%B8%AA%E4%BE%BF%E5%88%A9%E5%B7%A5%E5%85%B7%E7%9A%84%E5%BA%94%E7%94%A8%E2%80%94%E2%80%94%E6%8A%A2%E8%B4%AD">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%B0%86Python%E4%BD%9C%E4%B8%BA%E4%B8%80%E4%B8%AA%E4%BE%BF%E5%88%A9%E5%B7%A5%E5%85%B7%E7%9A%84%E5%BA%94%E7%94%A8%E2%80%94%E2%80%94%E6%8A%A2%E8%B4%AD" class="post-title-link" itemprop="url">将Python作为一个便利工具的应用——抢购</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-09 17:26:09" itemprop="dateCreated datePublished" datetime="2022-09-09T17:26:09+08:00">2022-09-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-30 17:45:56" itemprop="dateModified" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>近来无意中看到一些Python的应用场景——抢购。这的确是一个恰当的应用，因此本文从一个开源项目库来入手分析项目是如何运行的。</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p><img src="https://img.mknight.cn/medivh/1662716093305.png" alt="1662716093305.png"></p>
<h3 id="入口"><a href="#入口" class="headerlink" title="入口"></a>入口</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    a = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       oooo oooooooooo.            .oooooo..o                     oooo         o8o  oooo  oooo  </span></span><br><span class="line"><span class="string">       `888 `888&#x27;   `Y8b          d8P&#x27;    `Y8                     `888         `&quot;&#x27;  `888  `888  </span></span><br><span class="line"><span class="string">        888  888      888         Y88bo.       .ooooo.   .ooooo.   888  oooo  oooo   888   888  </span></span><br><span class="line"><span class="string">        888  888      888          `&quot;Y8888o.  d88&#x27; `88b d88&#x27; `&quot;Y8  888 .8P&#x27;   `888   888   888  </span></span><br><span class="line"><span class="string">        888  888      888 8888888      `&quot;Y88b 888ooo888 888        888888.     888   888   888  </span></span><br><span class="line"><span class="string">        888  888     d88&#x27;         oo     .d8P 888    .o 888   .o8  888 `88b.   888   888   888  </span></span><br><span class="line"><span class="string">    .o. 88P o888bood8P&#x27;           8&quot;&quot;88888P&#x27;  `Y8bod8P&#x27; `Y8bod8P&#x27; o888o o888o o888o o888o o888o </span></span><br><span class="line"><span class="string">    `Y888P                                                                                                                                                  </span></span><br><span class="line"><span class="string">                                               </span></span><br><span class="line"><span class="string">功能列表：                                                                                </span></span><br><span class="line"><span class="string"> 1.预约商品</span></span><br><span class="line"><span class="string"> 2.秒杀抢购商品</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line">    jd_seckill = JdSeckill()</span><br><span class="line">    choice_function = <span class="built_in">input</span>(<span class="string">&#x27;请选择:&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> choice_function == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        jd_seckill.reserve()</span><br><span class="line">    <span class="keyword">elif</span> choice_function == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">        jd_seckill.seckill_by_proc_pool()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;没有此功能&#x27;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这一段代码很简单：</p>
<ol>
<li>首先输出一段提示，让用户稍后选择预约还送抢购；</li>
<li>然后实例化<code>jd_seckill = JdSeckill()</code>;</li>
<li>根据输入选择功能</li>
</ol>
<h3 id="主功能（预约）"><a href="#主功能（预约）" class="headerlink" title="主功能（预约）"></a>主功能（预约）</h3><p>接下来先看一下预约功能，调用了<code>reserve()</code>，这段代码使用了装饰器，判断是否登录。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@check_login</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reserve</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    预约</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    self._reserve()</span><br><span class="line"></span><br><span class="line"><span class="meta">@check_login</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">seckill</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    抢购</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    self._seckill()</span><br><span class="line"></span><br><span class="line"><span class="meta">@check_login</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">seckill_by_proc_pool</span>(<span class="params">self, work_count=<span class="number">5</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    多进程进行抢购</span></span><br><span class="line"><span class="string">    work_count：进程数量</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> ProcessPoolExecutor(work_count) <span class="keyword">as</span> pool:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(work_count):</span><br><span class="line">            pool.submit(self.seckill)</span><br></pre></td></tr></table></figure>

<p>可以看到预约、抢购和多线程抢购这些功能都使用了装饰器。</p>
<h4 id="登录判断"><a href="#登录判断" class="headerlink" title="登录判断"></a>登录判断</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">check_login</span>(<span class="params">func</span>):</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">      用户登陆态校验装饰器。若用户未登陆，则调用扫码登陆</span></span><br><span class="line"><span class="string">      &quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">      @functools.wraps(<span class="params">func</span>)</span></span><br><span class="line">      <span class="keyword">def</span> <span class="title function_">new_func</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">          <span class="keyword">if</span> <span class="keyword">not</span> self.qrlogin.is_login:</span><br><span class="line">              logger.info(<span class="string">&quot;&#123;0&#125; 需登陆后调用，开始扫码登陆&quot;</span>.<span class="built_in">format</span>(func.__name__))</span><br><span class="line">              self.login_by_qrcode()</span><br><span class="line">          <span class="keyword">return</span> func(self, *args, **kwargs)</span><br><span class="line">      <span class="keyword">return</span> new_func</span><br></pre></td></tr></table></figure>

<p>这里记录一下<code>@functools.wraps(fun)</code>的作用，主要因为增加了装饰器的函数其实就变成了另外一个函数，<code>____name__</code>和<code>__doc__</code>都发生了变化。因此增加了<code>@functools.wraps(fun)</code>之后就可以防止此类情况的发生。</p>
<p>执行步骤：</p>
<p>首先判断<code>self.qrlogin.is_login</code>是否<code>True</code>，默认为<code>False</code>。<code>self.qrlogin = QrLogin(self.spider_session)</code>会调用<code>QrLogin -&gt; SpiderSession</code>.</p>
<p><code>QrLogin()</code>功能：</p>
<ol>
<li>初始化扫码目录<ol>
<li>定义二维码文件名称</li>
<li>设置session</li>
<li>设置默认登录状态为<code>False</code></li>
<li>刷新登录状态</li>
</ol>
</li>
<li>刷新是否登录的状态</li>
<li>验证cookie(是否登录)</li>
<li>获取登录页面</li>
<li>缓存并展示登录二维码</li>
<li>通过token获取ticket</li>
<li>校验ticket</li>
<li>使用二维码登录</li>
</ol>
<h4 id="session处理"><a href="#session处理" class="headerlink" title="session处理"></a>session处理</h4><p><code>SpiderSession()</code>这个类功能是为了处理session：</p>
<ol>
<li>初始化<ol>
<li>定义cookie目录</li>
<li>从配置文件获取<code>user-agent</code></li>
<li>初始化session。</li>
</ol>
</li>
<li>初始化session</li>
<li>获取并设置header</li>
<li>获取<code>user_agent</code></li>
<li>获取cookie</li>
<li>设置cookie</li>
<li>从本地加载cookie</li>
<li>保存cookie到本地</li>
</ol>
<p>session的处理这一段代码不太熟悉，之前没有接触过，下面分析一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_init_session</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="comment"># 实例化对象</span></span><br><span class="line">    session = requests.session()</span><br><span class="line">    <span class="comment"># 给 requests.session() 对象设置header信息</span></span><br><span class="line">    session.headers = self.get_headers()</span><br><span class="line">    <span class="keyword">return</span> session</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_headers</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;User-Agent&quot;</span>: self.user_agent,</span><br><span class="line">            <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;&quot;</span></span><br><span class="line">                      <span class="string">&quot;q=0.9,image/webp,image/apng,*/*;&quot;</span></span><br><span class="line">                      <span class="string">&quot;q=0.8,application/signed-exchange;&quot;</span></span><br><span class="line">                      <span class="string">&quot;v=b3&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;keep-alive&quot;</span>&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/Kubernetes%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Kubernetes%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" class="post-title-link" itemprop="url">Kubernetes的最佳实践</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-05 13:37:34" itemprop="dateCreated datePublished" datetime="2022-09-05T13:37:34+08:00">2022-09-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-30 17:45:56" itemprop="dateModified" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/" itemprop="url" rel="index"><span itemprop="name">云原生</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Kubernetes 作为最流行的容器编排系统已经成为大部分运维需要掌握的一项基本技能。而很好的掌握它应该做什么和不应该做什么，将是一个很好的开局。</p>
<h2 id="程序开发"><a href="#程序开发" class="headerlink" title="程序开发"></a>程序开发</h2><h3 id="使用命名空间"><a href="#使用命名空间" class="headerlink" title="使用命名空间"></a>使用命名空间</h3><p>使用不同的命名空间，以限制组的访问控制以及可能发生任何错误的爆炸半径。<br>还可以针对命名空间配置limitRange对象，以定义命名空间中容器的标准大小。ResourceQuotas可以限制命名空间内所有容器的总资源消耗。</p>
<h3 id="使用就绪和存活探针"><a href="#使用就绪和存活探针" class="headerlink" title="使用就绪和存活探针"></a>使用就绪和存活探针</h3><p>就绪和存活两种探针本质上都是健康检查的类型。<br>当就绪探针确保当pod准备好为请求提供服务时，才会将Pod的请求定向到它。<br>存活探针将应用程序是否正在允许将其作为是否健康的标志。</p>
<h3 id="使用自动伸缩"><a href="#使用自动伸缩" class="headerlink" title="使用自动伸缩"></a>使用自动伸缩</h3><p>在适当的情况下，可以使用自动伸缩来动态调整Pod的数量（Pod水平伸缩，HPA）、（Pod垂直伸缩，VPA）或集群的节点数量（集群自动伸缩，CA），具体取决于对资源的需求。</p>
<p>使用伸缩时也会带来一些挑战，比如持久化数据。</p>
<h3 id="使用资源请求和约束"><a href="#使用资源请求和约束" class="headerlink" title="使用资源请求和约束"></a>使用资源请求和约束</h3><p>设置资源请求和约束可以避免容器在未分配所需资源的情况下启动，或集群用尽可用资源。如没有限制，Pod可以使用比所需要的更多的资源，从而导致可用资源总量减少。</p>
<h3 id="使用deployment、DaemonSet、RelicaSet或SattefulSet跨节点部署Pod"><a href="#使用deployment、DaemonSet、RelicaSet或SattefulSet跨节点部署Pod" class="headerlink" title="使用deployment、DaemonSet、RelicaSet或SattefulSet跨节点部署Pod"></a>使用deployment、DaemonSet、RelicaSet或SattefulSet跨节点部署Pod</h3><p>永远不应该直接运行Pod。为了提高容错性，Pod应该始终作为Deployment、DaemonSet、ReplicaSet或SatefulSet的一部分。然后可以部署中使用反亲和性规则跨节点部署Pod，避免所有Pod调度到同一个节点上运行。</p>
<h2 id="集群治理"><a href="#集群治理" class="headerlink" title="集群治理"></a>集群治理</h2><h3 id="使用多节点"><a href="#使用多节点" class="headerlink" title="使用多节点"></a>使用多节点</h3><p>如果提升可靠性，在单个节点上运行k8s不是一个好主意。集群中应该使用多个节点，一遍可以在他们之间分散工作负载。</p>
<h3 id="使用RBAC"><a href="#使用RBAC" class="headerlink" title="使用RBAC"></a>使用RBAC</h3><p>RABC可以为用户、组合service account分配权限，以在特定命名空间或整个集群执行被运行的操作。<br>主意分配权限应仅授予所需的权限。</p>
<h3 id="使用云服务"><a href="#使用云服务" class="headerlink" title="使用云服务"></a>使用云服务</h3><p>将k8s托管在云上会更轻松。</p>
<h3 id="升级版本"><a href="#升级版本" class="headerlink" title="升级版本"></a>升级版本</h3><p>新版本会更安全些，还会引入新功能。</p>
<h3 id="监控集群资源和审计策略日志"><a href="#监控集群资源和审计策略日志" class="headerlink" title="监控集群资源和审计策略日志"></a>监控集群资源和审计策略日志</h3><p>针对APIServer的日志进行分析和监控。</p>
<h3 id="使用版本控制"><a href="#使用版本控制" class="headerlink" title="使用版本控制"></a>使用版本控制</h3><p>对编排文件进行版本控制，对更改进行审计跟踪，有助于提高集群的稳定性。</p>
<h3 id="使用精简镜像"><a href="#使用精简镜像" class="headerlink" title="使用精简镜像"></a>使用精简镜像</h3><p>较小的镜像有助于加速构建和部署速度，减少容器在集群上消耗的资源量。</p>
<h2 id="集群配置"><a href="#集群配置" class="headerlink" title="集群配置"></a>集群配置</h2><h3 id="用标签治理对象"><a href="#用标签治理对象" class="headerlink" title="用标签治理对象"></a>用标签治理对象</h3><p>在云环境中对资源使用标签，以跟踪与业务相关的事务。</p>
<h3 id="使用网络策略"><a href="#使用网络策略" class="headerlink" title="使用网络策略"></a>使用网络策略</h3><p>使用网络策略限制集群中对象之间的流量。</p>
<h3 id="使用防火墙"><a href="#使用防火墙" class="headerlink" title="使用防火墙"></a>使用防火墙</h3><p>限制外部对APIServer的请求。</p>
<h2 id="弹性伸缩"><a href="#弹性伸缩" class="headerlink" title="弹性伸缩"></a>弹性伸缩</h2><p>在kubernetes中，常见的“自动伸缩”有：</p>
<ul>
<li>HPA：Pod水平伸缩</li>
<li>VPA：Pod垂直伸缩</li>
<li>CA：集群自动伸缩</li>
</ul>
<p>不同类型的自动伸缩器，应用的场景不同。</p>
<blockquote>
<p>HPA，HPA 定期检查内存和CPU等指标，自动跳转Deployment中副本数量。<br>VPA，无法通过调整Pod数量来扩容是，可以通过VPA增加Pod资源的大小，比如调整CPU和内存。<br>CA。当集群资源不足时，CA会自动配置新的计算资源并添加到集群中。</p>
</blockquote>
<h3 id="HPA"><a href="#HPA" class="headerlink" title="HPA"></a>HPA</h3><p>HPA 可以基于CPU使用率来自动伸缩Pod的数量，还可以基于其他指标，比如：</p>
<ul>
<li>Resource metrics CPU、内存使用率</li>
<li>Pod metrics 网络利用率和流量</li>
<li>Object metrics 特定对象的指标，比如Ingress，可以按每秒使用请求数来扩展容器</li>
<li>Custom metrics 自定义监控，比如定义服务响应时间</li>
</ul>
<p>工作原理：<strong>定时检测每个Pod指标的平均值，并检测删除或添加副本，是否会使该值更接近目标</strong>。</p>
<h4 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h4><ul>
<li>为HPA提供每个pod的资源指标，metrics-server；</li>
<li>为每个容器配置指标阈值，HPA根据指标的阈值来做出伸缩的决策；</li>
<li>使用自定义指标，确保使用正确的目标类型</li>
</ul>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">hpa</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">200m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">100Mi</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">hpa</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建一个HPA用来控制上述步骤中的Deployment，是Pod副本数量维持在1~10。HPA通过改变Pod副本的数量以保持所有Pod的平均CPU使用率在50%以内。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">autoscaling/v2beta2</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">HorizontalPodAutoscaler</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">hpa</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scaleTargetRef:</span></span><br><span class="line">    <span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">minReplicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">maxReplicas:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Resource</span></span><br><span class="line">    <span class="attr">resource:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">cpu</span></span><br><span class="line">      <span class="attr">target:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">Utilization</span></span><br><span class="line">        <span class="attr">averageUtilization:</span> <span class="number">50</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="VPA"><a href="#VPA" class="headerlink" title="VPA"></a>VPA</h3><p>VPA，即使垂直Pod自动伸缩，是根据容器资源使用率自动设置CPU和内存的requests，从而允许在节点上进行适当的调度。既可以缩小过度请求资源的容器，也可以根据使用情况提升资源不足的容量。</p>
<p>组件：</p>
<ul>
<li>Recommender 监控资源利用率并计算目标值，并推荐一个理想的资源请求值</li>
<li>Updater 检查Pod资源限制是否需要更新</li>
<li>Admission Controller 在创建Pod时覆盖其资源请求</li>
</ul>
<h4 id="最佳实践-1"><a href="#最佳实践-1" class="headerlink" title="最佳实践"></a>最佳实践</h4><ol>
<li>避免在Kubernetes的1.11版本之前使用</li>
<li>使用updateMode:OFF运行VPA，以及了解要自动伸缩的Pod的资源使用情况，为以后调整做基础</li>
<li>如果工作负载经常出现高使用率和低使用率的峰值，则VPA过于激进，使用HPA效果会更好</li>
</ol>
<h4 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h4><p>注意使用VPA需要先部署 <a target="_blank" rel="noopener" href="https://github.com/kubernetes/autoscaler.git">autoscaler</a>。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">vpa</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">250Mi</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">vpa</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure>

<p>创建VPA：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">autoscaling.k8s.io/v1beta2</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VerticalPodAutoscaler</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-vpa</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">vpa</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">targetRef:</span></span><br><span class="line">    <span class="attr">apiVersion:</span> <span class="string">&quot;apps/v1&quot;</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">updatePolicy:</span></span><br><span class="line">    <span class="attr">updateMode:</span> <span class="string">&quot;Off&quot;</span></span><br><span class="line">  <span class="attr">resourcePolicy:</span></span><br><span class="line">    <span class="attr">containerPolicies:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerName:</span> <span class="string">&quot;nginx&quot;</span></span><br><span class="line">      <span class="attr">minAllowed:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;250m&quot;</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;100Mi&quot;</span></span><br><span class="line">      <span class="attr">maxAllowed:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;2000m&quot;</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;2048Mi&quot;</span></span><br></pre></td></tr></table></figure>

<p>注意<code>updateMode</code>设置为<code>Auto</code>的时候才会自动调整。使用限制：</p>
<ul>
<li>不能和HPA共存</li>
<li>Pod使用副本控制器，比如Deployment或StatefulSet</li>
</ul>
<p>优势：</p>
<ul>
<li>Pod资源用其所需，所以集群节点使用效率高</li>
<li>Pod会被安排到具有适当资源的节点上</li>
<li>不必运行基准测试任务来确定CPU和内存的请求和食指</li>
<li>VPA可以随时调整资源设置，无需手动操作</li>
</ul>
<h3 id="CA"><a href="#CA" class="headerlink" title="CA"></a>CA</h3><p>CA是基于Pod来扩展集群节点，会定期检查是否有不可调度的的的Pod，如需更多资源，并且扩展的集群仍然在用户提供的约束范围内，则会调整集群的大小。</p>
<p>影响的因素：</p>
<ol>
<li>HPA的响应耗时</li>
<li>CA的响应耗时</li>
<li>节点的初始化耗时</li>
<li>Pod创建耗时</li>
</ol>
<p>默认情况下，kubelet每10秒抓取一下Pod的CPU和内存使用情况；<br>每分钟，Metrices Server将聚合的指标开放给API Server及其他组件使用；<br>CA 每10秒排查不可调度的Pod。&lt;100个节点，每个节点最大30个Pod，平均延迟在5s。100到1000个节点时，平均延迟在15s左右；<br>节点的配置时间，通常在3~5分钟；<br>容器创建Pod，在几秒到1分钟不等。</p>
<p>因此对于小的集群，最差的情况可能在6分钟左右，大的集群则可能在7分钟以上。因此，压缩时间的方式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HPA 的刷新时间，默认 15 秒，通过 --horizontal-pod-autoscaler-sync-period 标志控制;</span><br><span class="line"></span><br><span class="line">Metrics Server 的指标抓取时间，默认 60 秒，通过 metric-resolution 控</span><br><span class="line"></span><br><span class="line">CA 的扫描间隔，默认 10 秒，通过 scan-interval 控制;</span><br><span class="line"></span><br><span class="line">节点上缓存镜像，比如 kube-fledged等工具;</span><br></pre></td></tr></table></figure>

<p>总之，尽量避免被动创建新节点，主动创建新节点。</p>
<h4 id="最佳实践-2"><a href="#最佳实践-2" class="headerlink" title="最佳实践"></a>最佳实践</h4><ol>
<li>选择和Kubernetes匹配的版本</li>
<li>检查集群节点是否有相同的CPU和内存，否则无法正常工作，因为它假设每个节点都有相同的资源</li>
<li>确保自动伸缩的Pod都有指定的资源请求</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90kubernetes%E7%AC%94%E8%AE%B0">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90kubernetes%E7%AC%94%E8%AE%B0" class="post-title-link" itemprop="url">深入剖析kubernetes笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-29 13:59:00" itemprop="dateCreated datePublished" datetime="2022-08-29T13:59:00+08:00">2022-08-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-30 17:45:56" itemprop="dateModified" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/" itemprop="url" rel="index"><span itemprop="name">云原生</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>编排永远是容器云项目的灵魂所在，也是kubernetes社区持久生命力的源泉。</p>
</blockquote>
<h2 id="服务类型"><a href="#服务类型" class="headerlink" title="服务类型"></a>服务类型</h2><blockquote>
<p>IaaS 基础设施服务，Infrastucture-as-a-service<br>PasS 平台服务，Platform-as-a-service<br>SaaS 软件服务，Software-as-a-service</p>
</blockquote>
<p><img src="https://img.mknight.cn/medivh/1645088256165.png" alt="1645088256165.png"></p>
<p><strong>SaaS</strong> 是软件的开发、管理和部署都交给第三方，不需要关心技术问题，拿来即用。普通用户接触到的互联网服务几乎都是SaaS，比如：微信、钉钉、百度云盘等。</p>
<p><strong>PaaS</strong> 提供软件部署平台，抽象掉了硬件和操作系统细节，可以无缝的扩展。开发者只需要关注自己的业务逻辑，不需要关注底层.比如Google APP Engine、阿里云轻量应用服务器等。</p>
<p><strong>IaaS</strong> 是云服务的最底层，提供一些基础资源。它和PaaS的区别是用户需要自己控制底层，实现基础设施的使用逻辑。比如Amazon EC2、阿里云ECS等。</p>
<p>PaaS项目被大家接纳的主要原因，提供了<strong>应用托管</strong>的能力。主流的做法就是租用一批虚拟机，像管理物理服务器那样，用脚本或者手工的方式在机器上部署应用。</p>
<p>Cloud Foundry 会调用操作系统的Cgroups和Namespace机制为每个应用单独创建一个沙盒的隔离环境，然后在沙盒中启动这些应用经常。这样就实现了把多个用户的应用互不干涉的在虚拟机里批量和自动的运行起来的目的。</p>
<p>PaaS项目的核心能力就是所谓的容器。</p>
<p>Docker 项目崛起的主要原因就是在于镜像。<br>所谓的 Docker 镜像，其实就是一个压缩包。但是压缩包直接包含一个完整操作系统的所有文件和目录，所以这个压缩包的内容和本地开发的和测试环境用的操作系统完全一样。</p>
<p>Docker 镜像的精髓就是本地环境和云端环境高度一致。</p>
<p>但是 Docker 项目固然解决了应用打包的问题，但是并不能代替 PaaS 完成大规模部署应用的职责。</p>
<p>Docker 公司为什么要收购 Fig 并发布 Swarm 项目呢？<br>该公司主要目的还是考虑如何让开发者把应用部署在我的项目上。而 Swarm 项目的最大亮点就是完全使用 Docker 项目原版容器管理 API 来完成集群管理。<br>而 Fig 项目之所以受欢迎是因为第一次提出了容器编排的概念。编排主要指用户如何通过某些工具或者配置来完成一组虚拟机以及关联资源的定义、配置、创建和删除等工作，然后由云计算平台按照这些指定的逻辑来完成的过程。</p>
<p>Swarm 擅长跟 Docker 生态的无缝集成，而 Mesos 擅长大规模集群的调度和管理。</p>
<p>容器本身没有价值，有价值的是容器编排。</p>
<p>容器的核心功能就是通过约束和修改进程的动态表现，从而为其创造出一个“边界”。对于 Docker 等大多数 Linux 容器来说，Cgroups 技术是用来制造约束的主要手段，而 Namespace 技术是用来修改进程视图的主要方法。</p>
<p>在创建容器进程的时候，指定了这个进程所需要启用的一组 Namespace 参数。这样容器就只能看到当前 Namespace 所限定的资源、文件、设备、状态或者配置。而对于宿主机以及其他不相关的程序就完全看不到了。<br>容器只是一种特殊的进程。</p>
<h3 id="隔离与限制"><a href="#隔离与限制" class="headerlink" title="隔离与限制"></a>隔离与限制</h3><p><img src="https://img.mknight.cn/medivh/1645094370477.png" alt="虚拟机和容器的对比"></p>
<p>敏捷和高性能是容器相对于虚拟机的最大优势，也是它能够在 PaaS 这种细粒度的资源管理平台上大型起到的重要原因。不过，基于 Namespace 的隔离机制相比于虚拟化技术不足的地方就是，隔离的不彻底。</p>
<p>容器只是允许在宿主机上的一种特殊进程，那么多个容器之间使用的就还是一个宿主机的操作系统内核。</p>
<h3 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h3><p>Pod 到底是什么，<strong>其实是一组共享了某些资源的容器。</strong></p>
<p>在一个Pod中，infra容器永远是第一个被创建的容器。</p>
<p><strong>状态类型</strong>的组成</p>
<ol>
<li>Pending。这个状态意味着Pod的YAML文件已经提交给了Kubenetes,API对象已经被创建并保存在ETCD中。但是目前该pod中的容器因为某些原因不能正常创建，比如调度不成功。</li>
<li>Running。这个状态下Pod已经调度成功。所包含的容器都已经创建成功，并且至少有一个正在运行中。</li>
<li>Succeeded。这个状态意味着Pod中所有容易都正常运行完毕，并且已经退出。主要常见于一次性的任务。</li>
<li>Failed。这个状态下，至少有一个容器以不正常的状态退出。</li>
<li>Unknown。这是一个异常状态，意味着Pod的状态不能持续被kubelet汇报给apiserver.很可能是主从节点之间的通信出现问题。</li>
</ol>
<h4 id="特殊的Volume"><a href="#特殊的Volume" class="headerlink" title="特殊的Volume"></a>特殊的Volume</h4><p>有这么几种特殊的Volume，存在的意义不是为了存放容器里的数据，也不是用来进行容器和宿主机之间的数据交换，而是为容器提供预先定义好的数据。主要分为以下四种类型：</p>
<ol>
<li>Secret 把pod想要访问的加密数据存放到etcd中，然后就可以通过在Pod的容器里挂载Volume的方式访问到Secret里保存的信息；</li>
<li>ConfigMap</li>
<li>Dowward API</li>
<li>ServiceAccountToken</li>
</ol>
<h5 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h5><p>可以用来存放数据库账号密码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: test-projected-volume </span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: test-secret-volume</span><br><span class="line">    image: busybox</span><br><span class="line">    args:</span><br><span class="line">    - <span class="built_in">sleep</span></span><br><span class="line">    - <span class="string">&quot;86400&quot;</span></span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: mysql-cred</span><br><span class="line">      mountPath: <span class="string">&quot;/projected-volume&quot;</span></span><br><span class="line">      readOnly: <span class="literal">true</span></span><br><span class="line">  volumes:</span><br><span class="line">  - name: mysql-cred</span><br><span class="line">    projected:</span><br><span class="line">      sources:</span><br><span class="line">      - secret:</span><br><span class="line">          name: user</span><br><span class="line">      - secret:</span><br><span class="line">          name: pass</span><br></pre></td></tr></table></figure>

<p>注意挂载的Volume类型是projected。这里用到的数据库用户名和密码，正是以Secret对象的方式交给Kubenetes保存的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> ./username.txt</span><br><span class="line">admin</span><br><span class="line">$ <span class="built_in">cat</span> ./password.txt</span><br><span class="line">c1oudc0w!</span><br><span class="line"></span><br><span class="line">$ kubectl create secret generic user --from-file=./username.txt</span><br><span class="line">$ kubectl create secret generic pass --from-file=./password.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看的话直接get secrets就行可以了</span></span><br><span class="line">[root@uat-109 k8s]<span class="comment"># kubectl get secrets</span></span><br><span class="line">NAME                  TYPE                                  DATA   AGE</span><br><span class="line">default-token-s9c4l   kubernetes.io/service-account-token   3      157m</span><br><span class="line">pass                  Opaque                                1      10s</span><br><span class="line">user                  Opaque                                1      23s</span><br></pre></td></tr></table></figure>

<p>除了from-file的方式还可以使用yaml的方式，比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: mysecret</span><br><span class="line"><span class="built_in">type</span>: Opaque</span><br><span class="line">data:</span><br><span class="line">  user: YWRtaW4=</span><br><span class="line">  pass: MWYyZDFlMmU2N2Rm</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意Secret对象爼数据必须是经过Base64转码的，以免出现明文密码的安全隐患。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> -n <span class="string">&#x27;admin&#x27;</span> | <span class="built_in">base64</span></span><br><span class="line">dG9t</span><br><span class="line">$ <span class="built_in">echo</span> -n <span class="string">&#x27;1f2d1e2e67df&#x27;</span> | <span class="built_in">base64</span></span><br><span class="line">dG9t</span><br></pre></td></tr></table></figure>

<h5 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap"></a>ConfigMap</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># .properties文件的内容</span></span><br><span class="line">$ <span class="built_in">cat</span> example/ui.properties</span><br><span class="line">color.good=purple</span><br><span class="line">color.bad=yellow</span><br><span class="line">allow.textmode=<span class="literal">true</span></span><br><span class="line">how.nice.to.look=fairlyNice</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从.properties文件创建ConfigMap</span></span><br><span class="line">$ kubectl create configmap ui-config --from-file=example/ui.properties</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看这个ConfigMap里保存的信息(data)</span></span><br><span class="line">$ kubectl get configmaps ui-config -o yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  ui.properties: |</span><br><span class="line">    color.good=purple</span><br><span class="line">    color.bad=yellow</span><br><span class="line">    allow.textmode=<span class="literal">true</span></span><br><span class="line">    how.nice.to.look=fairlyNice</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: ui-config</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>pod 的恢复策略有三种模式：</p>
<ul>
<li>Always 任何情况下只要容器不在运行状态就一定自动重启容器</li>
<li>OnFailure 只有在容器异常是才会自动重启容器</li>
<li>Never 从不重启容器</li>
</ul>
<p>PodPreset 可以实现预定义好部分字段，然后对selector的对象进行自动添加。注意要先创建PodPreset，然后再创建应用Pod。</p>
<blockquote>
<p>只适用于1.11以后的版本。</p>
</blockquote>
<h4 id="健康检查方式"><a href="#健康检查方式" class="headerlink" title="健康检查方式"></a>健康检查方式</h4><p>livenessProbe 和 readinessProbe</p>
<ol>
<li>支持http探测</li>
<li>执行命令command探测</li>
<li>tcp探测端口</li>
</ol>
<h4 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h4><p>Deployment是一个两层控制权。首先它通过rs的个数开连上应用的版本，然后再通过rs的属性，比如replicas的值来保证pod的副本数量。</p>
<p>deployment 控制 rs版本,rs 控制pod副本数。</p>
<p>Deployment 控制器实际操纵的是ReplicaSet对象，而不是Pod对象。实际上控制的是ReplicaSet的数目，以及每个ReplicaSet的属性。<br>而每一个应用的版本，对应的证书一个ReplicaSet，这个版本应用的Pod数量，则有ReplicaSet通过它自己的控制器来保证。<br><img src="evernotecid://2D277EDE-88BA-4DB6-AE12-A2B952C4D28E/appyinxiangcom/3119051/ENNote/p952?hash=1b6fac0f3400e2e1e7d7fec737d824c6" alt="1b6fac0f3400e2e1e7d7fec737d824c6.jpeg"></p>
<p>将一个集群中正在允许的多个Pod版本，交替的逐一升级的过程，就是滚动更新。</p>
<p><img src="https://img.mknight.cn/medivh/1661754735804.png" alt="1661754735804.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/Nginx%E7%9F%A5%E8%AF%86%E7%82%B9">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Nginx%E7%9F%A5%E8%AF%86%E7%82%B9" class="post-title-link" itemprop="url">Nginx知识点</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-19 17:21:21" itemprop="dateCreated datePublished" datetime="2022-08-19T17:21:21+08:00">2022-08-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-30 17:45:56" itemprop="dateModified" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="匹配规则"><a href="#匹配规则" class="headerlink" title="匹配规则"></a>匹配规则</h2><h3 id="文字描述"><a href="#文字描述" class="headerlink" title="文字描述"></a>文字描述</h3><ol>
<li>如果有精确匹配，则会进行精确匹配，成功的话返回结果</li>
<li>普通匹配和顺序无关，根据匹配的长短来取匹配结果</li>
<li>正则匹配和顺序有关，从上往下，匹配成功就返回结果</li>
<li>统配，都可以匹配</li>
</ol>
<p><img src="https://img.mknight.cn/medivh/1648549562146.png" alt="1648549562146.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(location = uri &#123;&#125;) &amp;gt; (location 完整路径 &#123;&#125;) &amp;gt; (location ^~ 路径 &#123;&#125;) &amp;gt; (location ~,~* 正则顺序 &#123;&#125;) &amp;gt; (location 部分起始路径 &#123;&#125;) &amp;gt; (location / &#123;&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="案例示例"><a href="#案例示例" class="headerlink" title="案例示例"></a>案例示例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">location = /php.php &#123;</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&#x27;精确匹配&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">location ^~ /php/ &#123;</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&#x27;标准匹配，仅前缀&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">location ~ \.(php) &#123;</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&#x27;区分大小写，小写&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">location ~ \.(pHp) &#123;</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&#x27;区分大小写，大写&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">location ~* \.(php)$ &#123;</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&#x27;不区分大小写&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@www quail]<span class="comment"># curl 192.168.249.132/php.php</span></span><br><span class="line">精确匹配</span><br><span class="line">[root@www quail]<span class="comment"># curl 192.168.249.132/php/php.php</span></span><br><span class="line">标准匹配，仅前缀</span><br><span class="line">[root@www quail]<span class="comment"># curl 192.168.249.132/pp.php</span></span><br><span class="line">区分大小写，小写</span><br><span class="line">[root@www quail]<span class="comment"># curl 192.168.249.132/pp.pHp</span></span><br><span class="line">区分大小写，大写</span><br><span class="line">[root@www quail]<span class="comment"># curl 192.168.249.132/php.pHP</span></span><br><span class="line">不区分大小写</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93" class="post-title-link" itemprop="url">Python知识点总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-17 15:25:24" itemprop="dateCreated datePublished" datetime="2022-08-17T15:25:24+08:00">2022-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-30 17:45:56" itemprop="dateModified" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="常见知识点"><a href="#常见知识点" class="headerlink" title="常见知识点"></a>常见知识点</h2><h3 id="自省"><a href="#自省" class="headerlink" title="自省"></a>自省</h3><p>自省，也叫反射，是运行时判断一个对象类型的能力。用来检查某些事务以确定它是什么、知道什么和它能做什么。相关的方法如下:</p>
<ul>
<li><p>hasattr(object,name)检查对象是否有name属性，Boolean</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Hi</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    a = <span class="number">0</span></span><br><span class="line"><span class="built_in">hasattr</span>(Hi,<span class="string">&#x27;a&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>getattr(object,name,default)获取对象的name属性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Hi</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    a = <span class="number">0</span></span><br><span class="line"><span class="built_in">getattr</span>(Hi,<span class="string">&#x27;a&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>setattr(object,name,default) 给对象设置name属性</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;class A(object):</span><br><span class="line">...     bar = 1</span><br><span class="line">... </span><br><span class="line">&gt;&gt;&gt; a = A()</span><br><span class="line">&gt;&gt;&gt; getattr(a, <span class="string">&#x27;bar&#x27;</span>)          <span class="comment"># 获取属性 bar 值</span></span><br><span class="line">1</span><br><span class="line">&gt;&gt;&gt; setattr(a, <span class="string">&#x27;bar&#x27;</span>, 5)       <span class="comment"># 设置属性 bar 值</span></span><br><span class="line">&gt;&gt;&gt; a.bar</span><br><span class="line">5</span><br></pre></td></tr></table></figure>
</li>
<li><p>delattr(object，name)给对象删除name属性</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Coordinate</span>:</span><br><span class="line">z = <span class="number">0</span></span><br><span class="line">point1 = Coordinate()  </span><br><span class="line"><span class="built_in">delattr</span>(Coordinate, <span class="string">&#x27;z&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;z = &#x27;</span>,point1.z)</span><br><span class="line"></span><br><span class="line">AttributeError: <span class="string">&#x27;Coordinate&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;z&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>dir([object]) 获取对象大部分的属性</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Coordinate</span>:</span><br><span class="line">z = <span class="number">0</span></span><br><span class="line">point1 = Coordinate()  </span><br><span class="line"><span class="built_in">dir</span>(Coordinate)</span><br><span class="line"></span><br><span class="line">[<span class="string">&#x27;__class__&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;__delattr__&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;__dict__&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;__dir__&#x27;</span>,</span><br><span class="line">...</span><br><span class="line"><span class="string">&#x27;z&#x27;</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>isinstance(name,object)检查name是不是object对象</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;a = <span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span> (a,<span class="built_in">int</span>)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>type(object) 查看对象的类型  <code>&gt;&gt;&gt; type(1) &lt;type &#39;int&#39;&gt;</code></p>
</li>
<li><p>callable(object)判断对象是否是可调用对象</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> a + b</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">callable</span>(add)             <span class="comment"># 函数返回 True</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="args和-kwargs"><a href="#args和-kwargs" class="headerlink" title="*args和**kwargs"></a>*args和**kwargs</h3><p>*args可以被打包成tuple，**kwargs被打包成dict。<br>*args示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">print_multiple_args</span>(<span class="params">*args</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(args), args)</span><br><span class="line"> </span><br><span class="line">print_multiple_args(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"><span class="comment"># 通过将列表前加*打包成关键字参数，指明了接收值参数必须是*args</span></span><br><span class="line">print_multiple_args(*[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;tuple&#x27;</span>&gt; (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;tuple&#x27;</span>&gt; (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>**kwargs示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">print_multiple_args</span>(<span class="params">**kwargs</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(kwargs), kwargs)</span><br><span class="line"><span class="comment"># 给字典前加**打包成关键字参数,指明接收值的参数必须是**kwargs</span></span><br><span class="line">print_multiple_args(**&#123;<span class="string">&#x27;foo&#x27;</span>:<span class="string">&#x27;bar&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;dict&#x27;</span>&gt; &#123;<span class="string">&#x27;foo&#x27;</span>: <span class="string">&#x27;bar&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="异常代码示例"><a href="#异常代码示例" class="headerlink" title="异常代码示例"></a>异常代码示例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># func   # 可能会抛出异常的代码</span></span><br><span class="line"><span class="keyword">except</span> (Exception1, Exception2) <span class="keyword">as</span> e:  <span class="comment"># 可以捕获多个异常并处理</span></span><br><span class="line">    <span class="comment"># 异常处理的代码</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># pass  # 异常没有发生的时候代码逻辑</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="keyword">pass</span>     <span class="comment"># 无论异常有没有发生都会执行的代码，一般处理资源的关闭和释放</span></span><br></pre></td></tr></table></figure>

<h3 id="GIL"><a href="#GIL" class="headerlink" title="GIL"></a>GIL</h3><p>GIL，解释器中一种线程同步的方式。</p>
<p>每个解释器都有一个GIL，直接作用是限制单个解释器进程中多线程的并行执行，使即使在多核处理器上对于单个解释器来说，同一时刻运行的线程仅限一个。同时造成的问题就是：在一个解释器进程中通过多线程的方式无法利用多核处理器来实现真正的并行。因此，Python的多线程是伪多线程，无法利用多核资源，同一时刻只能一个线程在真正的运行。</p>
<h3 id="迭代器和生成器"><a href="#迭代器和生成器" class="headerlink" title="迭代器和生成器"></a>迭代器和生成器</h3><h4 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h4><p><img src="https://img.mknight.cn/medivh/1660724977831.png" alt="1660724977831.png"></p>
<p>迭代器是一种对象，该对象包含值的可计数数字，意味着可以遍历所有值。list、tuple、dict、set都是可迭代的对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mytuple = (<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;cherry&quot;</span>)</span><br><span class="line">myit = <span class="built_in">iter</span>(mytuple)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(myit))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(myit))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(myit))</span><br><span class="line"></span><br><span class="line">apple</span><br><span class="line">banana</span><br><span class="line">cherry</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>要把对象或类创建为迭代器，必须为对象实现__iter__()和__next__（）方法。</p>
<h4 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h4><p>生成器，一遍循环一边计算的机制，不会像迭代器一样占用大量内存，只会在使用next()函数时才会生成下一个变量。</p>
<p>创建生成器：</p>
<ol>
<li>把列表的[]改为()</li>
<li>如果函数中包含yield关键字，那么调用函数时就会创建一个生成器对象</li>
</ol>
<p>工作原理：<strong>通过重复调用next()方法，直到捕获一个异常。</strong></p>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>在函数内部再定义一个函数，并且这个函数用到了外边函数的变量，那么将这个函数以及用到的一些变量称之为闭包。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">addx</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">adder</span>(<span class="params">y</span>):</span><br><span class="line">        <span class="keyword">return</span> x + y</span><br><span class="line">    <span class="keyword">return</span> adder</span><br><span class="line"> </span><br><span class="line">c = addx(<span class="number">8</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(c))</span><br><span class="line"><span class="built_in">print</span>(c.__name__)</span><br><span class="line"><span class="built_in">print</span>(c(<span class="number">10</span>))</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;function&#x27;</span>&gt;</span><br><span class="line">adder</span><br></pre></td></tr></table></figure>

<h3 id="classmethod和staticmethod区别"><a href="#classmethod和staticmethod区别" class="headerlink" title="classmethod和staticmethod区别"></a>classmethod和staticmethod区别</h3><ul>
<li>都可以通过Class.method()的方式调用</li>
<li>classmethod第一个参数是cls，可以引用类变量</li>
<li>staticmethod使用起来和普通函数一样，只不过放在类里去组织，完全可以放在类之外</li>
<li>classmethod是为了使用类变量</li>
</ul>
<h3 id="new-和-init-的区别"><a href="#new-和-init-的区别" class="headerlink" title="__new__和__init__的区别"></a>__new__和__init__的区别</h3><h4 id="new"><a href="#new" class="headerlink" title="new"></a><strong>new</strong></h4><p>new方法是一个内置的静态方法，主要作用：</p>
<ol>
<li>在内存中为对象分配空间</li>
<li>返回对象的引用，将引用作为第一个参数传递给__init__方法</li>
</ol>
<blockquote>
<p>重写__new__方法的代码是固定的，只能  <code>return super().__new__(cls)</code> 。否则Python解释器到不到分配了空间的对象引用，就不会调用对象的初试方法</p>
</blockquote>
<p>示例代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MusicPlayer</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="comment"># 如果不返回任何结果，</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().__new__(cls)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;初始化音乐播放对象&quot;</span>)</span><br><span class="line"></span><br><span class="line">player = MusicPlayer()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(player)</span><br><span class="line"></span><br><span class="line">初始化音乐播放对象</span><br><span class="line">&lt;__main__.MusicPlayer <span class="built_in">object</span> at <span class="number">0x1108d38e0</span>&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>new方法是静态方法，init方法是实例方法</li>
<li>new方法会返回一个床的实例，init方法什么都不返回</li>
<li>只有在new方法返回一个cls的实例后面的init方法才能被调用</li>
</ul>
<h4 id="call"><a href="#call" class="headerlink" title="call"></a><strong>call</strong></h4><p>call方法使类实例对象可以像调用普通函数那样，以”对象名()“的形式使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CLanguage</span>:</span><br><span class="line">    <span class="comment"># 定义__call__方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self,name,add</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;调用__call__()方法&quot;</span>,name,add)</span><br><span class="line"></span><br><span class="line">clangs = CLanguage()</span><br><span class="line">clangs(<span class="string">&quot;foo&quot;</span>,<span class="string">&quot;bar&quot;</span>)</span><br><span class="line"></span><br><span class="line">调用__call__()方法 foo bar</span><br></pre></td></tr></table></figure>

<h3 id="深拷贝和浅拷贝"><a href="#深拷贝和浅拷贝" class="headerlink" title="深拷贝和浅拷贝"></a>深拷贝和浅拷贝</h3><p>深拷贝 <code>deepcopy()</code>是将一个对象拷贝到另一个对象中，意味着如果对一个对象的拷贝做出改变时，不会影响原对象。其本质是对象的一次序列化和一次返回序列化。<br>可能遇到的问题：</p>
<ol>
<li>一个对象如果直接或简介引用了自身，会导致无休止的递归拷贝。解决，可以通过memo字典来保存已经拷贝过的对象。</li>
<li>深拷贝可能对原本设计为多个对象共享的数据也进行拷贝。解决，通过pickle函数来定制指定类型对象的拷贝行为。</li>
</ol>
<p>浅拷贝 <code>copy()</code> 是将一个对象的引用拷贝到另一个对象上，如果在拷贝中改动，则会影响到原对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy </span><br><span class="line"></span><br><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">b = copy.deepcopy(a)</span><br><span class="line">a.append(<span class="number">6</span>)</span><br><span class="line">c = copy.copy(a)</span><br><span class="line"><span class="built_in">print</span>(a,b,c)</span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>] [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>] [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br></pre></td></tr></table></figure>

<h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h3><p>为了确保某一个类只有一个实例存在。</p>
<h4 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h4><p><strong>模块</strong>，Python模块是天然的单例模式。当模块在第一次导入时会生成<code>.pyc</code>文件，当第二次导入时就会直接加载<code>.pyc</code>文件。因此只需要把相关函数和数据定义在一个模块中，就可以获得一个单例对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Class Mysingleton:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">foo</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">singleton_obj=Mysingleton()</span><br><span class="line"><span class="comment"># 保存文件，需要使用时直接在其他文件导入次文件中的对象即可。</span></span><br><span class="line"><span class="keyword">from</span> mysingleton <span class="keyword">import</span> singleton_obj</span><br></pre></td></tr></table></figure>

<p><strong>new方法</strong>，实例化一个对象时，都是先执行类的new方法，实例化对象，然后再执行init方法，对这个对象初始化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>():</span><br><span class="line">    instance = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls,*args,**kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;new一个对象&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> cls.instance == <span class="literal">None</span>:</span><br><span class="line">            cls.instance = <span class="built_in">object</span>.__new__(cls)</span><br><span class="line">            <span class="keyword">return</span> cls.instance</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> cls.instance</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;初始化对象&#x27;</span>)</span><br><span class="line">c1 = Test()</span><br><span class="line">c2 = Test()</span><br><span class="line">c3 = Test()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c1)</span><br><span class="line"><span class="built_in">print</span>(c2)</span><br><span class="line"><span class="built_in">print</span>(c3)</span><br><span class="line"></span><br><span class="line">new一个对象</span><br><span class="line">初始化对象</span><br><span class="line">new一个对象</span><br><span class="line">初始化对象</span><br><span class="line">new一个对象</span><br><span class="line">初始化对象</span><br><span class="line">&lt;__main__.Test <span class="built_in">object</span> at <span class="number">0x110ad12e0</span>&gt;</span><br><span class="line">&lt;__main__.Test <span class="built_in">object</span> at <span class="number">0x110ad12e0</span>&gt;</span><br><span class="line">&lt;__main__.Test <span class="built_in">object</span> at <span class="number">0x110ad12e0</span>&gt;</span><br></pre></td></tr></table></figure>

<p>结果可知实例化三个对象内存地址都是一样的，说明都是同一个对象。</p>
<p><strong>装饰器</strong>，任何一个类使用了该装饰器就会变成一个单例模式的类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">single_class</span>(<span class="params">cls</span>):</span><br><span class="line">    instance = <span class="built_in">dict</span>()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">single</span>(<span class="params">*args,**kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> instance:</span><br><span class="line">            instance[cls] = cls(*args,**kwargs)</span><br><span class="line">            <span class="keyword">return</span> instance[cls]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> instance[cls]</span><br><span class="line">    <span class="keyword">return</span> single</span><br><span class="line"></span><br><span class="line"><span class="meta">@single_class</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">c1 = Test()</span><br><span class="line">c2 = Test()</span><br><span class="line"><span class="built_in">print</span>(c1)</span><br><span class="line"><span class="built_in">print</span>(c2)</span><br><span class="line">    </span><br><span class="line">&lt;__main__.Test <span class="built_in">object</span> at <span class="number">0x1109172b0</span>&gt;</span><br><span class="line">&lt;__main__.Test <span class="built_in">object</span> at <span class="number">0x1109172b0</span>&gt;</span><br><span class="line">​        </span><br></pre></td></tr></table></figure>

<p>装饰器将所有的对象都存储到字典里，如果之前创建过的对象就直接返回，否则就new一个。</p>
<p>单例模式的优点：</p>
<ol>
<li>节约内存，实例化N个对象都实际指向同一个内存地址</li>
<li>多个地方创建的实例可以属性直接使用</li>
</ol>
<h3 id="Python解释器"><a href="#Python解释器" class="headerlink" title="Python解释器"></a>Python解释器</h3><ul>
<li>CPython，从官网下载下的就是C语言开发的Python，所以叫CPython，使用最广</li>
<li>IPython，是基于CPython之上的一个交互式解释器</li>
<li>PyPy，采用JIT技术，对Python代码动态编译，但和CPython执行结果可能不同</li>
<li>Jython，运行在Java平台上的Python解释器</li>
<li>IronPython，运行在.net平台的Python</li>
</ul>
<h3 id="Python是如何实现内存管理的"><a href="#Python是如何实现内存管理的" class="headerlink" title="Python是如何实现内存管理的"></a>Python是如何实现内存管理的</h3><p>Python提供了自动化的内存管理，也就是说内存空间的分配与释放都是由Python解释器运行时自动进行的。内存管理有三个关键点：</p>
<ol>
<li>引用计数</li>
<li>标记清理</li>
<li>分代收集</li>
</ol>
<p>引用计数，每个对象其实就是PyObject结构体，内部有一个ob——refcnt的引用计数器成员变量。程序在执行过程中，该变量会随之更新并反应引用有多少个变量引用到该对象。当该对象引用计数值为0时，它的内存就会被释放掉。</p>
<p>以下情况会导致引用计数加1：</p>
<ol>
<li>对象被创建</li>
<li>对象被引用</li>
<li>对象作为参数传入到一个函数中</li>
<li>对象作为元素存储到一个容器中</li>
</ol>
<p>以下情况会导致引用计数减1：</p>
<ol>
<li>使用del</li>
<li>对象引用被重新赋值其他对象</li>
<li>一个对象离开它所在的作用域</li>
<li>持有该对象的容器自身被销毁</li>
<li>持有该对象的容器删除该对象</li>
</ol>
<h3 id="lambda-函数的使用"><a href="#lambda-函数的使用" class="headerlink" title="lambda 函数的使用"></a>lambda 函数的使用</h3><p>功能是利用一行代码实现的小型函数。比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="keyword">lambda</span> a : a + <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(x(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"><span class="number">15</span></span><br></pre></td></tr></table></figure>

<p>语法：<code>lambda arguments : expression</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/Python%E4%B8%AD%E4%BD%BF%E7%94%A8list%E7%9A%84%E4%B8%80%E4%BA%9B%E4%B8%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E6%93%8D%E4%BD%9C">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Python%E4%B8%AD%E4%BD%BF%E7%94%A8list%E7%9A%84%E4%B8%80%E4%BA%9B%E4%B8%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E6%93%8D%E4%BD%9C" class="post-title-link" itemprop="url">Python中使用list的一些不常见的操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-10 17:19:27" itemprop="dateCreated datePublished" datetime="2022-08-10T17:19:27+08:00">2022-08-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-30 17:45:56" itemprop="dateModified" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="random"><a href="#random" class="headerlink" title="random"></a>random</h2><p>使用list之前先学习一下random的使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机整数：</span></span><br><span class="line"><span class="built_in">print</span> random.randint(<span class="number">1</span>,<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机选取0到100间的偶数：</span></span><br><span class="line"><span class="built_in">print</span> random.randrange(<span class="number">0</span>, <span class="number">101</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机浮点数：</span></span><br><span class="line"><span class="built_in">print</span> random.random()</span><br><span class="line"><span class="built_in">print</span> random.uniform(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机字符：</span></span><br><span class="line"><span class="built_in">print</span> random.choice(<span class="string">&#x27;abcdefghijklmnopqrstuvwxyz!@#$%^&amp;*()&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多个字符中生成指定数量的随机字符：</span></span><br><span class="line"><span class="built_in">print</span> random.sample(<span class="string">&#x27;zyxwvutsrqponmlkjihgfedcba&#x27;</span>,<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从a-zA-Z0-9生成指定数量的随机字符：</span></span><br><span class="line">ran_str = <span class="string">&#x27;&#x27;</span>.join(random.sample(string.ascii_letters + string.digits, <span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span> ran_str</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多个字符中选取指定数量的字符组成新字符串：</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;&#x27;</span>.join(random.sample([<span class="string">&#x27;z&#x27;</span>,<span class="string">&#x27;y&#x27;</span>,<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;v&#x27;</span>,<span class="string">&#x27;u&#x27;</span>,<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;q&#x27;</span>,<span class="string">&#x27;p&#x27;</span>,<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;k&#x27;</span>,<span class="string">&#x27;j&#x27;</span>,<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;a&#x27;</span>], <span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机选取字符串：</span></span><br><span class="line"><span class="built_in">print</span> random.choice([<span class="string">&#x27;剪刀&#x27;</span>, <span class="string">&#x27;石头&#x27;</span>, <span class="string">&#x27;布&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打乱排序</span></span><br><span class="line">items = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span> random.shuffle(items)</span><br></pre></td></tr></table></figure>

<h2 id="针对list的一些操作"><a href="#针对list的一些操作" class="headerlink" title="针对list的一些操作"></a>针对list的一些操作</h2><h3 id="判断两个list是否有重叠"><a href="#判断两个list是否有重叠" class="headerlink" title="判断两个list是否有重叠"></a>判断两个list是否有重叠</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_overlap_list</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    判断两个list是否重叠</span></span><br><span class="line"><span class="string">    1. 转为list</span></span><br><span class="line"><span class="string">    2. 判断最大元素是否属于第一个tuple，并且最小元素不在第一个tuple，返回True，否则False</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    s1 = (<span class="number">2</span>, <span class="number">6</span>)</span><br><span class="line">    s2 = (<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">    s = <span class="built_in">list</span>(s1 + s2)</span><br><span class="line">    s.sort(reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span> <span class="keyword">if</span> s[<span class="number">0</span>] == s1[<span class="number">1</span>] <span class="keyword">and</span> s[<span class="number">1</span>] != s1[<span class="number">0</span>] <span class="keyword">else</span> <span class="literal">True</span></span><br><span class="line">get_overlap_list()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出 </span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_overlap_tuple</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    判断两个tuple是否重叠；</span></span><br><span class="line"><span class="string">    分别判断第0个元素和第1个元素是否在另外一个tuple元素范围内</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    s2 = (<span class="number">6</span>, <span class="number">6</span>)</span><br><span class="line">    s1 = (<span class="number">1</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span> <span class="keyword">if</span> s1[<span class="number">0</span>] &lt;= s2[<span class="number">0</span>] &lt;= s1[<span class="number">1</span>] <span class="keyword">or</span> s1[<span class="number">0</span>] &lt;= s2[<span class="number">1</span>] &lt;= s1[<span class="number">1</span>] <span class="keyword">else</span> <span class="literal">True</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>此处判断的是list，其实换成tuple也是一样的。</p>
<h3 id="list去重"><a href="#list去重" class="headerlink" title="list去重"></a>list去重</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">s = [<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;t&#x27;</span>]</span><br><span class="line">sqlist = <span class="built_in">list</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> sqlist:</span><br><span class="line">        sqlist.append(i)</span><br><span class="line"><span class="built_in">print</span>(sqlist)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"></span><br><span class="line">[<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;i&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 优化后的写法</span></span><br><span class="line"></span><br><span class="line">animal = [<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;t&#x27;</span>]</span><br><span class="line">newlist = <span class="built_in">list</span>()</span><br><span class="line">sqlist = [newlist.append(i) <span class="keyword">for</span> i <span class="keyword">in</span> animal <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> newlist]</span><br><span class="line"><span class="built_in">print</span>(newlist)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">[<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;i&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>遍历原始list，如果元素不属于新的list则插入</p>
<h3 id="生成26个小写字母的list"><a href="#生成26个小写字母的list" class="headerlink" title="生成26个小写字母的list"></a>生成26个小写字母的list</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chars = [<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">97</span>,<span class="number">123</span>)]</span><br><span class="line"><span class="built_in">print</span>(chars)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"></span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27; &#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>使用<code>chr(ASSII)</code> 来定位字母</p>
<h3 id="反转"><a href="#反转" class="headerlink" title="反转"></a>反转</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 反转</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_reverse_list</span>():</span><br><span class="line">    num_list = [random.choice(<span class="built_in">range</span>(random.randint(<span class="number">1</span>, <span class="number">100</span>))) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">    tmp_list = <span class="built_in">list</span>()</span><br><span class="line">    <span class="built_in">print</span>(num_list)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(num_list)):</span><br><span class="line">        <span class="comment"># 从下标为0开始插入</span></span><br><span class="line">        tmp_list.insert(<span class="number">0</span>, num_list[i])</span><br><span class="line">    <span class="keyword">return</span> tmp_list</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">[<span class="number">46</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">73</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">33</span>, <span class="number">35</span>, <span class="number">60</span>, <span class="number">10</span>]</span><br><span class="line">[<span class="number">10</span>, <span class="number">60</span>, <span class="number">35</span>, <span class="number">33</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">73</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">46</span>]</span><br></pre></td></tr></table></figure>

<p>主要逻辑是使用insert插入到下标为0的元素，相当于遍历一遍从头开始插入。</p>
<h3 id="判断对称"><a href="#判断对称" class="headerlink" title="判断对称"></a>判断对称</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_symmetry_list</span>():</span><br><span class="line">    num_list = [random.choice(<span class="built_in">range</span>(random.randint(<span class="number">1</span>, <span class="number">100</span>))) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)]</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span> <span class="keyword">if</span> <span class="built_in">len</span>(num_list) % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">else</span> <span class="literal">True</span></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>此处判断是否对称主要取决于元素个数是否为奇数，也就是range的次数。</p>
<h3 id="取出字符串最长的单词"><a href="#取出字符串最长的单词" class="headerlink" title="取出字符串最长的单词"></a>取出字符串最长的单词</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_word_list</span>():</span><br><span class="line">    chars = [<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;ok&#x27;</span>, <span class="string">&#x27;ha&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;books&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(chars)):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(chars[<span class="number">0</span>]) &lt; <span class="built_in">len</span>(chars[i]):</span><br><span class="line">            chars[<span class="number">0</span>] = chars[i]</span><br><span class="line">    <span class="keyword">return</span> chars[<span class="number">0</span>]</span><br><span class="line">get_word_list()</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"></span><br><span class="line">hello</span><br></pre></td></tr></table></figure>

<h3 id="列表按绝对值排序"><a href="#列表按绝对值排序" class="headerlink" title="列表按绝对值排序"></a>列表按绝对值排序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">num_list = [<span class="number">1</span>, -<span class="number">6</span>, <span class="number">2</span>, -<span class="number">5</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">20</span>, -<span class="number">3</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(num_list)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(num_list) - <span class="number">1</span> - i):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(num_list[j]) &lt; <span class="built_in">abs</span>(num_list[j + <span class="number">1</span>]):</span><br><span class="line">            num_list[j], num_list[j + <span class="number">1</span>] = num_list[j + <span class="number">1</span>], num_list[j]</span><br><span class="line"><span class="keyword">return</span> num_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"></span><br><span class="line">[<span class="number">20</span>, <span class="number">9</span>, -<span class="number">6</span>, -<span class="number">5</span>, <span class="number">4</span>, -<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在冒泡的方式排序的过程使用<code>abs()</code>获取绝对值。</p>
<h3 id="生成列表解析式-1-10之间的偶数"><a href="#生成列表解析式-1-10之间的偶数" class="headerlink" title="生成列表解析式 1-10之间的偶数"></a>生成列表解析式 1-10之间的偶数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>) <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>元素除以2为0则是偶数。</p>
<h3 id="找出最大元素的下标"><a href="#找出最大元素的下标" class="headerlink" title="找出最大元素的下标"></a>找出最大元素的下标</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">new</span>():</span><br><span class="line">    num_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">88</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">33</span>]</span><br><span class="line">    tmp_list = num_list.copy()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(num_list)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(num_list) - <span class="number">1</span> - i):</span><br><span class="line">            <span class="keyword">if</span> num_list[j] &lt; num_list[j + <span class="number">1</span>]:</span><br><span class="line">                num_list[j], num_list[j + <span class="number">1</span>] = num_list[j + <span class="number">1</span>], num_list[j]</span><br><span class="line">    <span class="keyword">return</span> tmp_list.index(num_list[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>

<h3 id="list-组合为string"><a href="#list-组合为string" class="headerlink" title="list 组合为string"></a>list 组合为string</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> l]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="number">12356</span></span><br></pre></td></tr></table></figure>

<p>str.join(item) join 函数是一个字符串操作函数。item表示一个成员，且只能有一个。上述代码中<code>&#39;&#39;.join(xxx)</code>含义是将字符串中的xxx以字符&#96;&#96;分割后再拼接为一个字符串，代码中为空，因此输出字符串中也无间隔。</p>
<p>其他示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;,&#x27;</span>.join([<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> l]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误示例</span></span><br><span class="line"><span class="string">&#x27;,&#x27;</span>.join(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">TypeError: <span class="built_in">str</span>.join() takes exactly one argument (<span class="number">2</span> given)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="合并两个list为dict"><a href="#合并两个list为dict" class="headerlink" title="合并两个list为dict"></a>合并两个list为dict</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">list2dict</span>():</span><br><span class="line">    a = [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>]</span><br><span class="line">    b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">    s = <span class="built_in">dict</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">        s[a[i]] = b[i]</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>

<p>zip的方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>]</span><br><span class="line">b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">dict</span>(<span class="built_in">zip</span>(a,b)))</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>

<p>zip 函数用于将可迭代的对象作为参数，将对象中对应的元素打包成多个tuple，然后返回由这些tuple组成的list。但是要注意版本区别，Python 2.0 返回的是list，Python 3.0 返回的是一个对象，需要手动list()转换：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python 2.0+</span></span><br><span class="line">&gt;&gt;&gt; a = [1,2,3]</span><br><span class="line">&gt;&gt;&gt; b = [4,5,6]</span><br><span class="line">&gt;&gt;&gt; c = [4,5,6,7,8]</span><br><span class="line">&gt;&gt;&gt; zipped = zip(a,b)     <span class="comment"># 打包为元组的列表</span></span><br><span class="line">[(1, 4), (2, 5), (3, 6)]</span><br><span class="line">&gt;&gt;&gt; zip(a,c)              <span class="comment"># 元素个数与最短的列表一致</span></span><br><span class="line">[(1, 4), (2, 5), (3, 6)]</span><br><span class="line">&gt;&gt;&gt; zip(*zipped)          <span class="comment"># 与 zip 相反，*zipped 可理解为解压，返回二维矩阵式</span></span><br><span class="line">[(1, 2, 3), (4, 5, 6)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># python 3.0+</span></span><br><span class="line">&gt;&gt;&gt; a = [1,2,3]</span><br><span class="line">&gt;&gt;&gt; b = [4,5,6]</span><br><span class="line">&gt;&gt;&gt; c = [4,5,6,7,8]</span><br><span class="line">&gt;&gt;&gt; zipped = zip(a,b)     <span class="comment"># 返回一个对象</span></span><br><span class="line">&gt;&gt;&gt; zipped</span><br><span class="line">&lt;zip object at 0x103abc288&gt;</span><br><span class="line">&gt;&gt;&gt; list(zipped)  <span class="comment"># list() 转换为列表</span></span><br><span class="line">[(1, 4), (2, 5), (3, 6)]</span><br><span class="line">&gt;&gt;&gt; list(zip(a,c))              <span class="comment"># 元素个数与最短的列表一致</span></span><br><span class="line">[(1, 4), (2, 5), (3, 6)]</span><br></pre></td></tr></table></figure>

<p>dict()函数用于创建一个字典。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 语法</span></span><br><span class="line">class dict(**kwarg) </span><br><span class="line"><span class="comment"># **kwargs -- 关键字。</span></span><br><span class="line">class dict(mapping, **kwarg)</span><br><span class="line"><span class="comment"># mapping -- 元素的容器，映射类型（Mapping Types）是一种关联式的容器类型，它存储了对象与对象之间的映射关系。</span></span><br><span class="line">class dict(iterable, **kwarg)</span><br><span class="line"><span class="comment"># iterable -- 可迭代对象。</span></span><br></pre></td></tr></table></figure>

<p>使用方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;dict()                        <span class="comment"># 创建空字典</span></span><br><span class="line">&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; dict(a=<span class="string">&#x27;a&#x27;</span>, b=<span class="string">&#x27;b&#x27;</span>, t=<span class="string">&#x27;t&#x27;</span>)     <span class="comment"># 传入关键字</span></span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;t&#x27;</span>: <span class="string">&#x27;t&#x27;</span>&#125;</span><br><span class="line">&gt;&gt;&gt; dict(zip([<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;three&#x27;</span>], [1, 2, 3]))   <span class="comment"># 映射函数方式来构造字典</span></span><br><span class="line">&#123;<span class="string">&#x27;three&#x27;</span>: 3, <span class="string">&#x27;two&#x27;</span>: 2, <span class="string">&#x27;one&#x27;</span>: 1&#125; </span><br><span class="line">&gt;&gt;&gt; dict([(<span class="string">&#x27;one&#x27;</span>, 1), (<span class="string">&#x27;two&#x27;</span>, 2), (<span class="string">&#x27;three&#x27;</span>, 3)])    <span class="comment"># 可迭代对象方式来构造字典</span></span><br><span class="line">&#123;<span class="string">&#x27;three&#x27;</span>: 3, <span class="string">&#x27;two&#x27;</span>: 2, <span class="string">&#x27;one&#x27;</span>: 1&#125;</span><br></pre></td></tr></table></figure>


<h2 id="深浅拷贝"><a href="#深浅拷贝" class="headerlink" title="深浅拷贝"></a>深浅拷贝</h2><p>这里来讲述一下深拷贝和浅拷贝。</p>
<p><strong>变量</strong>存储在栈内存，<strong>对象</strong>存储在堆内存。</p>
<p><img src="https://img.mknight.cn/medivh/1660127290005.png" alt="1660127290005.png"></p>
<p>浅拷贝只对源对象的引用进行拷贝，对象的内容不进行操作。实现原理：</p>
<ol>
<li>对于源对象是可变数据类型，在堆内存中创建新空间；</li>
<li>对于源对象不是可变数据类型，则拷贝起引用。</li>
</ol>
<blockquote>
<p>可变数据类型包括：List、Dictionary、<br>不可变数据类型包括：String、Number、Tuple</p>
</blockquote>
<h3 id="浅拷贝"><a href="#浅拷贝" class="headerlink" title="浅拷贝"></a>浅拷贝</h3><ol>
<li>不拷贝子对象的内容，只拷贝子对象的引用</li>
<li>可以使用内置函数<code>copy()</code></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单层浅拷贝-源对象是可变数据类型</span></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">c = copy.copy(a)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(a),<span class="built_in">id</span>(c))  <span class="comment"># 地址不相同</span></span><br><span class="line"><span class="number">4543590848</span> <span class="number">4542857664</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对于源对象是可变数据类型，在堆内存中创建新空间。</p>
<h3 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h3><ol>
<li>会连子对象的内存全部拷贝一份，对子对象的修改不会影响资源对象</li>
<li>可以使用内置函数<code>deeocopy()</code></li>
</ol>
<p><img src="https://img.mknight.cn/medivh/1660127456935.png" alt="1660127456935.png"></p>
<p>源对象是不可变数据类型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单层浅拷贝-源对象是不可变数据类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">a = <span class="number">1</span></span><br><span class="line">b = (<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">c = copy.copy(a)</span><br><span class="line">d = copy.copy(b)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(a),<span class="built_in">id</span>(c)) <span class="comment"># 地址相同</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(b),<span class="built_in">id</span>(d)) <span class="comment"># 地址相同</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="number">4474448176</span> <span class="number">4474448176</span></span><br><span class="line"><span class="number">4541979776</span> <span class="number">4541979776</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img.mknight.cn/medivh/1660188093129.png" alt="1660188093129.png"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>深浅拷贝都是对源对象的复制。</p>
<h2 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">num_list = [<span class="number">23</span>, <span class="number">54</span>, <span class="number">56</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">354</span>, <span class="number">56</span>, <span class="number">77</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">2</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(num_list)):  <span class="comment"># 从第0个元素开始循环</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(num_list) - i - <span class="number">1</span>):  <span class="comment"># range范围为 总长度-1-当前元素，因为元素下标从0开始</span></span><br><span class="line">        <span class="keyword">if</span> num_list[j] &lt; num_list[j + <span class="number">1</span>]:  <span class="comment"># 如果该元素小于 下一个元素</span></span><br><span class="line">            <span class="built_in">print</span>(num_list[j], num_list[j + <span class="number">1</span>])</span><br><span class="line">            num_list[j], num_list[j + <span class="number">1</span>] = num_list[j + <span class="number">1</span>], num_list[j]  <span class="comment"># 那么当前排序就为 该元素的位置就和下一个元素调换</span></span><br><span class="line">        <span class="built_in">print</span>(num_list)</span><br><span class="line"><span class="built_in">print</span>(num_list)</span><br></pre></td></tr></table></figure>

<ol>
<li>首先第一层循环list；<ol>
<li>第二层循环list，范围为list总长度-1-当前元素（元素下标都是从0开始）<ol>
<li>如果该元素小于下一个元素<ol>
<li>赋值 元素&#x3D;下一个元素，下一个元素&#x3D;该元素 （当前元素和下一个元素进行调换）</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>最后输出新的list就是排序后的list，从大到小。并且该算法还有两个规律：</p>
<ol>
<li><strong>循环总次数等于元素个数之和</strong>，比如10个元素需要55次、11个元素需要66次等等。</li>
<li><strong>切换一下判断条件可以直接改为从小大排序</strong>，<code>if num_list[j] &gt; num_list[j + 1]:</code></li>
</ol>
<h2 id="二分法查找"><a href="#二分法查找" class="headerlink" title="二分法查找"></a>二分法查找</h2><p>所谓二分法查找针对的是一个有序的数据集合，每次通过跟区间中的元素对比，将待查找的区间缩小为之前的一半，知道找到要查找的元素，或者区间缩小为0.</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">array = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">47</span>, <span class="number">50</span>, <span class="number">54</span>, <span class="number">61</span>, <span class="number">62</span>, <span class="number">66</span>, <span class="number">72</span>, <span class="number">77</span>, <span class="number">80</span>, <span class="number">91</span>, <span class="number">97</span>, <span class="number">102</span>, <span class="number">107</span>, <span class="number">110</span>, <span class="number">113</span>, <span class="number">118</span>, <span class="number">123</span>, <span class="number">126</span>, <span class="number">130</span>, <span class="number">142</span>, <span class="number">143</span>, <span class="number">144</span>, <span class="number">145</span>, <span class="number">148</span>, <span class="number">152</span>, <span class="number">158</span>, <span class="number">162</span>, <span class="number">177</span>, <span class="number">179</span>, <span class="number">184</span>, <span class="number">196</span>, <span class="number">198</span>, <span class="number">198</span>, <span class="number">200</span>, <span class="number">212</span>, <span class="number">212</span>, <span class="number">218</span>, <span class="number">236</span>, <span class="number">259</span>, <span class="number">266</span>, <span class="number">290</span>, <span class="number">298</span>, <span class="number">304</span>, <span class="number">310</span>, <span class="number">311</span>, <span class="number">338</span>, <span class="number">347</span>, <span class="number">349</span>, <span class="number">350</span>, <span class="number">365</span>, <span class="number">377</span>, <span class="number">381</span>, <span class="number">389</span>, <span class="number">389</span>, <span class="number">395</span>, <span class="number">404</span>, <span class="number">408</span>, <span class="number">431</span>, <span class="number">446</span>, <span class="number">466</span>, <span class="number">480</span>, <span class="number">496</span>, <span class="number">503</span>, <span class="number">521</span>, <span class="number">528</span>, <span class="number">531</span>, <span class="number">555</span>, <span class="number">570</span>, <span class="number">576</span>, <span class="number">593</span>, <span class="number">625</span>, <span class="number">681</span>, <span class="number">687</span>, <span class="number">723</span>, <span class="number">818</span>, <span class="number">835</span>, <span class="number">844</span>, <span class="number">853</span>, <span class="number">854</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#函数递归</span></span><br><span class="line"><span class="comment">#定义一个函数,给三个形参:低位值，高位值，查找值</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">binarySearch</span>(<span class="params">low,height,findNum</span>):</span><br><span class="line">    <span class="comment">#计算出中位数</span></span><br><span class="line">    middle = low+(height-low)//<span class="number">2</span></span><br><span class="line">    <span class="comment">#如果中位数小于查找值,则锁定后半段</span></span><br><span class="line">    <span class="keyword">if</span> findNum &gt;array[middle]:</span><br><span class="line">        <span class="comment">#重置低位数</span></span><br><span class="line">        low = middle +<span class="number">1</span></span><br><span class="line">    <span class="comment">#如果中位数大于查找值,则锁定前半段</span></span><br><span class="line">    <span class="keyword">elif</span> findNum&lt;array[middle]:</span><br><span class="line">        <span class="comment">#重置高位值</span></span><br><span class="line">        height = middle - <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment">#找到该值并返回</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;该值下标为:%s,值为:%s&#x27;</span>%(middle,array[middle])</span><br><span class="line">    <span class="comment">#没有找到则调用自身继续查找</span></span><br><span class="line">    <span class="keyword">return</span> binarySearch(low,height,findNum)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(binarySearch(array[<span class="number">0</span>],<span class="built_in">len</span>(array)-<span class="number">1</span>,<span class="number">19</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">该值下标为:<span class="number">14</span>,值为:<span class="number">19</span></span><br></pre></td></tr></table></figure>

<h3 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h3><p>容易出错的地方：</p>
<ol>
<li>mid的取值，mid&#x3D;(low+high)&#x2F;2 这种写法是有问题的。因为如果 low 和 high 比较大的话，两者之和就有可能会溢出。正确的方法可以改为 <code>middle=low+(height-low)//2</code> 或者 <code>middle=low+((height-low)&gt;&gt;1)</code> (除以2的1次方);</li>
<li>low和height的更新要使用<code>height = middle-1</code>和<code>low = middle+1</code>。</li>
</ol>
<blockquote>
<p><code>&gt;&gt;</code> 右移，右边的数字指定了移动的位数，除法 。print(a &gt;&gt; 3)  # 相当于a 除 2的3次方<br><code>&lt;&lt;</code> 左移，左边的数字指定了移动的位数，乘法。print(a &lt;&lt; 3)  # 相当于a 乘 2的3次方</p>
</blockquote>
<p>局限性：</p>
<ol>
<li>只能查找有序的数据集；</li>
<li>针对的是静态有序数据集；</li>
<li>不适合数据量太大或太小的场景。太大的情况会消耗太多内存，太小的场景和遍历差别不大。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/%E8%AF%A6%E8%A7%A3Kubernetes%E4%B8%ADPod%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4%E8%BF%87%E7%A8%8B">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%AF%A6%E8%A7%A3Kubernetes%E4%B8%ADPod%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4%E8%BF%87%E7%A8%8B" class="post-title-link" itemprop="url">详解Kubernetes中Pod的创建和删除过程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-10 10:20:03" itemprop="dateCreated datePublished" datetime="2022-08-10T10:20:03+08:00">2022-08-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-30 17:45:56" itemprop="dateModified" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/" itemprop="url" rel="index"><span itemprop="name">云原生</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前简单了解了Pod的创建过程，也遇到过Pod无法删除的问题，但大部分都是强制删除。因此，此篇文档记录一下对这两个过程的细致理解。</p>
<blockquote>
<p>对go语言不够熟悉，暂时无法达到阅读代码的能力，以下信息均来源于网络总结和自己的思考。</p>
</blockquote>
<h2 id="创建过程"><a href="#创建过程" class="headerlink" title="创建过程"></a>创建过程</h2><p><img src="https://img.mknight.cn/medivh/1660112505748.png" alt="1660112505748.png"></p>
<ol>
<li>kubectl 将创建Pod的yaml文件提交给APIServer；</li>
<li>APIServer 收到指令通知给controller-manager创建一个资源对象；</li>
<li>controller-manager通过APIServer将Pod的配置信息存储到ETCD中；</li>
<li>scheduler通过 watch机制监听到ETCD中有要创建Pod但未调度的请求后开始调度预选，<ol>
<li>首先过滤掉不符合资源配置的要求的node；</li>
<li>然后开始调度选优，计算出更适合运行的节点。将Pod和节点绑定信息交给APIServer。</li>
</ol>
</li>
<li>APIServer将信息写入ETCD中，</li>
<li>kubelet根据调度结果执行pod创建操作，运行成功后将创建结果返回给APIServer。</li>
</ol>
<h2 id="删除过程"><a href="#删除过程" class="headerlink" title="删除过程"></a>删除过程</h2><p>所谓删除Pod的过程，主要指用户通过<code>kubectl delete pod</code>命令，或者利用HTTP调用接口去执行。</p>
<h3 id="代码解读"><a href="#代码解读" class="headerlink" title="代码解读"></a>代码解读</h3><h4 id="DeleteResource"><a href="#DeleteResource" class="headerlink" title="DeleteResource"></a>DeleteResource</h4><p>首先调用BeforeDelete方法，查看要删除的Resource瑞祥是否支持优雅删除，如果支持，则优雅变量为TRUE。还执行两个设定，设置删除的时间戳为now，以及优雅删除的时间限制，由用户来决定。</p>
<p>优雅变量如果未TRUE，那么就会调用updateForGracefulDeletionAndFinalizers方法，该方法用于改变Pod的两个字段，DeletionTimestamp和DeletionGracePeriodSeconds。</p>
<p>调用完该方法后会返回deleteImmediately字段，表示是否需要立刻删除，也就是不支持优雅删除。如果支持优雅删除，则delete方法不删除ETCD中的Resource数据，直接返回，APIServer处理逻辑到此结束。</p>
<h4 id="kubelet删除Pod"><a href="#kubelet删除Pod" class="headerlink" title="kubelet删除Pod"></a>kubelet删除Pod</h4><p>kubelet使用syncLoopIteration监听APIServer，一旦出现删除时间，则调用HandlePodUpdates方法处理。</p>
<ol>
<li>首先调用pod manager的updatePod方法来更新Pod信息；</li>
<li>然后判断pod是否为mirror pod，如果是则调用handleMirrorPod方法处理该Pod；</li>
<li>否则利用GetMirrorPodByPod方法得到该Pod的mirror pod，接着调用dispatchWork将pod删除分配给具体的worker处理；</li>
<li>dispatchwork方法调用UpdatePod方法对Pod进行删除；<ol>
<li>该方法会调用其他方法进行判断，进行删除；</li>
<li>杀掉Pod中的容器；</li>
<li>删除pod的pause容器。</li>
</ol>
</li>
<li>kubelet 判断Pod是否已经优雅的停止，资源是否删除干净。<ol>
<li>如果删除干净则返回TRUE，向APIServer发送delete，再次删除Pod。优雅时间设置为0，表示强制删除Pod。因此APIServer会再次收到delete请求，继续执行delete的流程。与第一次不同的是，这次强制删除会执行完整的流程，操作ETCD删除最终的Pod信息。</li>
</ol>
</li>
<li>kubelete 接收到事件变化后，转为remove事件，完成Pod的最终清理工作。</li>
</ol>
<p>以上内容可能描述的并不是很清晰，先占位，以后再补。</p>
<h3 id="概括"><a href="#概括" class="headerlink" title="概括"></a>概括</h3><p>以上流程中还有很多未细致拆分的事件，不再赘述，下面概况总结一下：</p>
<ol>
<li>客户端发出请求删除Pod（可选传递优雅删除参数，时间秒为单位）；</li>
<li>APIServer 做优雅删除的检查，并更新Pod信息，设置删除时间戳和优雅删除时间，默认30s；</li>
<li>kubelet优雅释放Pod资源；</li>
<li>kubelet向APIServer请求删除Pod；</li>
<li>APIServer删除etcd中Pod信息；</li>
<li>Kubelet 完成最终Pod的资源清理。</li>
</ol>
<h3 id="如何删除Pod"><a href="#如何删除Pod" class="headerlink" title="如何删除Pod"></a>如何删除Pod</h3><h4 id="强制删除"><a href="#强制删除" class="headerlink" title="强制删除"></a>强制删除</h4><p><code>kubectl delete pod xxx -n xxx --force --grace-period=0</code> 使用<code>--force</code>命令。</p>
<h4 id="finalizers-删除"><a href="#finalizers-删除" class="headerlink" title="finalizers 删除"></a>finalizers 删除</h4><p><code>kubectl patch pod xxx -n xxx -p &#39;&#123;&quot;metadata&quot;:&#123;&quot;finalizers&quot;:null&#125;&#125;&#39;</code></p>
<p>如果一个容器已经在运行，这时需要对一些容器属性进行修改，又不想删除容器，或不方便通过replace的方式进行更新。kubernetes还提供了一种在容器运行时，直接对容器进行修改的方式，就是patch命令。这时就需要edit该资源，将字段finalizers设置为null，之后Kubernetes资源就正常删除了。</p>
<p>APIServer在检查Finalizers并结合是否需要优雅删除来决定是否立刻删除对象。如果对象不需要进行优雅删除:<code>metadata.Finalizers</code>为空，则直接删除。</p>
<h5 id="Finalizers"><a href="#Finalizers" class="headerlink" title="Finalizers"></a>Finalizers</h5><p>Finalizers属于kubernetes GC垃圾收集器，是一种删除拦截机制，能够让控制权实现异步的删除前回调。其存在任何一个资源对象的meta中。</p>
<h5 id="Graceful-Deletion"><a href="#Graceful-Deletion" class="headerlink" title="Graceful Deletion"></a>Graceful Deletion</h5><p>APIServer在处理Pod删除请求时，会根据pod 的 pod.Spec.TerminationGracePeriodSeconds 和 deleteOptions.GracefulPeriodSeconds 综合判断，是否进行 Graceful 删除：</p>
<ol>
<li>当删除请求选项中有设置 GracefulPeriodSeconds，以选项中为准。若没有，使用 pod.Spec.TerminationGracePeriodSeconds 。若 pod.Spec.TerminationGracePeriodSeconds 也没有设置，使用默认值 0 。</li>
<li>当 Pod 没有调度，或者已经结束（无论成功还是失败）。GracePeriodSeconds 都重置为 0.GracePeriodSeconds 为 0 表示不进行优雅删除。非 0 表示进行优雅删除。Pod 的默认优雅删除时间为 30 s ，在对象创建时配置在 pod.Spec.TerminationGracePeriodSeconds 字段。</li>
</ol>
<p>优雅删除的目的是给予 Kubelet 一定时间对 Pod 实行优雅退出。在用户对 Pod 执行 Delete 操作时，Pod 对象不会立即从 API Server 删除，而只是进入 Termination 阶段。Kubelet 会对运行中的 Pod 的容器发送 TERM 信号，通知其退出。并执行用户配置的 preStop hooks 逻辑。当优雅时间过了之后，再开始使用 KILL 信号尝试强制杀容器。</p>
<p>当 kubelet 将 Pod 清理干净后，就会使用 GracefulPeriodSeconds&#x3D;&#x3D;0 的参数执行删除操作。</p>
<p>因为 Pod 实现优雅删除目的是为了给予 Kubelet 时间做资源清理操作，所以这也是为什么在设置 GracePeriodSeconds 阶段，若 Pod 没有被调度或者已经退出，也就可以直接允许立即删除 (GracePeriodSeconds &#x3D; 0)。</p>
<h4 id="无法删除的原因"><a href="#无法删除的原因" class="headerlink" title="无法删除的原因"></a>无法删除的原因</h4><p>了解上述机制后，对象无法删除的原因无外乎以下两个方面：</p>
<ol>
<li>对象存在finalizers，关联的控制权故障未能执行或执行finalizer函数卡主</li>
<li>对象需要优雅删除，但是执行者不能完成删除，比如以下情况：<ol>
<li>kubelet 无法通过container runtime杀死进程。比如进程进入Uninterruptible状态。</li>
<li>kubelet进程停止或者node离线。这种情况下没有kubelet运行或运行中的kubelet与APIServer已经端口，无法收到Pod需要删除的消息。所以没有执行者来进行优雅删除。这种情况下恢复节点以及kubelet即可。</li>
</ol>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/%E5%AD%A6%E4%B9%A0Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95%E7%9A%84%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%AD%A6%E4%B9%A0Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95%E7%9A%84%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89" class="post-title-link" itemprop="url">学习Python数据结构和算法的笔记（一）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-05 15:50:47" itemprop="dateCreated datePublished" datetime="2022-08-05T15:50:47+08:00">2022-08-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-30 17:45:56" itemprop="dateModified" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">开发</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>虽然学习和使用Python已经多年，但是对于算法这一块基本上已经忘的差不多了，正好有机会阅读 <em>用Python解决数据结构和算法</em> 来巩固一下知识点。</p>
<h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>学习的目标是什么，或者动力是什么？</p>
<ol>
<li>了解计算机科学、程序设计和问题解决的基本概念；</li>
<li>理解抽象和抽象在问题解决过程中的作用；</li>
<li>理解抽象数据类型的概念以及运用</li>
</ol>
<p><strong>算法</strong> 即写出一组解决问题可能出现的任何情况的步步为营的指令。算法通过有线的过程解决问题，是一种解决方案。<br><strong>程序设计</strong> 将算法编码为计算机可执行的表示法或编程语言的过程。</p>
<h3 id="Python基础"><a href="#Python基础" class="headerlink" title="Python基础"></a>Python基础</h3><p>为什么要学习算法？<br>通过研究大量不同的算法，可以发展出模式识别机制，当以后出现相似问题时可以更好的解决掉。</p>
<p>Python是一种支持面向对象的编程范式，意味着Python把数据当做问题解决过程的重点。<strong>类</strong> 去描述数据的外观（状态）和功能（行为）。“类”类似于抽象数据类型，“类”的用户只能看到数据项的状态和行为。数据项在面向对象的范式里被称为<strong>对象</strong>(objects)。对象是类的一个实例。</p>
<p>接下来的内容讲述了Python的基本数据类型：</p>
<ul>
<li>int和float</li>
<li>list和set</li>
<li>string</li>
<li>dict</li>
</ul>
<h4 id="列表解析"><a href="#列表解析" class="headerlink" title="列表解析"></a>列表解析</h4><p>现在尝试解决一些问题。修改代码，是最终列表只包含字母的单一副本<code>[&#39;c&#39;,&#39;a&#39;,&#39;t&#39;,&#39;d&#39;,&#39;o&#39;,&#39;g&#39;,&#39;r&#39;,&#39;b&#39;,&#39;i&#39;]</code>，源码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wordlist = [<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;dog&#x27;</span>,<span class="string">&#x27;rabbit&#x27;</span>]</span><br><span class="line">letterlist = [ ]</span><br><span class="line"><span class="keyword">for</span> aword <span class="keyword">in</span> wordlist:</span><br><span class="line">    <span class="keyword">for</span> aletter <span class="keyword">in</span> aword:</span><br><span class="line">        letterlist.append(aletter)</span><br><span class="line"><span class="built_in">print</span>(letterlist)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">[<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;t&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>修改后的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wordlist = [<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;dog&#x27;</span>,<span class="string">&#x27;rabbit&#x27;</span>]</span><br><span class="line">letterlist = [ ]</span><br><span class="line"><span class="keyword">for</span> aword <span class="keyword">in</span> wordlist:</span><br><span class="line">    <span class="keyword">for</span> aletter <span class="keyword">in</span> aword:</span><br><span class="line">        letterlist.append(aletter)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(<span class="built_in">set</span>(letterlist)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;t&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其实，作者的本意可能是让使用列表解析的方式来达到目的，但是我们有更好的方法，使用<code>set()</code>来去重后再转为<code>list()</code>类型就可以了。</p>
<h5 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h5><p>在列表中，存在一种替代方法使用迭代和选择结构创建列表，被称为<strong>列表解析</strong>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">newlist = [Expression <span class="keyword">for</span> var <span class="keyword">in</span> <span class="built_in">list</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>说明如下：</p>
<ul>
<li>newlist 新生成的列表名称</li>
<li>Expression 表达式，用于计算新列表的元素</li>
<li>var 变量，值为后面列表的每个元素值</li>
<li>list 用于生成新列表的原列表</li>
</ul>
<p>带有条件的解析</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newlist = [Expression <span class="keyword">for</span> var <span class="keyword">in</span> <span class="built_in">list</span> <span class="keyword">if</span> condition]</span><br></pre></td></tr></table></figure>

<p>condition 条件表达式，用于筛选条件。</p>
<h5 id="解析规则"><a href="#解析规则" class="headerlink" title="解析规则"></a>解析规则</h5><p>Python中内置类型的解析规则：</p>
<ol>
<li>如果使用中括号，表示为列表解析；</li>
<li>如果使用大括号，表示为集合解析</li>
<li>如果使用大括号且元素为k:v形式，表示为字典解析。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 集合解析</span></span><br><span class="line">&gt;&gt;&gt; &#123; i*2 <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;abcd&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&#x27;aa&#x27;</span>, <span class="string">&#x27;cc&#x27;</span>, <span class="string">&#x27;dd&#x27;</span>, <span class="string">&#x27;bb&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典解析</span></span><br><span class="line">&gt;&gt;&gt; &#123; k:v <span class="keyword">for</span> k,v <span class="keyword">in</span> zip((&quot;one&quot;,&quot;two&quot;,&quot;three&quot;),(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)) &#125;</span><br><span class="line">&#123;<span class="string">&#x27;one&#x27;</span>: 1, <span class="string">&#x27;two&#x27;</span>: 2, <span class="string">&#x27;three&#x27;</span>: 3&#125;</span><br><span class="line">&gt;&gt;&gt; &#123; k: k*2 <span class="keyword">for</span> k <span class="keyword">in</span> <span class="string">&quot;abcd&quot;</span> &#125;</span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;aa&#x27;</span>, <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;bb&#x27;</span>, <span class="string">&#x27;c&#x27;</span>: <span class="string">&#x27;cc&#x27;</span>, <span class="string">&#x27;d&#x27;</span>: <span class="string">&#x27;dd&#x27;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="工作方式"><a href="#工作方式" class="headerlink" title="工作方式"></a>工作方式</h5><p>首先用迭代工具for对容器中的元素进行跌打，每个元素都经过筛选，对符合条件的元素执行外部表达式，每个外部表达式都生成一个新的元素，然后昨晚新列表的一个元素，从而推导出一个新的列表。</p>
<p>列表解析可以让你创建基于某些处理或选择条件的列表。比如创建一个小于10的整数的平方的列表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sqlist = <span class="built_in">list</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>):</span><br><span class="line">    sqlist.append(i*i)</span><br><span class="line"><span class="built_in">print</span>(sqlist)</span><br><span class="line"></span><br><span class="line">sqlist = [i*i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>)]</span><br><span class="line"><span class="built_in">print</span>(sqlist)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>, <span class="number">100</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>, <span class="number">100</span>]</span><br></pre></td></tr></table></figure>

<p>上面的代码中，第一段是先循环出一个整数，计算后再塞入list。第二段代码其实也是差不多，先取出一个整数，计算平方后再塞入新建的列表中。列表解析还可以使用选择语句，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sqlist = [i*i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>) <span class="keyword">if</span> i%<span class="number">2</span> !=<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(sqlist)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>, <span class="number">9</span>, <span class="number">25</span>, <span class="number">49</span>, <span class="number">81</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上述代码中取整数后判断是否为奇数，如果是则进行平方计算并塞入新的列表中。</p>
<h5 id="练习——列表解析"><a href="#练习——列表解析" class="headerlink" title="练习——列表解析"></a>练习——列表解析</h5><p>删除重复元素：<code>[&#39;c&#39;, &#39;a&#39;, &#39;t&#39;, &#39;d&#39;, &#39;o&#39;, &#39;g&#39;, &#39;r&#39;, &#39;a&#39;, &#39;b&#39;, &#39;b&#39;, &#39;i&#39;, &#39;t&#39;]</code></p>
<p>代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 常规方案</span></span><br><span class="line">s = [<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;t&#x27;</span>]</span><br><span class="line">sqlist = <span class="built_in">list</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> sqlist:</span><br><span class="line">        sqlist.append(i)</span><br><span class="line"><span class="built_in">print</span>(sqlist)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表解析</span></span><br><span class="line">animal = [<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;t&#x27;</span>]</span><br><span class="line">newlist = <span class="built_in">list</span>()</span><br><span class="line">sqlist = [newlist.append(i) <span class="keyword">for</span> i <span class="keyword">in</span> animal <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> newlist]</span><br><span class="line"><span class="built_in">print</span>(newlist)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"></span><br><span class="line">[<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;i&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里和之前不一样的是，步骤如下：</p>
<ol>
<li>循环取出一个元素；</li>
<li>判断元素是否属于定义的newlist;</li>
<li>如果不属于则插入到newlist;</li>
<li>输出newlist.</li>
</ol>
<h5 id="练习——函数"><a href="#练习——函数" class="headerlink" title="练习——函数"></a>练习——函数</h5><p>编写一个函数，该函数生成一个27个字符长度的字符串，从26个字母和空格中随机选择一个字符。编写另一个函数，比较随机生成的字符串和目标字符串。第三个函数将反复调用生成和比较函数，那么如果所有目标字母都在随机字符串中出现了，那么就完成了。如果字母没有全部出现，那么会生成一个全新的字符串。</p>
<ol>
<li>第一个函数生成随机字符，从26个字母和空格里；</li>
<li>第二个函数来比较随机生成的字符和目标字符；</li>
<li>第三个函数返回目前为止能匹配上的字符串以及尝试次数。</li>
</ol>
<p>代码示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 实现匹配出所有字符，并非对应所有字符</span></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_chars</span>():</span><br><span class="line">    <span class="comment"># 获取26个字符，使用ASCII码表来定位，并生成列表</span></span><br><span class="line">    chars = [<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">97</span>, <span class="number">123</span>)]</span><br><span class="line">    <span class="comment"># 添加空格至列表</span></span><br><span class="line">    chars.append(<span class="built_in">chr</span>(<span class="number">32</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(random.choice(chars) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">27</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">diff_chars</span>(<span class="params">chars_list, random_chars</span>):</span><br><span class="line">    new_chars_list = <span class="built_in">list</span>()</span><br><span class="line">    [new_chars_list.append(i) <span class="keyword">for</span> i <span class="keyword">in</span> chars_list <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> new_chars_list]</span><br><span class="line">    random_chars_list = <span class="built_in">list</span>()</span><br><span class="line">    [random_chars_list.append(i) <span class="keyword">for</span> i <span class="keyword">in</span> random_chars <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> random_chars_list]</span><br><span class="line"></span><br><span class="line">    successful_chars = <span class="built_in">list</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> new_chars_list:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> random_chars_list:</span><br><span class="line">            successful_chars.append(i)</span><br><span class="line">    score = <span class="string">&#x27;%.2f&#x27;</span> % (<span class="built_in">len</span>(successful_chars) / <span class="built_in">len</span>(new_chars_list) * <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">return</span> score</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_result</span>():</span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    chars = <span class="string">&#x27;methinks it is a weasel&#x27;</span></span><br><span class="line">    chars_list = [i <span class="keyword">for</span> i <span class="keyword">in</span> chars]</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        random_chars = get_chars()</span><br><span class="line">        res = <span class="built_in">float</span>(diff_chars(chars_list, random_chars))</span><br><span class="line">        <span class="comment"># 如果得分为100或次数等于10000则退出</span></span><br><span class="line">        <span class="keyword">if</span> math.isclose(res, <span class="number">100.0</span>, abs_tol=<span class="number">0</span>) <span class="keyword">or</span> num &gt;= <span class="number">10000</span>:</span><br><span class="line">            <span class="built_in">print</span>(num, random_chars)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    get_result()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"></span><br><span class="line"><span class="number">323</span>  wc uhtveaimrzvmbrsbmcnlnky</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/MarkDown%E5%B8%B8%E8%A7%81%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF%E8%A7%A3%E6%9E%90">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/MarkDown%E5%B8%B8%E8%A7%81%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF%E8%A7%A3%E6%9E%90" class="post-title-link" itemprop="url">MarkDown常见语法错误解析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-04 10:45:41" itemprop="dateCreated datePublished" datetime="2022-08-04T10:45:41+08:00">2022-08-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-30 17:45:56" itemprop="dateModified" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>MD001 - Heading levels should only increment by one level at a time</p>
</blockquote>
<p>标题级数只能每次扩大一个，也就是说不能隔级创建标题，必须h1-h2-h3…这样</p>
<blockquote>
<p>MD002 - First heading should be a top level heading</p>
</blockquote>
<p>文档的第一个标题必须是最高级的标题，也就是h1</p>
<blockquote>
<p>MD003 - Heading style</p>
</blockquote>
<p>整篇文档的标题格式要采取统一的</p>
<blockquote>
<p>MD004 - Unordered list style</p>
</blockquote>
<p>整篇文档的无序列表的格式要一致</p>
<blockquote>
<p>MD005 - Inconsistent indentation for list items at the same level</p>
</blockquote>
<p>同一个等级的列表的缩进要一致</p>
<blockquote>
<p>MD006 - Consider starting bulleted lists at the beginning of the line</p>
</blockquote>
<p>一级标题不能够缩进</p>
<blockquote>
<p>MD007 - Unordered list indentation</p>
</blockquote>
<p>无序列表嵌套的时候默认采取两个空格的缩进方式</p>
<blockquote>
<p>MD008 - 无</p>
</blockquote>
<p>Rules</p>
<blockquote>
<p>MD009 - Trailing spaces</p>
</blockquote>
<p>行尾最多可以添加两个空格，超出之后会有警告，最好每次都是两个空格因为两个空格刚好可以用来换行</p>
<blockquote>
<p>MD010 - Hard tabs</p>
</blockquote>
<p>不能使用tab来进行缩进，要使用空格</p>
<blockquote>
<p>MD011 - Reversed link syntax</p>
</blockquote>
<p>内联形式的链接和创建方式是否错误，中括号和圆括号是否使用正确</p>
<blockquote>
<p>MD012 - Multiple consecutive blank lines</p>
</blockquote>
<p>文档中不能有连续的空行（文档末可以有一个空行），在代码块中这个规则不会生效</p>
<blockquote>
<p>MD013 - Line length</p>
</blockquote>
<p>默认行的最大长度是80，对表格代码块标题都起效果</p>
<blockquote>
<p>MD014 - Dollar signs used before commands without showing output</p>
</blockquote>
<p>在代码块中，终端命令前面不需要有美元符号，如果如果代码块中既有终端命令，也有命令的输出，则终端命令前可以有美元符号($)</p>
<blockquote>
<p>MD018 - No space after hash on atx style heading</p>
</blockquote>
<p>标题格式如果是”atx”的话，#号和文字之间需要一个空格隔开</p>
<blockquote>
<p>MD019 - Multiple spaces after hash on atx style heading</p>
</blockquote>
<p>标题格式如果是”atx”的话，#号和文字之间只需要一个空格隔开，不需要多个</p>
<blockquote>
<p>MD020 - No space inside hashes on closed atx style heading</p>
</blockquote>
<p>在closed_atx格式的标题中，文字和前后的#号之间都需要一个空格隔开</p>
<blockquote>
<p>MD021 - Multiple spaces inside hashes on closed atx style heading</p>
</blockquote>
<p>在closed_atx格式的标题中，文字和前后的#号之间只需要一个空格隔开，不能有多余的</p>
<blockquote>
<p>MD022 - Headings should be surrounded by blank lines</p>
</blockquote>
<p>标题的上下行必须都是空格</p>
<blockquote>
<p>MD023 - Headings must start at the beginning of the line</p>
</blockquote>
<p>标题行不能缩进</p>
<blockquote>
<p>MD024 - Multiple headings with the same content</p>
</blockquote>
<p>在文档中不能有重复性的标题</p>
<blockquote>
<p>MD025 - Multiple top level headings in the same document</p>
</blockquote>
<p>同一个文档中，只能有一个最高级的标题，默认也只能有一个一级标题</p>
<blockquote>
<p>MD026 - Trailing punctuation in heading</p>
</blockquote>
<p>标题的末尾不能有”. , ; : ! ? “这些符号</p>
<blockquote>
<p>MD027 - Multiple spaces after blockquote symbol</p>
</blockquote>
<p>在创建引用块的时候，右尖号与文字之间必须有且只有一个空格</p>
<blockquote>
<p>MD028 - Blank line inside blockquote</p>
</blockquote>
<p>两个引用区块间不能仅用一个空行隔开或者同一引用区块中不能有空行，如果一行中没有内容，则这一行要用&gt;开头</p>
<blockquote>
<p>MD029 - Ordered list item prefix</p>
</blockquote>
<p>有序列表的前缀序号格式必须只用1或者从1开始的加1递增数字</p>
<blockquote>
<p>MD030 - Spaces after list markers</p>
</blockquote>
<p>列表（有序、无序）的前缀符号和文字之间用1个空格隔开，在列表嵌套或者同一列表项中有多个段落时，无序列表缩进两个空格，有序列表缩进3个空格</p>
<blockquote>
<p>MD031 - Fenced code blocks should be surrounded by blank lines</p>
</blockquote>
<p>单独的代码块前后需要用空行隔开（除非是在文档开头或末尾），否则有些解释器不会解释为代码块</p>
<blockquote>
<p>MD032 - Lists should be surrounded by blank lines</p>
</blockquote>
<p>列表（有序、无序）前后需要用空行隔开，否则有些解释器不会解释为列表，列表的缩进必须一致，否则会警告</p>
<blockquote>
<p>MD033 - Inline HTML</p>
</blockquote>
<p>文档中不允许使用html语句</p>
<blockquote>
<p>MD034 - Bare URL used</p>
</blockquote>
<p>单纯的链接地址需要用尖括号 (&lt;&gt;) 包裹，否则有些解释器不会解释为链接</p>
<blockquote>
<p>MD035 - Horizontal rule style</p>
</blockquote>
<p>创建水平线时整篇文档要统一，要和文档中第一次创建水平线使用的符号一致</p>
<blockquote>
<p>MD036 - Emphasis used instead of a heading</p>
</blockquote>
<p>不能用强调来代替标题 ****</p>
<blockquote>
<p>MD037 - Spaces inside emphasis markers</p>
</blockquote>
<p>强调的符号和文字之间不能有空格</p>
<blockquote>
<p>MD038 - Spaces inside code span elements</p>
</blockquote>
<p>当用单反引号创建代码段的时候，单反引号和它们之间的代码不能有空格，如果要把单反引号嵌入到代码段的首尾，创建代码段的单反引号和嵌入的单反引号间要有一个空格隔开</p>
<blockquote>
<p>MD039 - Spaces inside link text</p>
</blockquote>
<p>链接名和包围它的中括号之间不能有空格，但链接名中间可以有空格</p>
<blockquote>
<p>MD040 - Fenced code blocks should have a language specified</p>
</blockquote>
<p>单独的代码块（此处是指上下用三个反引号包围的代码块）应该指定代码块的编程语言，这一点有助于解释器对代码进行代码高亮</p>
<blockquote>
<p>MD041 - First line in file should be a top level heading</p>
</blockquote>
<p>文档的第一个非空行应该是文档最高级的标题，默认是1级标题</p>
<blockquote>
<p>MD042 - No empty links</p>
</blockquote>
<p>链接的地址不能为空</p>
<blockquote>
<p>MD043 - Required heading structure</p>
</blockquote>
<p>要求标题遵循一定的结构，默认是没有规定的结构</p>
<blockquote>
<p>MD044 - Proper names should have the correct capitalization</p>
</blockquote>
<p>指定一些名称，会检查它是否有正确的大写</p>
<blockquote>
<p>MD045 - Images should have alternate text (alt text)</p>
</blockquote>
<p>图片链接必须包含描述文本 all文本</p>
<blockquote>
<p>MD046 - Code block style</p>
</blockquote>
<p>整篇文档采用一致的代码格式</p>
<blockquote>
<p>MD047 - Files should end with a single newline character</p>
</blockquote>
<p>文档末尾需要一个空行结尾</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903938165047309">https://juejin.cn/post/6844903938165047309</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/q81RER">https://www.jianshu.com/p/q81RER</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备17063827号-2 </a>
      <img src="https://beian.miit.gov.cn/#/Integrated/index" alt="">
  </div>
  <div class="copyright">
    &copy; 2017 – 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">medivh</span>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
