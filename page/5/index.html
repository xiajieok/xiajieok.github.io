<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://img.econow.cn/2018/1545104669394.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://img.econow.cn/2018/1545104669394.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"econow.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Medivh&#39;s castle">
<meta property="og:url" content="https://econow.cn/page/5/index.html">
<meta property="og:site_name" content="Medivh&#39;s castle">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="medivh">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://econow.cn/page/5/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/5/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Medivh's castle</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?21ded952ca9fc25e2b0630494a17ec7f"></script>







  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Medivh's castle</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">数据蜘蛛工作室</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">medivh</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">95</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">48</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/Python%20%E6%96%87%E4%BB%B6:%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Python%20%E6%96%87%E4%BB%B6:%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C.html" class="post-title-link" itemprop="url">Python 文件/目录操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-31 10:15:08" itemprop="dateCreated datePublished" datetime="2023-10-31T10:15:08+08:00">2023-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
    <span id="/Python%20%E6%96%87%E4%BB%B6:%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C.html" class="post-meta-item leancloud_visitors" data-flag-title="Python 文件/目录操作" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="OS模块"><a href="#OS模块" class="headerlink" title="OS模块"></a>OS模块</h2><h2 id="sqlite-日期"><a href="#sqlite-日期" class="headerlink" title="sqlite 日期"></a>sqlite 日期</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">----昨天</span><br><span class="line">select * from 表 where Time&gt;=datetime(&#x27;now&#x27;,&#x27;start of day&#x27;,&#x27;-1 day&#x27;) and Time&lt;datetime(&#x27;now&#x27;,&#x27;start of day&#x27;,&#x27;+0 day&#x27;)</span><br><span class="line"></span><br><span class="line">----当天</span><br><span class="line">select * from 表 where Time&gt;=datetime(&#x27;now&#x27;,&#x27;start of day&#x27;,&#x27;+0 day&#x27;) and Time&lt;datetime(&#x27;now&#x27;,&#x27;start of day&#x27;,&#x27;+1 day&#x27;)</span><br><span class="line"></span><br><span class="line">----当周</span><br><span class="line">select  * from 表 where Time&gt;=datetime(&#x27;now&#x27;,&#x27;start of day&#x27;,&#x27;-7 day&#x27;,&#x27;weekday 1&#x27;) AND Time&lt;datetime(&#x27;now&#x27;,&#x27;start of day&#x27;,&#x27;+0 day&#x27;,&#x27;weekday 1&#x27;)</span><br><span class="line"></span><br><span class="line">----当月</span><br><span class="line">select * from 表 where Time&gt;=datetime(&#x27;now&#x27;,&#x27;start of month&#x27;,&#x27;+0 month&#x27;,&#x27;-0 day&#x27;) AND Time &lt; datetime(&#x27;now&#x27;,&#x27;start of month&#x27;,&#x27;+1 month&#x27;,&#x27;0 day&#x27;)</span><br><span class="line"></span><br><span class="line">----上月</span><br><span class="line">select * from 表 where Time&gt;=datetime(&#x27;now&#x27;,&#x27;start of month&#x27;,&#x27;-1 month&#x27;,&#x27;-0 day&#x27;) AND Time &lt;datetime(&#x27;now&#x27;,&#x27;start of month&#x27;,&#x27;+0 month&#x27;,&#x27;-1 day&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/OpenVpn%20%E6%9C%80%E6%96%B0%E7%89%88%E9%83%A8%E7%BD%B2.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/OpenVpn%20%E6%9C%80%E6%96%B0%E7%89%88%E9%83%A8%E7%BD%B2.html" class="post-title-link" itemprop="url">OpenVpn 最新版部署</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-31 10:15:08" itemprop="dateCreated datePublished" datetime="2023-10-31T10:15:08+08:00">2023-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span id="/OpenVpn%20%E6%9C%80%E6%96%B0%E7%89%88%E9%83%A8%E7%BD%B2.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenVpn 最新版部署" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="1、yum方式（推荐）"><a href="#1、yum方式（推荐）" class="headerlink" title="1、yum方式（推荐）"></a>1、yum方式（推荐）</h3><p>推荐使用yum方式安装，因为之前曾经发生过莫名其妙服务自己停止的情况。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install openvpn open-ssl -y</span><br><span class="line">yum install easy-rsa openssl  -y</span><br></pre></td></tr></table></figure>
<h3 id="2、编译安装"><a href="#2、编译安装" class="headerlink" title="2、编译安装"></a>2、编译安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yum install pam-devel open-ssl -y</span><br><span class="line"></span><br><span class="line">cd /usr/src</span><br><span class="line">wget http://www.oberhumer.com/opensource/lzo/download/lzo-2.06.tar.gz</span><br><span class="line">tar zxvf lzo-2.06.tar.gz</span><br><span class="line">cd lzo-2.06</span><br><span class="line">./configure --prefix=/usr/local/</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">cd /usr/src</span><br><span class="line">tar -zxvf openvpn-2.4.6.tar.gz</span><br><span class="line"> cd openvpn-2.4.6</span><br><span class="line">./configure --prefix=/usr/local/openvpn --with-lzo-lib=/usr/local/lzo/lib --with-lzo-headers=/usr/local/lzo/include/</span><br></pre></td></tr></table></figure>
<h2 id="证书配置"><a href="#证书配置" class="headerlink" title="证书配置"></a>证书配置</h2><p>当前配置是按照编译安装的目录，yum安装目录在&#x2F;etc&#x2F;openvpn</p>
<h3 id="创建-PKI-和-CA"><a href="#创建-PKI-和-CA" class="headerlink" title="创建 PKI 和 CA"></a>创建 PKI 和 CA</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@localhost 3.0.3]# pwd</span><br><span class="line">/etc/openvpn/server</span><br><span class="line">[root@localhost 3.0.3]# cp -r  /usr/share/easy-rsa .</span><br><span class="line">[root@localhost 3.0.3]# rm 3 3.0 </span><br><span class="line">[root@localhost 3.0.3]# cd /etc/openvpn/server/easy-rsa/3.0.3</span><br><span class="line">[root@localhost 3.0.3]# ./easyrsa init-pki  #创建空的pki</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line"></span><br><span class="line">init-pki complete; you may now create a CA or requests.</span><br><span class="line">Your newly created PKI dir is: /etc/openvpn/easy-rsa/3.0.3/pki</span><br><span class="line"></span><br><span class="line">[root@localhost 3.0.3]# ./easyrsa build-ca nopass #创建新的CA，不使用密码</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line">Generating a 2048 bit RSA private key</span><br><span class="line">......................+++</span><br><span class="line">................................................+++</span><br><span class="line">writing new private key to &#x27;/etc/openvpn/easy-rsa/3.0.3/pki/private/ca.key.pClvaQ1GLD&#x27;</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#x27;.&#x27;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Common Name (eg: your user, host, or server name) [Easy-RSA CA]: 回车</span><br><span class="line"></span><br><span class="line">CA creation complete and you may now import and sign cert requests.</span><br><span class="line">Your new CA certificate file for publishing is at:</span><br><span class="line">/etc/openvpn/easy-rsa/3.0.3/pki/ca.crt</span><br></pre></td></tr></table></figure>
<h4 id="创建服务端证书"><a href="#创建服务端证书" class="headerlink" title="创建服务端证书"></a>创建服务端证书</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost 3.0.3]# ./easyrsa gen-req server nopass</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line">Generating a 2048 bit RSA private key</span><br><span class="line">...........................+++</span><br><span class="line">..............................................................................+++</span><br><span class="line">writing new private key to &#x27;/etc/openvpn/easy-rsa/3.0.3/pki/private/server.key.wy7Q0fuG6A&#x27;</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#x27;.&#x27;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Common Name (eg: your user, host, or server name) [server]: 回车</span><br><span class="line"></span><br><span class="line">Keypair and certificate request completed. Your files are:</span><br><span class="line">req: /etc/openvpn/easy-rsa/3.0.3/pki/reqs/server.req</span><br><span class="line">key: /etc/openvpn/easy-rsa/3.0.3/pki/private/server.key</span><br></pre></td></tr></table></figure>
<h4 id="签约服务端证书"><a href="#签约服务端证书" class="headerlink" title="签约服务端证书"></a>签约服务端证书</h4><p>注意操作目录是在server目录里的  <code>/etc/openvpn/server/easy-rsa/3.0.3</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost 3.0.3]# ./easyrsa sign server server</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">You are about to sign the following certificate.</span><br><span class="line">Please check over the details shown below for accuracy. Note that this request</span><br><span class="line">has not been cryptographically verified. Please be sure it came from a trusted</span><br><span class="line">source or that you have verified the request checksum with the sender.</span><br><span class="line"></span><br><span class="line">Request subject, to be signed as a server certificate for 3650 days:</span><br><span class="line"></span><br><span class="line">subject=</span><br><span class="line">    commonName                = server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Type the word &#x27;yes&#x27; to continue, or any other input to abort.</span><br><span class="line">  Confirm request details: yes</span><br><span class="line">Using configuration from ./openssl-1.0.cnf</span><br><span class="line">Check that the request matches the signature</span><br><span class="line">Signature ok</span><br><span class="line">The Subject&#x27;s Distinguished Name is as follows</span><br><span class="line">commonName            :ASN.1 12:&#x27;server&#x27;</span><br><span class="line">Certificate is to be certified until Apr  7 14:54:08 2028 GMT (3650 days)</span><br><span class="line"></span><br><span class="line">Write out database with 1 new entries</span><br><span class="line">Data Base Updated</span><br><span class="line"></span><br><span class="line">Certificate created at: /etc/openvpn/easy-rsa/3.0.3/pki/issued/server.crt</span><br></pre></td></tr></table></figure>
<h4 id="创建-Diffie-Hellman"><a href="#创建-Diffie-Hellman" class="headerlink" title="创建 Diffie-Hellman"></a>创建 Diffie-Hellman</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost 3.0.3]# ./easyrsa gen-dh</span><br><span class="line">............................................................</span><br><span class="line">DH parameters of size 2048 created at /etc/openvpn/easy-rsa/3.0.3/pki/dh.pem</span><br></pre></td></tr></table></figure>
<h3 id="创建客户端证书"><a href="#创建客户端证书" class="headerlink" title="创建客户端证书"></a>创建客户端证书</h3><h4 id="复制文件"><a href="#复制文件" class="headerlink" title="复制文件"></a>复制文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp -r /usr/share/easy-rsa/ /etc/openvpn/client/easy-rsa</span><br><span class="line">cd /etc/openvpn/client/easy-rsa/</span><br><span class="line">rm 3 3.0</span><br><span class="line">cd 3.0.3/</span><br><span class="line">find /usr/share/doc/easy-rsa-3.0.3/vars.example -type f -name &quot;vars.example&quot; | xargs -i cp &#123;&#125; . &amp;&amp; mv vars.example vars</span><br></pre></td></tr></table></figure>
<h4 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h4><p>操作目录 <code>/etc/openvpn/server/easy-rsa/3.0.3</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost 3.0.3]# pwd</span><br><span class="line">/etc/openvpn/client/easy-rsa/3.0.3</span><br><span class="line">[root@localhost 3.0.3]# ./easyrsa init-pki #创建新的pki</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line"></span><br><span class="line">init-pki complete; you may now create a CA or requests.</span><br><span class="line">Your newly created PKI dir is: /etc/openvpn/client/easy-rsa/3.0.3/pki</span><br><span class="line">[root@localhost 3.0.3]# ./easyrsa gen-req joy01 nopass  #客户证书名为joy01，木有密码</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line">Generating a 2048 bit RSA private key</span><br><span class="line">....................................................+++</span><br><span class="line">............+++</span><br><span class="line">writing new private key to &#x27;/etc/openvpn/client/easy-rsa/3.0.3/pki/private/joy01.key.FkrLzXH9Bm&#x27;</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#x27;.&#x27;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Common Name (eg: your user, host, or server name) [joy01]: 回车</span><br><span class="line"></span><br><span class="line">Keypair and certificate request completed. Your files are:</span><br><span class="line">req: /etc/openvpn/client/easy-rsa/3.0.3/pki/reqs/joy01.req</span><br><span class="line">key: /etc/openvpn/client/easy-rsa/3.0.3/pki/private/joy01.key</span><br></pre></td></tr></table></figure>
<h4 id="签约客户端证书"><a href="#签约客户端证书" class="headerlink" title="签约客户端证书"></a>签约客户端证书</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost 3.0.3]# cd /etc/openvpn/server/easy-rsa/3.0.3/</span><br><span class="line">[root@localhost 3.0.3]# pwd</span><br><span class="line">/etc/openvpn/server/easy-rsa/3.0.3</span><br><span class="line">[root@localhost 3.0.3]# ./easyrsa import-req /etc/openvpn/client/easy-rsa/3.0.3/pki/reqs/joy01.req joy01</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line"></span><br><span class="line">The request has been successfully imported with a short name of: joy01</span><br><span class="line">You may now use this name to perform signing operations on this request.</span><br><span class="line"></span><br><span class="line">[root@localhost 3.0.3]# ./easyrsa sign client joy01</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">You are about to sign the following certificate.</span><br><span class="line">Please check over the details shown below for accuracy. Note that this request</span><br><span class="line">has not been cryptographically verified. Please be sure it came from a trusted</span><br><span class="line">source or that you have verified the request checksum with the sender.</span><br><span class="line"></span><br><span class="line">Request subject, to be signed as a client certificate for 3650 days:</span><br><span class="line"></span><br><span class="line">subject=</span><br><span class="line">    commonName                = joy01</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Type the word &#x27;yes&#x27; to continue, or any other input to abort.</span><br><span class="line">  Confirm request details: yes</span><br><span class="line">Using configuration from ./openssl-1.0.cnf</span><br><span class="line">Check that the request matches the signature</span><br><span class="line">Signature ok</span><br><span class="line">The Subject&#x27;s Distinguished Name is as follows</span><br><span class="line">commonName            :ASN.1 12:&#x27;joy01&#x27;</span><br><span class="line">Certificate is to be certified until Apr  8 01:54:57 2028 GMT (3650 days)</span><br><span class="line"></span><br><span class="line">Write out database with 1 new entries</span><br><span class="line">Data Base Updated</span><br><span class="line"></span><br><span class="line">Certificate created at: /etc/openvpn/easy-rsa/3.0.3/pki/issued/joy01.crt</span><br></pre></td></tr></table></figure>
<h3 id="整理证书"><a href="#整理证书" class="headerlink" title="整理证书"></a>整理证书</h3><h4 id="server-端证书"><a href="#server-端证书" class="headerlink" title="server 端证书"></a>server 端证书</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir /etc/openvpn/certs</span><br><span class="line">[root@localhost ~]# cd /etc/openvpn/certs/</span><br><span class="line">[root@localhost certs]# cp /etc/openvpn/easy-rsa/3.0.3/pki/dh.pem .</span><br><span class="line">[root@localhost certs]# cp /etc/openvpn/easy-rsa/3.0.3/pki/ca.crt .</span><br><span class="line">[root@localhost certs]# cp /etc/openvpn/easy-rsa/3.0.3/pki/issued/server.crt .</span><br><span class="line">[root@localhost certs]# cp /etc/openvpn/easy-rsa/3.0.3/pki/private/server.key .</span><br><span class="line">[root@localhost certs]# ll</span><br><span class="line">总用量 20</span><br><span class="line">-rw-------. 1 root root 1172 4月  11 10:02 ca.crt</span><br><span class="line">-rw-------. 1 root root  424 4月  11 10:03 dh.pem</span><br><span class="line">-rw-------. 1 root root 4547 4月  11 10:03 server.crt</span><br><span class="line">-rw-------. 1 root root 1704 4月  11 10:02 server.key</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="client-端"><a href="#client-端" class="headerlink" title="client 端"></a>client 端</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost certs]# mkdir /etc/openvpn/client/joy01/</span><br><span class="line">[root@localhost certs]# cp /etc/openvpn/easy-rsa/3.0.3/pki/ca.crt /etc/openvpn/client/joy01/</span><br><span class="line">[root@localhost certs]# cp /etc/openvpn/easy-rsa/3.0.3/pki/issued/joy01.crt /etc/openvpn/client/joy01/</span><br><span class="line">[root@localhost certs]# cp /etc/openvpn/client/easy-rsa/3.0.3/pki/private/joy01.key /etc/openvpn/client/joy01/</span><br><span class="line">[root@localhost certs]# ll /etc/openvpn/client/joy01/</span><br><span class="line">总用量 16</span><br><span class="line">-rw-------. 1 root root 1172 4月  11 10:07 ca.crt</span><br><span class="line">-rw-------. 1 root root 4431 4月  11 10:08 joy01.crt</span><br><span class="line">-rw-------. 1 root root 1704 4月  11 10:08 joy01.key</span><br></pre></td></tr></table></figure>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h3><p>一切操作只需要在服务器，client不需要！！！</p>
<h4 id="开启转发"><a href="#开启转发" class="headerlink" title="开启转发"></a>开启转发</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;net.ipv4.ip_forward = 1&#x27; &gt;&gt; /etc/sysctl.conf</span><br></pre></td></tr></table></figure>
<p>验证</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>
<img src="https://img.econow.cn/2018/1544336390853.png" width="262"/> 

<h4 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h4><p>清空防火墙</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">ipatbles -Z</span><br></pre></td></tr></table></figure>
<p>接下来的配置之前需要先了解以下概念：</p>
<ul>
<li><p>NAT 的原理 简单的说就是当内网主机访问外网时，当内网主机的数据包要通过路由器时，路由器将数据包中的源内网 IP 地址改为路由器上的公网 IP 地址，同时记录下该数据包的消息；当外网服务器响应这次由内而外发出的请求或数据交换时，当外网服务器发出的数据包经过路由器时，原本是路由器上的公网 IP 地址被路由器改为内网 IP 。</p>
<ul>
<li>SNAT是source networkaddress translation的缩写，即源地址目标转换。比如，多个PC机使用ADSL路由器共享上网，每个PC机都配置了内网IP，PC机访问外部网络的时候，路由器将数据包的报头中的源地址替换成路由器的ip，当外部网络的服务器比如网站web服务器接到访问请求的时候，他的日志记录下来的是路由器的ip地址，而不是pc机的内网ip，这是因为，这个服务器收到的数据包的报头里边的“源地址”，已经被替换了，所以叫做SNAT，基于源地址的地址转换。  </li>
<li>DNAT是destination networkaddress translation的缩写，即目标网络地址转换，典型的应用是，有个web服务器放在内网配置内网ip，前端有个防火墙配置公网ip，互联网上的访问者使用公网ip来访问这个网站，当访问的时候，客户端发出一个数据包，这个数据包的报头里边，目标地址写的是防火墙的公网ip，防火墙会把这个数据包的报头改写一次，将目标地址改写成web服务器的内网ip，然后再把这个数据包发送到内网的web服务器上，这样，数据包就穿透了防火墙，并从公网ip变成了一个对内网地址的访问了，即DNAT，基于目标的网络地址转换。</li>
<li>MASQUERADE，地址伪装，属于nat的一种。算是snat中的一种特例，可以实现自动化的snat。MASQUERADE是用发送数据的网卡上的IP来替换源IP，因此，对于那些IP不固定的场合，比如拨号网络或者通过dhcp分配IP的情况下，就得用MASQUERADE。</li>
</ul>
</li>
<li><p>如果内网主机访问外网而经过路由时，源 IP 会发生改变，这种变更行为就是 SNAT；反之，当外网的数据经过路由发往内网主机时，数据包中的目的 IP (路由器上的公网 IP) 将修改为内网 IP，这种变更行为就是 DNAT 。与 SNAT 和 DNAT所对应的两个链分别是  POSTROUTING和PREROUTING。</p>
<ul>
<li>POSTROUTING是源地址转换，要把你的内网地址转换成公网地址才能让你上网。</li>
<li>PREROUTING是目的地址转换，要把别人的公网IP换成你们内部的IP，才让访问到你们内部受防火墙保护的机器</li>
</ul>
</li>
</ul>
<p>综上所述，简单理解就是从服务器网卡获取当前IP来做SNAT。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">iptables -A FORWARD -s 172.16.0.0/24 -j ACCEPT  </span><br><span class="line">iptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT  </span><br><span class="line"></span><br><span class="line">#检查</span><br><span class="line">iptables  -t  nat  -nL</span><br><span class="line"></span><br><span class="line">#转发</span><br><span class="line">iptables -t nat -A POSTROUTING -s 172.16.0.0/24  -j MASQUERADE</span><br><span class="line">  or</span><br><span class="line">iptables -t nat -A POSTROUTING -s 172.16.0.0/24 -o eth0 -j MASQUERADE</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>检查FORWARD<br><img src="https://img.econow.cn/2018/1544336486389.png" width="716"/></p>
<p>检查MASQUERADE<br><img src="https://img.econow.cn/2018/1544336462517.png" width="480"/>  </p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><h4 id="server端"><a href="#server端" class="headerlink" title="server端"></a>server端</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">port 1194</span><br><span class="line">proto udp</span><br><span class="line">dev tun</span><br><span class="line">ca ca.crt</span><br><span class="line">cert server.crt</span><br><span class="line">key server.key</span><br><span class="line">dh dh.pem</span><br><span class="line">server 172.16.0.0 255.255.255.0</span><br><span class="line">ifconfig-pool-persist ipp.txt</span><br><span class="line">client-config-dir ccd</span><br><span class="line">push &quot;redirect-gateway def1 bypass-dhcp&quot;</span><br><span class="line">push &quot;dhcp-option DNS 208.67.222.222&quot;</span><br><span class="line">push &quot;dhcp-option DNS 208.67.220.220&quot;</span><br><span class="line">client-to-client</span><br><span class="line">duplicate-cn</span><br><span class="line">keepalive 10 120</span><br><span class="line"></span><br><span class="line">;cipher BF-CBC</span><br><span class="line">;cipher AES-128-CBC</span><br><span class="line">;cipher DES-EDE3-CBC</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">comp-lzo</span><br><span class="line">;max-clients 100</span><br><span class="line">log         openvpn.log</span><br><span class="line">status openvpn-status.log</span><br><span class="line">verb 3</span><br><span class="line">mute 20</span><br></pre></td></tr></table></figure>
<blockquote>
<p>“redirect-gateway def1 bypass-dhcp”的目的是在所有客戶端的默认网络都重定向到服务器,它的目的就是客户端在使用不同的私有地址时可以确保能连上OpenVPN服务器。<br>但是如果有时候客户端无法正常上网，那么就得换种方式。<code>push &quot;route 10.110.1.0 255.255.255.0&quot;</code>就像这样推送服务器的路由。  </p>
</blockquote>
<p>如果想使用固定IP，那么就开启<code>&quot;client-config-dir ccd&quot;</code></p>
<ul>
<li>在服务器端创建ccd目录</li>
<li>按照用户名创建文件，类似”ifconfig-push 10.8.0.18 255.255.255.0”</li>
</ul>
<h4 id="client端"><a href="#client端" class="headerlink" title="client端"></a>client端</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">client</span><br><span class="line">dev tun</span><br><span class="line">proto udp</span><br><span class="line">remote 服务器外网IP</span><br><span class="line">resolv-retry infinite</span><br><span class="line">nobind</span><br><span class="line">user nobody</span><br><span class="line">group nobody</span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line">ca ca.crt</span><br><span class="line">cert xiajie.crt</span><br><span class="line">key xiajie.key</span><br><span class="line">comp-lzo</span><br><span class="line">verb 3</span><br><span class="line">redirect-gateway def1</span><br></pre></td></tr></table></figure>

<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl -f enable openvpn@server</span><br><span class="line">systemctl start openvpn@server</span><br></pre></td></tr></table></figure>
<h2 id="服务检查"><a href="#服务检查" class="headerlink" title="服务检查"></a>服务检查</h2><h3 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h3><img src="https://img.econow.cn/2018/1544337135904.png" width="668"/>
### 客户端（Windows）

<img src="https://img.econow.cn/2018/1544337254592.png" width="642"/>


<h2 id="疑难杂症"><a href="#疑难杂症" class="headerlink" title="疑难杂症"></a>疑难杂症</h2><ul>
<li>客户端直接无法访问，虚拟IP不通，内网不通<br>检查服务器端配置文件<code>client-to-client</code></li>
<li>如果还是不通，或者无法访问外网，检查<code>push &quot;redirect-gateway def1 bypass-dhcp&quot;</code>是否注释或者有没有推送路由。  </li>
<li>如果追求速度就选择UDP，如果选择可靠质量就选择TCP。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/OpenFalcon%20CentOS%207.2%E9%83%A8%E7%BD%B2.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/OpenFalcon%20CentOS%207.2%E9%83%A8%E7%BD%B2.html" class="post-title-link" itemprop="url">OpenFalcon CentOS 7.2部署</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-31 10:15:08" itemprop="dateCreated datePublished" datetime="2023-10-31T10:15:08+08:00">2023-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span id="/OpenFalcon%20CentOS%207.2%E9%83%A8%E7%BD%B2.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenFalcon CentOS 7.2部署" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>OpenFalcon是一款企业级、高可用、可扩展的开源监控解决方案。</p>
<img src="https://img.econow.cn/2018/1539584391262.png" width="1013"/>

<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>当前平台相关组件部署在OAM主机，其余主机均部署agent.</p>
<h3 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y redis</span><br></pre></td></tr></table></figure>
<h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><h4 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y mysql-server</span><br></pre></td></tr></table></figure>
<h4 id="初始化MySQL表结构"><a href="#初始化MySQL表结构" class="headerlink" title="初始化MySQL表结构"></a>初始化MySQL表结构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp/ &amp;&amp; git clone https://github.com/open-falcon/falcon-plus.git</span><br><span class="line">cd /tmp/falcon-plus/scripts/mysql/db_schema/</span><br><span class="line">mysql -h 127.0.0.1 -u root -pYmQwODk2Y2I0ZmVm &lt; 1_uic-db-schema.sql</span><br><span class="line">mysql -h 127.0.0.1 -u root -pYmQwODk2Y2I0ZmVm &lt; 2_portal-db-schema.sql</span><br><span class="line">mysql -h 127.0.0.1 -u root -pYmQwODk2Y2I0ZmVm &lt; 3_dashboard-db-schema.sql</span><br><span class="line">mysql -h 127.0.0.1 -u root -pYmQwODk2Y2I0ZmVm &lt; 4_graph-db-schema.sql</span><br><span class="line">mysql -h 127.0.0.1 -u root -pYmQwODk2Y2I0ZmVm &lt; 5_alarms-db-schema.sql</span><br><span class="line">rm -rf /tmp/falcon-plus/</span><br></pre></td></tr></table></figure>
<p>注意，请确保redis和MySQL已启动。</p>
<h2 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h2><h3 id="创建工作目录"><a href="#创建工作目录" class="headerlink" title="创建工作目录"></a>创建工作目录</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export FALCON_HOME=/usr/local</span><br><span class="line">export WORKSPACE=$FALCON_HOME/open-falcon</span><br><span class="line">mkdir -p $WORKSPAC</span><br><span class="line">tar -xzvf open-falcon-v0.2.0.tar.gz -C $WORKSPACE</span><br></pre></td></tr></table></figure>
<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><p>修改所有组件的MySQL信息root:password</p>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cd $WORKSPACE</span><br><span class="line">./open-falcon start</span><br><span class="line"></span><br><span class="line"># 检查所有模块的启动状况</span><br><span class="line">./open-falcon check</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ./open-falcon [start|stop|restart|check|monitor|reload] module</span><br><span class="line">./open-falcon start agent</span><br><span class="line"></span><br><span class="line">./open-falcon check</span><br><span class="line">        falcon-graph         UP           53007</span><br><span class="line">          falcon-hbs         UP           53014</span><br><span class="line">        falcon-judge         UP           53020</span><br><span class="line">     falcon-transfer         UP           53026</span><br><span class="line">       falcon-nodata         UP           53032</span><br><span class="line">   falcon-aggregator         UP           53038</span><br><span class="line">        falcon-agent         UP           53044</span><br><span class="line">      falcon-gateway         UP           53050</span><br><span class="line">          falcon-api         UP           53056</span><br><span class="line">        falcon-alarm         UP           53063</span><br><span class="line"></span><br><span class="line">For debugging , You can check $WorkDir/$moduleName/log/logs/xxx.log</span><br></pre></td></tr></table></figure>
<h2 id="Agent"><a href="#Agent" class="headerlink" title="Agent"></a>Agent</h2><h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><p>agent用于采集机器负载监控指标，比如cpu.idle、load.1min、disk.io.util等等，每隔60秒push给Transfer。agent与Transfer建立了长连接，数据发送速度比较快，agent提供了一个http接口&#x2F;v1&#x2F;push用于接收用户手工push的一些数据，然后通过长连接迅速转发给Transfer。</p>
<h3 id="部署说明"><a href="#部署说明" class="headerlink" title="部署说明"></a>部署说明</h3><p>agent需要部署到所有要被监控的机器上，比如公司有10万台机器，那就要部署10万个agent。agent本身资源消耗很少，不用担心。</p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;debug&quot;: true,  # 控制一些debug信息的输出，生产环境通常设置为false</span><br><span class="line">    &quot;hostname&quot;: &quot;&quot;, # agent采集了数据发给transfer，endpoint就设置为了hostname，默认通过`hostname`获取，如果配置中配置了hostname，就用配置中的</span><br><span class="line">    &quot;ip&quot;: &quot;&quot;, # agent与hbs心跳的时候会把自己的ip地址发给hbs，agent会自动探测本机ip，如果不想让agent自动探测，可以手工修改该配置</span><br><span class="line">    &quot;plugin&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: false, # 默认不开启插件机制</span><br><span class="line">        &quot;dir&quot;: &quot;./plugin&quot;,  # 把放置插件脚本的git repo clone到这个目录</span><br><span class="line">        &quot;git&quot;: &quot;https://github.com/open-falcon/plugin.git&quot;, # 放置插件脚本的git repo地址</span><br><span class="line">        &quot;logs&quot;: &quot;./logs&quot; # 插件执行的log，如果插件执行有问题，可以去这个目录看log</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;heartbeat&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,  # 此处enabled要设置为true</span><br><span class="line">        &quot;addr&quot;: &quot;127.0.0.1:6030&quot;, # hbs的地址，端口是hbs的rpc端口</span><br><span class="line">        &quot;interval&quot;: 60, # 心跳周期，单位是秒</span><br><span class="line">        &quot;timeout&quot;: 1000 # 连接hbs的超时时间，单位是毫秒</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;transfer&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;addrs&quot;: [</span><br><span class="line">            &quot;127.0.0.1:18433&quot;</span><br><span class="line">        ],  # transfer的地址，端口是transfer的rpc端口, 可以支持写多个transfer的地址，agent会保证HA</span><br><span class="line">        &quot;interval&quot;: 60, # 采集周期，单位是秒，即agent一分钟采集一次数据发给transfer</span><br><span class="line">        &quot;timeout&quot;: 1000 # 连接transfer的超时时间，单位是毫秒</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;http&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,  # 是否要监听http端口</span><br><span class="line">        &quot;listen&quot;: &quot;:1988&quot;,</span><br><span class="line">        &quot;backdoor&quot;: false</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;collector&quot;: &#123;</span><br><span class="line">        &quot;ifacePrefix&quot;: [&quot;eth&quot;, &quot;em&quot;], # 默认配置只会采集网卡名称前缀是eth、em的网卡流量，配置为空就会采集所有的，lo的也会采集。可以从/proc/net/dev看到各个网卡的流量信息</span><br><span class="line">        &quot;mountPoint&quot;: []</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;default_tags&quot;: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;ignore&quot;: &#123;  # 默认采集了200多个metric，可以通过ignore设置为不采集</span><br><span class="line">        &quot;cpu.busy&quot;: true,</span><br><span class="line">        &quot;df.bytes.free&quot;: true,</span><br><span class="line">        &quot;df.bytes.total&quot;: true,</span><br><span class="line">        &quot;df.bytes.used&quot;: true,</span><br><span class="line">        &quot;df.bytes.used.percent&quot;: true,</span><br><span class="line">        &quot;df.inodes.total&quot;: true,</span><br><span class="line">        &quot;df.inodes.free&quot;: true,</span><br><span class="line">        &quot;df.inodes.used&quot;: true,</span><br><span class="line">        &quot;df.inodes.used.percent&quot;: true,</span><br><span class="line">        &quot;mem.memtotal&quot;: true,</span><br><span class="line">        &quot;mem.memused&quot;: true,</span><br><span class="line">        &quot;mem.memused.percent&quot;: true,</span><br><span class="line">        &quot;mem.memfree&quot;: true,</span><br><span class="line">        &quot;mem.swaptotal&quot;: true,</span><br><span class="line">        &quot;mem.swapused&quot;: true,</span><br><span class="line">        &quot;mem.swapfree&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="进程管理"><a href="#进程管理" class="headerlink" title="进程管理"></a>进程管理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./open-falcon start agent  启动进程</span><br><span class="line">./open-falcon stop agent  停止进程</span><br><span class="line">./open-falcon monitor agent  查看日志</span><br><span class="line">./falcon-agent --check 健康检查，或者浏览器访问其1988端口</span><br></pre></td></tr></table></figure>
<h2 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h2><h3 id="克隆前端组件代码"><a href="#克隆前端组件代码" class="headerlink" title="克隆前端组件代码"></a>克隆前端组件代码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd $WORKSPACE</span><br><span class="line">git clone https://github.com/open-falcon/dashboard.git</span><br></pre></td></tr></table></figure>
<h3 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yum install -y python-virtualenv</span><br><span class="line">yum install -y python-devel</span><br><span class="line">yum install -y openldap-devel</span><br><span class="line">yum install -y mysql-devel</span><br><span class="line">yum groupinstall &quot;Development tools&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd $WORKSPACE/dashboard/</span><br><span class="line">virtualenv ./env</span><br><span class="line"></span><br><span class="line">./env/bin/pip install -r pip_requirements.txt -i https://pypi.douban.com/simple</span><br></pre></td></tr></table></figure>
<h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dashboard的配置文件为： &#x27;rrd/config.py&#x27;，请根据实际情况修改</span><br><span class="line"></span><br><span class="line">## API_ADDR 表示后端api组件的地址</span><br><span class="line">API_ADDR = &quot;http://127.0.0.1:8080/api/v1&quot;</span><br><span class="line"></span><br><span class="line">## 根据实际情况，修改PORTAL_DB_*, 默认用户名为root，默认密码为&quot;&quot;</span><br><span class="line">## 根据实际情况，修改ALARM_DB_*, 默认用户名为root，默认密码为&quot;&quot;</span><br></pre></td></tr></table></figure>
<h3 id="启动-1"><a href="#启动-1" class="headerlink" title="启动"></a>启动</h3><h4 id="开发者模式启动"><a href="#开发者模式启动" class="headerlink" title="开发者模式启动"></a>开发者模式启动</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./env/bin/python wsgi.py</span><br><span class="line"></span><br><span class="line">open http://127.0.0.1:8081 in your browser.</span><br></pre></td></tr></table></figure>
<h4 id="生产环境启动"><a href="#生产环境启动" class="headerlink" title="生产环境启动"></a>生产环境启动</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash control start</span><br><span class="line"></span><br><span class="line">open http://127.0.0.1:8081 in your browser.</span><br></pre></td></tr></table></figure>
<h3 id="停止dashboard运行"><a href="#停止dashboard运行" class="headerlink" title="停止dashboard运行"></a>停止dashboard运行</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash control stop</span><br></pre></td></tr></table></figure>
<h3 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash control tail</span><br></pre></td></tr></table></figure>
<h3 id="dashbord用户管理"><a href="#dashbord用户管理" class="headerlink" title="dashbord用户管理"></a>dashbord用户管理</h3><p>dashbord没有默认创建任何账号包括管理账号，需要你通过页面进行注册账号。<br>想拥有管理全局的超级管理员账号，需要手动注册用户名为root的账号（第一个帐号名称为root的用户会被自动设置为超级管理员）。<br>超级管理员可以给普通用户分配权限管理。</p>
<blockquote>
<p>小提示：注册账号能够被任何打开dashboard页面的人注册，所以当给相关的人注册完账号后，需要去关闭注册账号功能。只需要去修改api组件的配置文件cfg.json，将signup_disable配置项修改为true，重启api即可。当需要给人开账号的时候，再将配置选项改回去，用完再关掉即可。</p>
</blockquote>
<h2 id="初次使用"><a href="#初次使用" class="headerlink" title="初次使用"></a>初次使用</h2><h3 id="注册管理员账号"><a href="#注册管理员账号" class="headerlink" title="注册管理员账号"></a>注册管理员账号</h3><p>访问dashboard主机8081端口，点击”sign up”<br><img src="https://img.econow.cn/2018/1539585168733.png" width="1229"/></p>
<p>用户名必须为root</p>
<img src="https://img.econow.cn/2018/1539585230624.png" width="397"/>

<h3 id="个人信息维护"><a href="#个人信息维护" class="headerlink" title="个人信息维护"></a>个人信息维护</h3><p>注意填写邮箱地址和IM信息，IM部分可以写微信号，这些信息为以后的报警通知使用。<br><img src="https://img.econow.cn/2018/1539585311738.png" width="1232"/></p>
<h3 id="Dashboard-使用介绍"><a href="#Dashboard-使用介绍" class="headerlink" title="Dashboard 使用介绍"></a>Dashboard 使用介绍</h3><ul>
<li>左边的侧边栏会显示所有加入的agent主机，或者自定义的endpoint。</li>
<li>右中间位置limit50表示显示50行内容，可以自行选择。</li>
<li>右下方是endpiont的监控项目，选中后点击看图即可画图。</li>
</ul>
<img src="https://img.econow.cn/2018/1539585454798.png" width="1229"/>
### 画图示例
1、选中监控项，点击选择看图视角
<img src="https://img.econow.cn/2018/1539585659674.png" width="794"/>
2、这样图就出来啦
<img src="https://img.econow.cn/2018/1539585675701.png" width="1226"/>

<p>另外还可以自定义screen，此处不再具体介绍</p>
<h2 id="hostgroup"><a href="#hostgroup" class="headerlink" title="hostgroup"></a>hostgroup</h2><p>简单说就是主机组，然后绑定模板<br>hostgroup-》Add host</p>
<h2 id="template"><a href="#template" class="headerlink" title="template"></a>template</h2><p>Like this.</p>
<img src="https://img.econow.cn/2018/1539589162286.png" width="1222"/>

<h2 id="监控使用"><a href="#监控使用" class="headerlink" title="监控使用"></a>监控使用</h2><p>参考  <a target="_blank" rel="noopener" href="http://book.open-falcon.org/zh_0_2/usage/getting-started.html">http://book.open-falcon.org/zh_0_2&#x2F;usage&#x2F;getting-started.html</a></p>
<h2 id="报警组件"><a href="#报警组件" class="headerlink" title="报警组件"></a>报警组件</h2><p>报警部分分为邮件和微信报警，其中微信报警。启动邮件报警部分有点特殊，因为阿里云机器默认是不允许开发25端口的，因此只能使用ssl的456端口。但是问题又来了，官方的组件不支持ssl。因此对于这个问题只能是重新编译。</p>
<h3 id="邮件"><a href="#邮件" class="headerlink" title="邮件"></a>邮件</h3><p><a target="_blank" rel="noopener" href="https://github.com/GitHamburg/mail-provider.git">https://github.com/GitHamburg/mail-provider.git</a></p>
<h4 id="1-二进制安装-推荐"><a href="#1-二进制安装-推荐" class="headerlink" title="1.二进制安装(推荐)"></a>1.二进制安装(推荐)</h4><p>下载编译好的二进制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget http://cactifans.hi-www.com/open-falcon/mail-provider.tar.gz</span><br><span class="line">mkdir -p mail-provider</span><br><span class="line">tar zxvf mail-provider.tar.gz  -C mail-provider</span><br><span class="line">cd mail-provider</span><br></pre></td></tr></table></figure>
<p>修改cfg.json文件相关信息，使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./control start</span><br></pre></td></tr></table></figure>
<h4 id="2-源码编译（如无科学上网方法，请勿尝试）"><a href="#2-源码编译（如无科学上网方法，请勿尝试）" class="headerlink" title="2.源码编译（如无科学上网方法，请勿尝试）"></a>2.源码编译（如无科学上网方法，请勿尝试）</h4><p>下载之后为源码，安装golang环境，环境配置参考golang环境配置 编译方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd $GOPATH/src</span><br><span class="line">mkdir github.com/open-falcon/ -p</span><br><span class="line">cd github.com/open-falcon/</span><br><span class="line">git clone https://github.com/GitHamburg/mail-provider.git</span><br><span class="line">cd mail-provider</span><br><span class="line">go get ./...</span><br><span class="line">./control build</span><br></pre></td></tr></table></figure>
<p>编译成功之后，修改cfg.json文件相关信息，使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./control start</span><br></pre></td></tr></table></figure>
<h4 id="3、使用方法"><a href="#3、使用方法" class="headerlink" title="3、使用方法"></a>3、使用方法</h4><p>坐着说可以发送给多人，但是实际curl使用的时候发现并不可以。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://$ip:4000/sender/mail -d &quot;tos=a@a.com&amp;subject=xx&amp;content=yy&quot;</span><br></pre></td></tr></table></figure>
<h3 id="微信"><a href="#微信" class="headerlink" title="微信"></a>微信</h3><p><a target="_blank" rel="noopener" href="https://github.com/Yanjunhui/chat.git">https://github.com/Yanjunhui/chat.git</a></p>
<h4 id="一-申请企业号"><a href="#一-申请企业号" class="headerlink" title="一.申请企业号"></a>一.申请企业号</h4><p>以个人邮箱申请就可以, 不通过企业认证的话,有200人的限制,一般足够用了</p>
<h4 id="二-获取对接权限"><a href="#二-获取对接权限" class="headerlink" title="二.获取对接权限"></a>二.获取对接权限</h4><h5 id="1、获取corpid"><a href="#1、获取corpid" class="headerlink" title="1、获取corpid"></a>1、获取corpid</h5><p>登录后,我的企业 —-&gt; 企业信息 –&gt; CorpID<br><img src="https://img.econow.cn/2018/1539593796324.png" width="901"/><br>将 CorpID 配置到配置文件 config.conf 内 的 CorpID</p>
<h5 id="2、开启回调模式获取key"><a href="#2、开启回调模式获取key" class="headerlink" title="2、开启回调模式获取key"></a>2、开启回调模式获取key</h5><p>登录后,顶部菜单[企业应用] —-&gt; 添加应用<br>进入新添加的应用<br>拿到 AgentId 和 Secret<br><img src="https://img.econow.cn/2018/1539593870748.png" width="536"/></p>
<h5 id="3、关注微信公众号"><a href="#3、关注微信公众号" class="headerlink" title="3、关注微信公众号"></a>3、关注微信公众号</h5><p>使用微信关注企业号才可以从微信收到信息,否则只能从微信企业号 APP 中收到信息<br><img src="https://img.econow.cn/2018/1539594107364.png" width="845"/></p>
<h4 id="三、使用"><a href="#三、使用" class="headerlink" title="三、使用"></a>三、使用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://www.github.com/yanjunhui/chat.git</span><br></pre></td></tr></table></figure>

<h4 id="修改chat配置文件"><a href="#修改chat配置文件" class="headerlink" title="修改chat配置文件"></a>修改chat配置文件</h4><img src="https://img.econow.cn/2018/1539594319320.png" width="479"/>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#http 服务端口</span><br><span class="line">[http]</span><br><span class="line">port = 4567</span><br><span class="line"></span><br><span class="line">#微信接口信息</span><br><span class="line">[weixin]</span><br><span class="line">CorpID = xxxxxx</span><br><span class="line">#ID 应用ID</span><br><span class="line">AgentId = 1   </span><br><span class="line"># Secret</span><br><span class="line">Secret = xxxxxxx</span><br><span class="line">#最后一个无所谓</span><br><span class="line">EncodingAESKey = wodH5dMSQtlfySHED5dkk6dF7saukFpPxlwhWRsVeEn</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">打开目录 cd chat</span><br><span class="line">启动 ./control.sh start</span><br><span class="line">停止 ./control.sh stop</span><br><span class="line">重启 ./control.sh restart</span><br><span class="line">状态 ./control.sh status</span><br></pre></td></tr></table></figure>

<p>但是更新了版本，不知道为啥不正常，发布了微信。</p>
<p>推荐另一种方式，更好调试。</p>
<h3 id="Falcon-wechat"><a href="#Falcon-wechat" class="headerlink" title="Falcon-wechat"></a>Falcon-wechat</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/falcon-wechat</span><br><span class="line">cd /usr/local/falcon-wechat</span><br><span class="line">wget https://dl.cactifans.com/open-falcon/falcon-wechat-0.0.1.tar.gz</span><br><span class="line">tar zxvf falcon-wechat-0.0.1.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;debug&quot;: true,</span><br><span class="line">&quot;http&quot;: &#123;</span><br><span class="line">&quot;listen&quot;: &quot;0.0.0.0:9527&quot;,</span><br><span class="line">&quot;token&quot;: &quot;&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;wechat&quot;: &#123;</span><br><span class="line">&quot;corpid&quot;: &quot;wxa7c63522727b6bf0&quot;,</span><br><span class="line">&quot;secret&quot;: &quot;d5S-_XGVd-5HA0o9bkvMMK5Wh1qwCC-YQei4WcL9hSM&quot;,</span><br><span class="line">&quot;agentid&quot;: 1</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后修改alarm接口，重启即可，还能看日志。</p>
<p><a target="_blank" rel="noopener" href="https://www.cactifans.org/open-falcon/1788.html">https://www.cactifans.org/open-falcon/1788.html</a></p>
<h2 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h2><p><a target="_blank" rel="noopener" href="http://book.open-falcon.org/zh_0_2/">http://book.open-falcon.org/zh_0_2&#x2F;</a><br><a target="_blank" rel="noopener" href="https://github.com/open-falcon/falcon-plus">https://github.com/open-falcon/falcon-plus</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/Mac%E9%83%A8%E5%88%86%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Mac%E9%83%A8%E5%88%86%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93.html" class="post-title-link" itemprop="url">Mac 技巧</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-31 10:15:08" itemprop="dateCreated datePublished" datetime="2023-10-31T10:15:08+08:00">2023-10-31</time>
    </span>

  
    <span id="/Mac%E9%83%A8%E5%88%86%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93.html" class="post-meta-item leancloud_visitors" data-flag-title="Mac 技巧" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="查看中文字体"><a href="#查看中文字体" class="headerlink" title="查看中文字体"></a>查看中文字体</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">brew  install fontconfig</span><br><span class="line">fc-list :lang=zh</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/Mongodb%20%E6%8E%A2%E7%B4%A2.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Mongodb%20%E6%8E%A2%E7%B4%A2.html" class="post-title-link" itemprop="url">Mongodb 探索</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-31 10:15:08" itemprop="dateCreated datePublished" datetime="2023-10-31T10:15:08+08:00">2023-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span id="/Mongodb%20%E6%8E%A2%E7%B4%A2.html" class="post-meta-item leancloud_visitors" data-flag-title="Mongodb 探索" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>MongoDB是一个跨平台，面向文档的数据库，提供高性能，高可用性和易于扩展。MongoDB是工作在集合和文档上一种概念。</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>支持特别查询在MongoDB中，可以通过字段，范围查询进行搜索，并且还支持正则表达式搜索。</li>
<li>索引可以索引文档中的任何字段。</li>
<li>复制MongoDB支持主从复制。主机可以执行读写操作，从机从主机复制数据，只能用于读取或备份(不写入)</li>
<li>复制数据MongoDB可以在多台服务器上运行。 复制数据以保持系统正常运行，并在硬件故障的情况下保持其运行状态。</li>
<li>负载均衡由于数据放在碎片中，因此具有自动负载平衡配置。</li>
<li>支持映射缩减和聚合工具</li>
<li>使用JavaScript而不是Procedure</li>
<li>它是一个用C++编写的无模式数据库</li>
<li>提供高性能</li>
<li>轻松存储任何大小的文件，而不会使您的堆栈复杂化</li>
<li>在故障的情况下易于管理</li>
<li>它还支持：<ul>
<li>具有动态模式的JSON数据模型</li>
<li>自动分片用于水平可扩展性</li>
<li>内置复制高可用性</li>
</ul>
</li>
</ul>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li>MongoDB 的架构较少。它是一个文档数据库，它的一个集合持有不同的文档。</li>
<li>从一个到另一个的文档的数量，内容和大小可能有差异。</li>
<li>MongoDB 中单个对象的结构很清淅。</li>
<li>MongoDB 中没有复杂的连接。</li>
<li>MongoDB 提供深度查询的功能，因为它支持对文档的强大的动态查询。</li>
<li>MongoDB 很容易扩展。</li>
<li>它使用内部存储器来存储工作集，这是其快速访问的原因。</li>
</ul>
<h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><ul>
<li>大而复杂的数据</li>
<li>移动和社会基础设施数据</li>
<li>内容管理和交付</li>
<li>用户数据管理</li>
<li>数据中心</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-3.0.6.tgz    # 下载</span><br><span class="line">tar -zxvf mongodb-linux-x86_64-3.0.6.tgz                                   # 解压</span><br><span class="line"></span><br><span class="line">mv  mongodb-linux-x86_64-3.0.6/ /usr/local/mongodb                         # 将解压包拷贝到指定目录</span><br></pre></td></tr></table></figure>
<p>MongoDB 的可执行文件位于 bin 目录下，所以可以将其添加到 PATH 路径中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=&lt;mongodb-install-directory&gt;/bin:$PATH</span><br></pre></td></tr></table></figure>
<p><mongodb-install-directory> 为你 MongoDB 的安装路径。如本文的 &#x2F;usr&#x2F;local&#x2F;mongodb 。</p>
<h3 id="创建数据库目录"><a href="#创建数据库目录" class="headerlink" title="创建数据库目录"></a>创建数据库目录</h3><p>MongoDB的数据存储在data目录的db目录下，但是这个目录在安装过程不会自动创建，所以你需要手动创建data目录，并在data目录中创建db目录。</p>
<p>以下实例中我们将data目录创建于根目录下(&#x2F;)。</p>
<p>注意：&#x2F;data&#x2F;db 是 MongoDB 默认的启动的数据库路径(–dbpath)。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/db</span><br></pre></td></tr></table></figure>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>可以在命令行中执行mongo安装目录中的bin目录执行mongod命令来启动mongdb服务。如果你的数据库目录不是&#x2F;data&#x2F;db，可以通过 –dbpath 来指定。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./mongod</span><br></pre></td></tr></table></figure>
<h3 id="启动参数"><a href="#启动参数" class="headerlink" title="启动参数"></a>启动参数</h3><ul>
<li>–dbpath 指定数据目录，默认是&#x2F;data&#x2F;db,每个mongod进程都需要独立的数据目录</li>
<li>–port 指定服务器监听端口，默认27017</li>
<li>–fork 以守护进程的方式运行服务</li>
<li>–logpath 指定输出日志的路径，而不是输出到命令行</li>
<li>–config 指定配置文件</li>
</ul>
<h3 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h3><ul>
<li>查看进程，使用kill命令</li>
<li>在客户端进去，使用db.shutdownServer()</li>
</ul>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="查"><a href="#查" class="headerlink" title="查"></a>查</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show dbs;</span><br><span class="line">#查看数据库</span><br></pre></td></tr></table></figure>
<img src="https://img.econow.cn/medivh/1546668277063.png" />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use wesure;</span><br><span class="line">#切换或者创建（如果没有该库的话）</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.getName();</span><br><span class="line">#db; db和getName方法是一样的效果，都可以查询当前使用的数据库</span><br></pre></td></tr></table></figure>
<img src="https://img.econow.cn/medivh/1546668518239.png" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.stats();</span><br><span class="line">#查看数据库状态</span><br></pre></td></tr></table></figure>
<img src="https://img.econow.cn/medivh/1546668460378.png" />

<h3 id="用户相关"><a href="#用户相关" class="headerlink" title="用户相关"></a>用户相关</h3><p>1、添加一个用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.addUser(&quot;name&quot;);</span><br><span class="line"></span><br><span class="line">db.addUser(&quot;userName&quot;, &quot;pwd123&quot;, true); 添加用户、设置密码、是否只读</span><br></pre></td></tr></table></figure>
<p>2、数据库认证、安全模式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.auth(&quot;userName&quot;, &quot;123123&quot;);</span><br></pre></td></tr></table></figure>
<p>3、显示当前所有用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show users;</span><br></pre></td></tr></table></figure>
<p>4、删除用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.removeUser(&quot;userName&quot;);</span><br></pre></td></tr></table></figure>
<p>其他</p>
<ul>
<li>查询之前的错误信息<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.getPrevError();</span><br></pre></td></tr></table></figure></li>
<li>清除错误记录<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.resetError();</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="克隆"><a href="#克隆" class="headerlink" title="克隆"></a>克隆</h3><p>使用copyDatabase命令实现数据库复制，可以在几秒内创建数据库副本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.copyDatabase(fromdb, todb, fromhost, username, password, mechanism)¶</span><br></pre></td></tr></table></figure>

<img src="https://img.econow.cn/medivh/1630924290229.png"  />


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@gz-tencent mongo]# mongo localhost:27018</span><br><span class="line">&gt; db.copyDatabase(&quot;backup&quot;,&quot;backup&quot;,&quot;xxx.x.x.x:27017&quot;);</span><br><span class="line">WARNING: db.copyDatabase is deprecated. See http://dochub.mongodb.org/core/copydb-clone-deprecation</span><br><span class="line">&#123;</span><br><span class="line">    &quot;note&quot; : &quot;Support for the copydb command has been deprecated. See http://dochub.mongodb.org/core/copydb-clone-deprecation&quot;,</span><br><span class="line">    &quot;ok&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，执行后不会立刻展示正确的容量大小，取决于数据库实际的大小和网速。另外4.0以后的版本以及不能使用该命令了。</p>
<blockquote>
<p>IMPORTANT<br>Starting in version 4.2, MongoDB removes the copydb command. The deprecated db.copyDatabase(), which wraps the copydb command, can only be run against MongoDB 4.0 or earlier versions. For behavior and examples, refer to the 4.0 or earlier version of the manual.<br>For an alternative in version 4.2+, see Copy&#x2F;Clone a Database. </p>
</blockquote>
<h4 id="4-2-copy-clone"><a href="#4-2-copy-clone" class="headerlink" title="4.2 copy&#x2F;clone"></a>4.2 copy&#x2F;clone</h4><p>As an alternative, users can use mongodump and mongorestore (with the mongorestore options –nsFrom and –nsTo).</p>
<p>For example, to copy the test database from a local instance running on the default port 27017 to the examples database on the same instance, you can:</p>
<ol>
<li>Use mongodump to dump the test database to an archive mongodump-test-db:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongodump --archive=&quot;mongodump-test-db&quot; --db=test</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Use mongorestore with –nsFrom and –nsTo to restore (with database name change) from the archive:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongorestore --archive=&quot;mongodump-test-db&quot; --nsFrom=&#x27;test.*&#x27; --nsTo=&#x27;examples.*&#x27;</span><br></pre></td></tr></table></figure>

<p>简单来说分为两步，首先dump导出，然后restore恢复，也可以指定源空间和目标空间。</p>
<h4 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h4><p>The canonical name for a collection or index in MongoDB. The namespace is a combination of the database name and the name of the collection or index, like so: [database-name].[collection-or-index-name]. All documents belong to a namespace. See Namespaces.</p>
<p>规范的命名是集合或者索引在MongoDB中。命名空间是由数据库名和集合或者索引共同组成。</p>
<h4 id="database"><a href="#database" class="headerlink" title="database"></a>database</h4><p>A physical container for collections. Each database gets its own set of files on the file system. A single MongoDB server typically has multiple databases.</p>
<p>一种存放集合的物理容器。每个数据库在文件系统都有自己的文件。单个MongoDB服务可以有多个数据库。</p>
<h4 id="journal"><a href="#journal" class="headerlink" title="journal"></a>journal</h4><p>A sequential, binary transaction log used to bring the database into a valid state in the event of a hard shutdown. Journaling writes data first to the journal and then to the core data files. MongoDB enables journaling by default for 64-bit builds of MongoDB version 2.0 and newer. Journal files are pre-allocated and exist as files in the data directory. See Journaling.</p>
<p>一种连续的，二进制不间断的日志用来数据库有效状态记录事件在硬件宕机的时候。</p>
<h4 id="数据文件类型"><a href="#数据文件类型" class="headerlink" title="数据文件类型"></a>数据文件类型</h4><ol>
<li>journal 日志文件</li>
<li>namespace 表名文件</li>
<li>data 数据及索引文件</li>
</ol>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol>
<li><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/introduction/">https://docs.mongodb.com/manual/introduction/</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/MacBook%20Pro%20m1%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/MacBook%20Pro%20m1%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95.html" class="post-title-link" itemprop="url">MacBook Pro m1迁移记录</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-31 10:15:08" itemprop="dateCreated datePublished" datetime="2023-10-31T10:15:08+08:00">2023-10-31</time>
    </span>

  
    <span id="/MacBook%20Pro%20m1%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95.html" class="post-meta-item leancloud_visitors" data-flag-title="MacBook Pro m1迁移记录" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="迁移"><a href="#迁移" class="headerlink" title="迁移"></a>迁移</h2><p>从旧的笔记本迁移到新笔记本上一般有两种方式：</p>
<ul>
<li>第一种是最简单的迁移助理APP；</li>
<li>第二种是使用TimeMachine。</li>
</ul>
<h3 id="迁移助理"><a href="#迁移助理" class="headerlink" title="迁移助理"></a>迁移助理</h3><p>“迁移助理”可将您的所有文件从旧 Mac 拷贝到新 Mac 上，让您不必手动拷贝这些文件。</p>
<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><ol>
<li>两台笔记本的系统版本注意不要差距太大，否则会出现迁移后很多设置比较乱的情况或者其他异常情况。</li>
<li>如果两台电脑使用的都是 macOS Sierra 或更高版本，那么请将它们彼此靠近放置并打开 Wi-Fi 。如果其中有一台电脑使用的是 OS X El Capitan 或更低版本，请确保两者位于同一网络上。</li>
<li>在旧 Mac 上，选取苹果菜单  &gt;“系统偏好设置”，然后点按“共享”。确保“电脑名称”栏中显示一个名称。</li>
</ol>
<h4 id="执行步骤"><a href="#执行步骤" class="headerlink" title="执行步骤"></a>执行步骤</h4><p>在新Mac上</p>
<ol>
<li>打开“迁移助理”，它位于“应用程序”文件夹的“实用工具”文件夹内。然后，点按“继续”。</li>
<li>当“迁移助理”就做出更改而征求您的许可时，输入您的管理员密码，然后点按“好”。</li>
<li>当系统询问您要怎样传输信息时，请选择从 Mac、“时间机器”备份或启动磁盘进行传输的方式。然后，点按“继续”。</li>
</ol>
<p><img src="https://img.econow.cn/medivh/1636891253812.png" alt="1636891253812.png"></p>
<p>在旧Mac上</p>
<ol>
<li>打开“迁移助理”，然后点按“继续”。</li>
<li>当系统询问您想要怎样传输信息时，请选择“至另一台 Mac”这一传输选项。然后，点按“继续”。</li>
</ol>
<p>在新 Mac 上<br>当系统提示您选择 Mac、“时间机器”备份或其他启动磁盘时，请选择另一台 Mac。然后，点按“继续”。</p>
<p><img src="https://img.econow.cn/medivh/1636891321526.png" alt="1636891321526.png"></p>
<p>在旧 Mac 上<br>如果看到安全码，请确保其与新 Mac 上显示的安全码相同。然后，点按“继续”。</p>
<p>在新 Mac 上<br>1.选择要传输的信息。</p>
<blockquote>
<p>在这个示例中，John Appleseed 是一个 macOS 用户帐户。如果这个帐户与新 Mac 上已有的帐户同名，则系统会提示您重命名这个旧帐户或替换新 Mac 上的帐户。如果进行重命名，则这个旧帐户会作为单独的用户出现在新 Mac 上，并且拥有单独的个人文件夹和登录名。如果进行替换，则这个旧帐户会删除并随后替换新 Mac 上的帐户，包括相应个人文件夹中的所有内容。</p>
</blockquote>
<p><img src="https://img.econow.cn/medivh/1636891361313.png" alt="1636891361313.png"></p>
<p>2.点按“继续”以开始传输。大型传输可能需要几个小时才能完成。<br>3.“迁移助理”完成操作后，在两台电脑上退出“迁移助理”，然后在新 Mac 上登录迁移的帐户以查看它的文件。</p>
<h4 id="问题整理"><a href="#问题整理" class="headerlink" title="问题整理"></a>问题整理</h4><ol>
<li><p>迁移助理一直显示正在启动中<br>原因是没有等新的Mac计算为每个项目的大小就点击了继续，解决方式就是重启笔记本，再来一遍。之后等笔记本计算完文件大小，之后再点击继续就可以传输了。</p>
</li>
<li><p>其他</p>
</li>
</ol>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>我使用的就是这种方式，简单，但是略微费时。执行过程中基本没有出现什么问题，大体比较顺利，加上摸索的时间全程大约2小时内。</p>
<h3 id="全盘恢复"><a href="#全盘恢复" class="headerlink" title="全盘恢复"></a>全盘恢复</h3><p>所谓的全盘恢复就是使用时间机器的备份恢复到新的笔记本中。</p>
<h4 id="执行步骤-1"><a href="#执行步骤-1" class="headerlink" title="执行步骤"></a>执行步骤</h4><ol>
<li><p>如果需要重新安装 macOS，请先完成这一操作，然后再继续。例如，如果 Mac 启动时显示闪烁的问号，则您需要先重新安装 macOS。</p>
</li>
<li><p>确保您的“时间机器”备份磁盘已连接到 Mac，并处于打开状态。</p>
</li>
<li><p>在 Mac 上打开“迁移助理”。它位于“应用程序”文件夹的“实用工具”文件夹中。</p>
<blockquote>
<p>如果 Mac 启动时显示设置助理，要求提供您所在的国家或地区和您的网络等详细信息，请继续前往下一步，因为设置助理包含了迁移助理。</p>
</blockquote>
</li>
<li><p>当系统询问您要怎样传输信息时，请选择从 Mac、“时间机器”备份或启动磁盘进行传输的方式。然后，点按“继续”。</p>
</li>
</ol>
<p><img src="https://img.econow.cn/medivh/1636893548067.png" alt="1636893548067.png"></p>
<ol start="5">
<li>选择您的“时间机器”备份，然后点按“继续”。</li>
</ol>
<p><img src="https://img.econow.cn/medivh/1636893570556.png" alt="1636893570556.png"></p>
<ol>
<li>选取一个备份，然后点按“继续”。</li>
</ol>
<p><img src="https://img.econow.cn/medivh/1636893593127.png" alt="1636893593127.png"></p>
<ol start="7">
<li>选择要传输的信息</li>
</ol>
<blockquote>
<p>在这个示例中，John Appleseed 是一个 macOS 用户帐户。如果这个旧帐户与 Mac 上已有的帐户同名，则系统会提示您重命名这个旧帐户或替换 Mac 上的帐户。如果进行重命名，则这个旧帐户会作为单独的用户出现在 Mac 上，并且拥有单独的个人文件夹和登录名。如果进行替换，则这个旧帐户会删除并随后替换 Mac 上的帐户，包括相应个人文件夹中的所有内容。</p>
</blockquote>
<p><img src="https://img.econow.cn/medivh/1636893631865.png" alt="1636893631865.png"></p>
<ol start="8">
<li>点按“继续”以开始传输。大型传输可能需要几个小时才能完成。</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://support.apple.com/zh-cn/HT204350">https://support.apple.com/zh-cn/HT204350</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/Logstash%20%E8%BE%93%E5%87%BA%E5%88%B0%20hdfs.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Logstash%20%E8%BE%93%E5%87%BA%E5%88%B0%20hdfs.html" class="post-title-link" itemprop="url">Logstash 输出到 hdfs</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-31 10:15:08" itemprop="dateCreated datePublished" datetime="2023-10-31T10:15:08+08:00">2023-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span id="/Logstash%20%E8%BE%93%E5%87%BA%E5%88%B0%20hdfs.html" class="post-meta-item leancloud_visitors" data-flag-title="Logstash 输出到 hdfs" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>由于ES集群价格较为昂贵，相对来讲还是Hadoop平台便宜，耐用。</p>
</blockquote>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>logstash 可以直接把文件内容写入 hdfs 中， 并支持 hdfs 压缩格式。但是需要安装第三方插件，webhdfs插件，通过hdfs的web接口写入，即 <a target="_blank" rel="noopener" href="http://namenode00:50070/webhdfs/v1/">http://namenode00:50070/webhdfs/v1/</a> 接口。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/elk/logstash/bin/logstash-plugin install logstash-output-webhdfs-discontinued</span><br></pre></td></tr></table></figure>
<p>一般情况下不会出问题，至少我目前没有遇到过。</p>
<h3 id="检查hdfs端口是否可访问"><a href="#检查hdfs端口是否可访问" class="headerlink" title="检查hdfs端口是否可访问"></a>检查hdfs端口是否可访问</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl  hdfs:50070</span><br></pre></td></tr></table></figure>

<h2 id="配置output"><a href="#配置output" class="headerlink" title="配置output"></a>配置output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">input&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">fileter&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output&#123;</span><br><span class="line">    if [serverType] == &quot;xxxx&quot; &#123;</span><br><span class="line">       webhdfs &#123;</span><br><span class="line">        host =&gt; &quot;x.x.x.x&quot; # hdfs 主机</span><br><span class="line">        port =&gt; 50070   # hdfs 端口</span><br><span class="line">        flush_size =&gt; 500</span><br><span class="line">        idle_flush_time =&gt; 10</span><br><span class="line">        user =&gt; &quot;hdfs&quot;   # hdfs 用户</span><br><span class="line">        path =&gt; &quot;/data/log/%&#123;+YYYYMMdd&#125;_xxxxx.log&quot;</span><br><span class="line">        compression =&gt; &quot;gzip&quot;   # 压缩模式</span><br><span class="line">        codec =&gt; &#x27;json&#x27;         </span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置好重启即可。</p>
<h2 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h2><p>上述配置文件中基本为必选项或者为建议参考值。</p>
<img src="https://img.econow.cn/medivh/1568025146014.png"  />
<img src="https://img.econow.cn/medivh/1568025165706.png"  />


<h3 id="压缩模式说明"><a href="#压缩模式说明" class="headerlink" title="压缩模式说明"></a>压缩模式说明</h3><img src="https://img.econow.cn/medivh/1568025379386.png"  />

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/logstash/6.4/plugins-outputs-webhdfs.html">https://www.elastic.co/guide/en/logstash/6.4/plugins-outputs-webhdfs.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/Mac%20%E5%88%9D%E5%A7%8B%E5%8C%96%E7%8E%AF%E5%A2%83.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Mac%20%E5%88%9D%E5%A7%8B%E5%8C%96%E7%8E%AF%E5%A2%83.html" class="post-title-link" itemprop="url">Mac 初始化环境</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-31 10:15:08" itemprop="dateCreated datePublished" datetime="2023-10-31T10:15:08+08:00">2023-10-31</time>
    </span>

  
    <span id="/Mac%20%E5%88%9D%E5%A7%8B%E5%8C%96%E7%8E%AF%E5%A2%83.html" class="post-meta-item leancloud_visitors" data-flag-title="Mac 初始化环境" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>很多时候，没有人愿意重装系统，除非万不得已。<br>在拥有一台刚初始化操作系统后的笔记本后，停下来想一想自己要做什么。</p>
</blockquote>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ol>
<li>安装优秀的终端管理工具iTerm2&#x2F;zsh以及包管理工具homebrew</li>
<li>安装开发环境<ul>
<li>Python<ul>
<li>pip</li>
<li>virtualenv</li>
</ul>
</li>
<li>redis</li>
<li>mysql</li>
<li>nginx</li>
</ul>
</li>
<li>其他常用软件<ul>
<li>KVM管理工具</li>
<li>图床</li>
</ul>
</li>
</ol>
<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><h3 id="iterm2"><a href="#iterm2" class="headerlink" title="iterm2"></a>iterm2</h3><p>安装<br><a target="_blank" rel="noopener" href="https://img.econow.cn/iTerm2-3_4_10.zip">https://img.econow.cn/iTerm2-3_4_10.zip</a></p>
<h3 id="brew"><a href="#brew" class="headerlink" title="brew"></a>brew</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="brew的备份和恢复"><a href="#brew的备份和恢复" class="headerlink" title="brew的备份和恢复"></a>brew的备份和恢复</h4><p>homebrew-bundle可以帮助我们备份已安装的包和app们，这样我们在重装系统或者换电脑后可以一键恢复安装，节省时间。</p>
<ul>
<li>–describe代表会加上包的描述</li>
<li>–force代表覆盖已有的文件</li>
<li>–file指定输出文件</li>
</ul>
<p>参考示例：<br>备份</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew bundle dump --describe --force --all --file=&quot;~/Desktop/Brewfile&quot;</span><br></pre></td></tr></table></figure>

<p>恢复</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 安装 mas</span><br><span class="line">brew install mas</span><br><span class="line"># 批量安装软件 </span><br><span class="line">brew bundle --file=&quot;~/Desktop/Brewfile&quot;</span><br></pre></td></tr></table></figure>

<h3 id="zsh"><a href="#zsh" class="headerlink" title="zsh"></a>zsh</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;</span><br><span class="line">chsh -s /bin/zsh</span><br></pre></td></tr></table></figure>

<h4 id="bash-zsh切换"><a href="#bash-zsh切换" class="headerlink" title="bash&#x2F;zsh切换"></a>bash&#x2F;zsh切换</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chsh -s /bin/zsh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh -O - | sh</span><br></pre></td></tr></table></figure>

<p><img src="https://img.econow.cn/medivh/1632292508749.png" alt="1632292508749.png"></p>
<h2 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h2><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><h4 id="pip"><a href="#pip" class="headerlink" title="pip"></a>pip</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo easy_install pip</span><br><span class="line">sudo pip install requests</span><br></pre></td></tr></table></figure>

<h4 id="pip源"><a href="#pip源" class="headerlink" title="pip源"></a>pip源</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">豆瓣 https://pypi.douban.com/simple</span><br><span class="line">阿里云 https://mirrors.aliyun.com/pypi/simple</span><br><span class="line">清华大学 https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">中国科学技术大学 https://pypi.mirrors.ustc.edu.cn/simple</span><br><span class="line">中国科技大学 https://pypi.mirrors.ustc.edu.cn/simple</span><br><span class="line">官方 https://pypi.python.org/simple/</span><br></pre></td></tr></table></figure>

<h4 id="pip-加速"><a href="#pip-加速" class="headerlink" title="pip 加速"></a>pip 加速</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">index-url = https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">format = columns</span><br></pre></td></tr></table></figure>

<p>插件目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Users/medivh/.oh-my-zsh/plugins</span><br></pre></td></tr></table></figure>

<h4 id="virtualenv"><a href="#virtualenv" class="headerlink" title="virtualenv"></a>virtualenv</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pip install virtualenv</span><br><span class="line"># 不安装任何第三方包</span><br><span class="line">virtualenv --no-site-packages venv </span><br><span class="line"></span><br><span class="line"># 指定版本</span><br><span class="line">virtualenv -p /usr/bin/python2.7 venv</span><br><span class="line"></span><br><span class="line">#激活虚拟环境</span><br><span class="line">source venv/bin/activate</span><br><span class="line"></span><br><span class="line">#推出虚拟环境</span><br><span class="line">deactivate</span><br></pre></td></tr></table></figure>

<h4 id="Mac-redis"><a href="#Mac-redis" class="headerlink" title="Mac redis"></a>Mac redis</h4><p><code>brew install redis</code><br>开机启动<br><code>brew services start redis</code></p>
<p>配置文件<br><code>/usr/local/etc/redis.conf</code></p>
<p>编辑配置文件 配置后台运行<br><code>daemonize yes</code></p>
<p>服务端启动及查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-server /usr/local/etc/redis.conf</span><br><span class="line">ps aux | grep redis</span><br></pre></td></tr></table></figure>

<p>客户端调用<br><code>redis-cli</code></p>
<p>给redis设置密码<br>打开redis.conf文件，找到以下配置项<br><code># requirepass foobared</code><br>更改为<br><code>requirepass 你的密码</code><br>注意：由于上诉操作更改了redis.conf文件，所以下次再启动的时候，要手动加载一下redis.conf文件。例如<br>进入到redis根目录，启动如下<br><code>redis-server /usr/local/etc/redis.conf</code></p>
<h2 id="其他工具"><a href="#其他工具" class="headerlink" title="其他工具"></a>其他工具</h2><h3 id="Markdown-图床"><a href="#Markdown-图床" class="headerlink" title="Markdown 图床"></a>Markdown 图床</h3><p>参考<a href="http://econow.cn/markdown%20%E5%9B%BE%E5%BA%8A%E7%94%9F%E6%88%90.html">http://econow.cn/markdown%20%E5%9B%BE%E5%BA%8A%E7%94%9F%E6%88%90.html</a></p>
<h3 id="vs-code"><a href="#vs-code" class="headerlink" title="vs code"></a>vs code</h3><ul>
<li>安装vs code</li>
<li>安装插件 markdownlint evermonkey</li>
<li>配置插件-印象笔记<ul>
<li>命令行输入 ever tokent，然后分别粘贴evermonkey.token, evermonkey.noteStoreUrl</li>
<li>新建笔记 option+n</li>
<li>推送笔记 option+</li>
</ul>
</li>
</ul>
<h3 id="hexo-环境"><a href="#hexo-环境" class="headerlink" title="hexo 环境"></a>hexo 环境</h3><p>参考<a href="http://econow.cn/Hexo-%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E6%90%AD%E5%BB%BA.html">http://econow.cn/Hexo-%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E6%90%AD%E5%BB%BA.html</a></p>
<h3 id="Mac-kvm"><a href="#Mac-kvm" class="headerlink" title="Mac kvm"></a>Mac kvm</h3><p><a target="_blank" rel="noopener" href="https://github.com/jeffreywildman/homebrew-virt-manager.git">https://github.com/jeffreywildman/homebrew-virt-manager.git</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">brew tap jeffreywildman/homebrew-virt-manager</span><br><span class="line">brew install virt-manager virt-viewer</span><br><span class="line"></span><br><span class="line">#使用</span><br><span class="line">virt-manager -c &#x27;qemu+ssh://user@libvirthost/system?socket=/var/run/libvirt/libvirt-sock&#x27;</span><br><span class="line">virt-viewer -c &#x27;qemu+ssh://user@libvirthost/system?socket=/var/run/libvirt/libvirt-sock&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h2><h3 id="Mac-部分进程负载较高（bird）"><a href="#Mac-部分进程负载较高（bird）" class="headerlink" title="Mac 部分进程负载较高（bird）"></a>Mac 部分进程负载较高（bird）</h3><ul>
<li>关闭iCloud 文稿&#x2F;桌面的备份</li>
<li>从iCloud中复制出来文稿里面的文件，因为关闭同步后文稿会自动清空。其实感觉这个就像软链</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/Linux%20%E6%97%A5%E5%B8%B8%E6%95%B4%E7%90%86.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Linux%20%E6%97%A5%E5%B8%B8%E6%95%B4%E7%90%86.html" class="post-title-link" itemprop="url">Linux 日常整理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-31 10:15:08" itemprop="dateCreated datePublished" datetime="2023-10-31T10:15:08+08:00">2023-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span id="/Linux%20%E6%97%A5%E5%B8%B8%E6%95%B4%E7%90%86.html" class="post-meta-item leancloud_visitors" data-flag-title="Linux 日常整理" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="时间同步"><a href="#时间同步" class="headerlink" title="时间同步"></a>时间同步</h3><h4 id="the-NTP-socket-is-in-use-exiting问题"><a href="#the-NTP-socket-is-in-use-exiting问题" class="headerlink" title="the NTP socket is in use, exiting问题"></a>the NTP socket is in use, exiting问题</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@esx4 ~]# ntpdate ntp.api.bz</span><br><span class="line">21 Sep 14:39:09 ntpdate[24744]: the NTP socket is in use, exiting</span><br><span class="line"></span><br><span class="line">[root@esx4 ~]# service ntpd stop</span><br><span class="line">Shutting down ntpd:                                        [  OK  ]</span><br><span class="line"></span><br><span class="line">[root@esx4 ~]# ntpdate 0.debian.pool.ntp.org</span><br><span class="line">21 Sep 15:22:43 ntpdate[25723]: step time server 114.80.81.1 offset 2312.159684 sec</span><br></pre></td></tr></table></figure>
<h4 id="同步crontab"><a href="#同步crontab" class="headerlink" title="同步crontab"></a>同步crontab</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;59 23 * * * /usr/sbin/ntpdate 0.debian.pool.ntp.org &gt;&gt; /var/log/time.log &amp;&amp; hwclock --systohc 2&gt;&amp;1&quot; &gt;&gt; /etc/crontab</span><br></pre></td></tr></table></figure>
<h3 id="磁盘"><a href="#磁盘" class="headerlink" title="磁盘"></a>磁盘</h3><h4 id="大于2T的分区"><a href="#大于2T的分区" class="headerlink" title="大于2T的分区"></a>大于2T的分区</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">parted  /dev/sdb</span><br><span class="line">mklabel gpt --建立gpt标签</span><br><span class="line">mkpart primary 0% 100%  （开始和终止位置）</span><br><span class="line">print   查看结果</span><br><span class="line">quit 退出</span><br><span class="line"></span><br><span class="line">mkfs.ext4 /dev/sdb</span><br><span class="line"></span><br><span class="line">mkdir /data</span><br><span class="line">mount  /dev/sdb /data</span><br></pre></td></tr></table></figure>
<h4 id="UUID"><a href="#UUID" class="headerlink" title="UUID"></a>UUID</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop01-bj-a src]# blk</span><br><span class="line">blkdeactivate  blkdiscard     blkid</span><br><span class="line">[root@hadoop01-bj-a src]# blkid</span><br><span class="line">/dev/vda1: UUID=&quot;976105f5-f402-456c-aadd-50de49ff88f9&quot; TYPE=&quot;ext4&quot;</span><br><span class="line">/dev/vdb1: UUID=&quot;7f7dfded-4bbd-4a38-b823-1ddf904be9db&quot; TYPE=&quot;ext4&quot;</span><br><span class="line">[root@hadoop01-bj-a src]# cat /etc/fstab</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># /etc/fstab</span><br><span class="line"># Created by anaconda on Thu Aug 17 07:38:21 2017</span><br><span class="line">#</span><br><span class="line"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><br><span class="line"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><br><span class="line">#</span><br><span class="line">UUID=976105f5-f402-456c-aadd-50de49ff88f9 /                       ext4    defaults        1 1</span><br><span class="line">UUID=976105f5-f402-456c-aadd-50de49ff88f9 /opt                    ext4    defaults        0 0</span><br></pre></td></tr></table></figure>
<h3 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">cd /usr/src/ &amp;&amp; tar -zxvf ./jre-8u191-linux-x64.tar.gz -C /usr/local</span><br><span class="line">ln -s /usr/local/jdk1.8.0_91/ /usr/local/java</span><br><span class="line">echo &#x27;</span><br><span class="line">#JDK</span><br><span class="line">############################################################</span><br><span class="line">export JAVA_HOME=/usr/local/java</span><br><span class="line">export PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">############################################################</span><br><span class="line">&#x27; &gt;&gt; /etc/profile</span><br><span class="line">source /etc/profile</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>
<h3 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cd /usr/src/ &amp;&amp; wget 10.110.1.18/open-falcon-agnt.tar.gz &amp;&amp; tar -xvf open-falcon-agnt.tar.gz -C /usr/local &amp;&amp; chmod 755 /usr/local/open-falcon -R  &amp;&amp; cd   /usr/local/open-falcon</span><br><span class="line">./open-falcon start agent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="name-or-service-not-known"><a href="#name-or-service-not-known" class="headerlink" title="name or service not known"></a>name or service not known</h3><p>配置jumpserver发邮件的时候提示<code>name or service not known</code>。<br>检查发现能ping通<code>smtp.exmail.qq.com</code>，但是不知道为啥发不出邮件</p>
<p>使用以下命令，然后加入hosts文件,即可<br><img src="https://img.econow.cn/medivh/1551426333101.png" /><br><img src="https://img.econow.cn/medivh/1551426435903.png" /></p>
<h3 id="查看文件编码"><a href="#查看文件编码" class="headerlink" title="查看文件编码"></a>查看文件编码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim </span><br><span class="line"></span><br><span class="line">:set fileencoding</span><br></pre></td></tr></table></figure>
<h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">#查找30天以前的文件</span><br><span class="line">find . -name &quot;*.png&quot; -ctime +1</span><br><span class="line"></span><br><span class="line">find -name april*                      在当前目录下查找以april开始的文件</span><br><span class="line">find -name april* fprint file        在当前目录下查找以april开始的文件，并把结果输出到file中</span><br><span class="line">find -name ap* -o -name may* 查找以ap或may开头的文件</span><br><span class="line">find /mnt -name tom.txt -ftype vfat 在/mnt下查找名称为tom.txt且文件系统类型为vfat的文件</span><br><span class="line">find /mnt -name t.txt ! -ftype vfat   在/mnt下查找名称为tom.txt且文件系统类型不为vfat的文件</span><br><span class="line">find /tmp -name wa* -type l           在/tmp下查找名为wa开头且类型为符号链接的文件</span><br><span class="line">find /home -mtime -2                 在/home下查最近两天内改动过的文件</span><br><span class="line">find /home   -atime -1                  查1天之内被存取过的文件</span><br><span class="line">find /home -mmin   +60                  在/home下查60分钟前改动过的文件</span><br><span class="line">find /home -amin +30                  查最近30分钟前被存取过的文件</span><br><span class="line">find /home -newer tmp.txt             在/home下查更新时间比tmp.txt近的文件或目录</span><br><span class="line">find /home -anewer tmp.txt            在/home下查存取时间比tmp.txt近的文件或目录</span><br><span class="line">find /home -used -2                  列出文件或目录被改动过之后，在2日内被存取过的文件或目录</span><br><span class="line">find /home -user cnscn                列出/home目录内属于用户cnscn的文件或目录</span><br><span class="line">find /home -uid +501                 列出/home目录内用户的识别码大于501的文件或目录</span><br><span class="line">find /home -group cnscn              列出/home内组为cnscn的文件或目录</span><br><span class="line">find /home -gid 501                   列出/home内组id为501的文件或目录</span><br><span class="line">find /home -nouser                    列出/home内不属于本地用户的文件或目录</span><br><span class="line">find /home -nogroup                   列出/home内不属于本地组的文件或目录</span><br><span class="line">find /home   -name tmp.txt   -maxdepth 4 列出/home内的tmp.txt 查时深度最多为3层</span><br><span class="line">find /home -name tmp.txt -mindepth 3 从第2层开始查</span><br><span class="line">find /home -empty                     查找大小为0的文件或空目录</span><br><span class="line">find /home -size +512k               查大于512k的文件</span><br><span class="line">find /home -size -512k               查小于512k的文件</span><br><span class="line">find /home -links +2                 查硬连接数大于2的文件或目录</span><br><span class="line">find /home -perm 0700                查权限为700的文件或目录</span><br><span class="line">find /tmp -name tmp.txt -exec cat &#123;&#125; /;</span><br><span class="line">find /tmp -name tmp.txt -ok rm &#123;&#125; /;</span><br><span class="line"></span><br><span class="line">find   / -amin   -10       # 查找在系统中最后10分钟访问的文件</span><br><span class="line">find   / -atime -2         # 查找在系统中最后48小时访问的文件</span><br><span class="line">find   / -empty              # 查找在系统中为空的文件或者文件夹</span><br><span class="line">find   / -group cat        # 查找在系统中属于 groupcat的文件</span><br><span class="line">find   / -mmin -5         # 查找在系统中最后5分钟里修改过的文件</span><br><span class="line">find   / -mtime -1        #查找在系统中最后24小时里修改过的文件</span><br><span class="line">find   / -nouser             #查找在系统中属于作废用户的文件</span><br><span class="line">find   / -user   fred       #查找在系统中属于FRED这个用户的文件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-name filename             #查找名为filename的文件</span><br><span class="line">-perm                       #按执行权限来查找</span><br><span class="line">-user   username            #按文件属主来查找</span><br><span class="line">-group groupname            #按组来查找</span><br><span class="line">-mtime -n +n               #按文件更改时间来查找文件，-n指n天以内，+n指n天以前</span><br><span class="line">-atime   -n +n              #按文件访问时间来查</span><br><span class="line">-perm                        #按执行权限来查找</span><br><span class="line">-user   username            #按文件属主来查找</span><br><span class="line">-group groupname            #按组来查找</span><br><span class="line">-mtime -n +n               #按文件更改时间来查找文件，-n指n天以内，+n指n天以前</span><br><span class="line">-atime   -n +n              #按文件访问时间来查找文件，-n指n天以内，+n指n天以前 </span><br><span class="line">-ctime   -n +n              #按文件创建时间来查找文件，-n指n天以内，+n指n天以前 </span><br><span class="line">-nogroup                    #查无有效属组的文件，即文件的属组在/etc/groups中不存在</span><br><span class="line">-nouser                     #查无有效属主的文件，即文件的属主在/etc/passwd中不存</span><br><span class="line">-newer f1 !f2              找文件，-n指n天以内，+n指n天以前 </span><br><span class="line">-ctime   -n +n              #按文件创建时间来查找文件，-n指n天以内，+n指n天以前 </span><br><span class="line">-nogroup                    #查无有效属组的文件，即文件的属组在/etc/groups中不存在</span><br><span class="line">-nouser                     #查无有效属主的文件，即文件的属主在/etc/passwd中不存</span><br><span class="line">-newer f1 !f2              #查更改时间比f1新但比f2旧的文件</span><br><span class="line">-type    b/d/c/p/l/f        #查是块设备、目录、字符设备、管道、符号链接、普通文件</span><br><span class="line">-size     n[c]              #查长度为n块[或n字节]的文件</span><br><span class="line">-depth                      #使查找在进入子目录前先行查找完本目录</span><br><span class="line">-fstype                     #查更改时间比f1新但比f2旧的文件</span><br><span class="line">-type    b/d/c/p/l/f        #查是块设备、目录、字符设备、管道、符号链接、普通文件</span><br><span class="line">-size     n[c]              #查长度为n块[或n字节]的文件</span><br><span class="line">-depth                      #使查找在进入子目录前先行查找完本目录</span><br><span class="line">-fstype                     #查位于某一类型文件系统中的文件，这些文件系统类型通常可 在/etc/fstab中找到</span><br><span class="line">-mount                      #查文件时不跨越文件系统mount点</span><br><span class="line">-follow                     #如果遇到符号链接文件，就跟踪链接所指的文件</span><br><span class="line">-cpio                   #查位于某一类型文件系统中的文件，这些文件系统类型通常可 在/etc/fstab中找到</span><br><span class="line">-mount                      #查文件时不跨越文件系统mount点</span><br><span class="line">-follow                     #如果遇到符号链接文件，就跟踪链接所指的文件</span><br><span class="line">-cpio                       #对匹配的文件使用cpio命令，将他们备份到磁带设备中</span><br><span class="line">-prune                      #忽略某个目录</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="日期"><a href="#日期" class="headerlink" title="日期"></a>日期</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 获取昨天 </span><br><span class="line">date -d &#x27;yesterday&#x27;  # 或 date -d &#x27;last day&#x27; </span><br><span class="line"># 获取明天 </span><br><span class="line">date -d &#x27;tomorrow&#x27;   # 或 date -d &#x27;next day&#x27; </span><br><span class="line"># 获取上个月 </span><br><span class="line">date -d &#x27;last month&#x27; </span><br><span class="line"># 获取下个月 </span><br><span class="line">date -d &#x27;next month&#x27; </span><br><span class="line"># 获取上一年 </span><br><span class="line">date -d ’last year&#x27; </span><br><span class="line"># 获取下一年 </span><br><span class="line">date -d &#x27;next year&#x27; </span><br><span class="line">此外你可以获取多天前，多天后，多个月前，多个月后，多年前或多年后 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 三年前 </span><br><span class="line">date -d &#x27;3 year ago&#x27; </span><br><span class="line"># 五年后 </span><br><span class="line">date -d &#x27;-5 year ago&#x27; </span><br><span class="line"># 两天后 </span><br><span class="line">date -d &#x27;-2 day ago&#x27; </span><br><span class="line"># 一个月前 </span><br><span class="line">date -d &#x27;1 month ago&#x27; </span><br></pre></td></tr></table></figure>
<h3 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#查找指定日期的内容</span><br><span class="line">sed -n &#x27;/^2019-03-14/p&#x27; xxx.info.log &gt; new.log</span><br><span class="line"></span><br><span class="line">#删除指定行</span><br><span class="line">sed -i &#x27;1,14430d&#x27; xx.info.log</span><br><span class="line"></span><br><span class="line">#删除指定行，例如第5行</span><br><span class="line">sed -i &#x27;5 d&#x27; test.txt</span><br><span class="line"></span><br><span class="line">#删除首行</span><br><span class="line">sed -i &#x27;1d&#x27; test.txt</span><br><span class="line"></span><br><span class="line">#删除末行</span><br><span class="line">sed -i &#x27;$d&#x27; test.txt</span><br><span class="line"></span><br><span class="line">#删除空行</span><br><span class="line">sed -i &#x27;/^$/d&#x27; test.txt</span><br><span class="line"></span><br><span class="line">#剔除空格</span><br><span class="line">sed -i &#x27;s/[ ]*//g&#x27; test.txt</span><br><span class="line"></span><br><span class="line">#删除车符</span><br><span class="line">sed -i &#x27;s/^M//g&#x27; test.txt</span><br><span class="line"></span><br><span class="line">#删除指定字段的下一行</span><br><span class="line">sed -i &#x27;/test/&#123;n;d&#125;&#x27; test.txt  #匹配到test字段</span><br><span class="line"></span><br><span class="line">#删除指定字段的上一行</span><br><span class="line">sed -i -e :a -e &#x27;$!N;s/.*n(.*test)/1/;ta&#x27; -e &#x27;P;d&#x27; test.txt    #匹配到test字段</span><br></pre></td></tr></table></figure>


<p>CentOS的启动出错：</p>
<p>当执行 ifup ens33</p>
<p>出现错误：Error:Connection activation failed: No suitable device found for this connection</p>
<p>解决办法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chkconfig NetworkManager off</span><br><span class="line">chkconfig network on</span><br><span class="line">service NetworkManager stop</span><br><span class="line">service network start</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="切割大文件"><a href="#切割大文件" class="headerlink" title="切割大文件"></a>切割大文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">split -b 100m 1111.log (按照字节分隔)</span><br><span class="line">split -l 1000000 1111.log(按照行数分隔)</span><br></pre></td></tr></table></figure>

<h3 id="journalctl日志文件清理"><a href="#journalctl日志文件清理" class="headerlink" title="journalctl日志文件清理"></a>journalctl日志文件清理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">journalctl --disk-usage</span><br><span class="line">Journals take up 3.8G on disk.</span><br></pre></td></tr></table></figure>

<p>手动删除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">journalctl --vacuum-time=7d</span><br><span class="line">journalctl --vacuum-size=1024M</span><br></pre></td></tr></table></figure>
<p>控制目录大小</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/systemd/journald.conf</span><br><span class="line">SystemMaxUse=1G</span><br></pre></td></tr></table></figure>
<p>如果不生效，重启该服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl kill --kill-who=main --signal=SIGUSR2 systemd-journald.service</span><br></pre></td></tr></table></figure>
<p>校验是否正常</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl --verify</span><br></pre></td></tr></table></figure>

<h3 id="安装pip"><a href="#安装pip" class="headerlink" title="安装pip"></a>安装pip</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line"></span><br><span class="line">yum -y install python-pip</span><br></pre></td></tr></table></figure>



<h3 id="Nginx-代理"><a href="#Nginx-代理" class="headerlink" title="Nginx 代理"></a>Nginx 代理</h3><p>作用：给爬虫服务器做代理服务器</p>
<p>遇到的问题：访问部分机器的时候出现少量504错误</p>
<p>解决：<br>    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fastcgi_buffers 8 128k;</span><br><span class="line">send_timeout 60;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#user  nobody;</span><br><span class="line">worker_processes  auto;</span><br><span class="line"></span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  65535;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    fastcgi_buffers 8 128k;</span><br><span class="line">    send_timeout 60;</span><br><span class="line">    gzip  on;</span><br><span class="line"></span><br><span class="line">   server&#123;</span><br><span class="line">        listen   2019;</span><br><span class="line">        resolver 100.100.2.136;</span><br><span class="line">        proxy_connect;</span><br><span class="line">        proxy_connect_allow            443 563;</span><br><span class="line">        proxy_connect_connect_timeout  10s;</span><br><span class="line">        proxy_connect_read_timeout     10s;</span><br><span class="line">        proxy_connect_send_timeout     10s;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_set_header Host $host;</span><br><span class="line">		        proxy_pass	http://$http_host$request_uri;</span><br><span class="line">        	&#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="初试化"><a href="#初试化" class="headerlink" title="初试化"></a>初试化</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chown root:root /etc/passwd /etc/shadow /etc/group /etc/gshadow</span><br><span class="line">chmod 0644 /etc/group  </span><br><span class="line">chmod 0644 /etc/passwd  </span><br><span class="line">chmod 0400 /etc/shadow  </span><br><span class="line">chmod 0400 /etc/gshadow </span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/Kubernetes%E7%9A%84%E8%B0%83%E5%BA%A6.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Kubernetes%E7%9A%84%E8%B0%83%E5%BA%A6.html" class="post-title-link" itemprop="url">Kubernetes的调度</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-31 10:15:08" itemprop="dateCreated datePublished" datetime="2023-10-31T10:15:08+08:00">2023-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/" itemprop="url" rel="index"><span itemprop="name">云原生</span></a>
        </span>
    </span>

  
    <span id="/Kubernetes%E7%9A%84%E8%B0%83%E5%BA%A6.html" class="post-meta-item leancloud_visitors" data-flag-title="Kubernetes的调度" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="调度"><a href="#调度" class="headerlink" title="调度"></a>调度</h2><h3 id="基本概述"><a href="#基本概述" class="headerlink" title="基本概述"></a>基本概述</h3><p>kube-scheduler 是kubernetes 集群的默认调度器，该调度器将Pod绑定在对应的node上，之后对应的node上的kubelet才能够创建和运行Pod。<br>对每个新建的Pod或者未被调度的Pod，kube-scheduler 会选择一个最优的node去运行这个Pod。Pod内的每个容器以及自身都有不通的资源需求。因此，Pod在被调度之前，会根据特定的资源调度需求，对集群中的Node进行一次过滤。<br>调度器会在集群中过滤后的可调度节点，根据一些列函数进行打分，最终选择出得分最高的node。之后，调度器将这个调度通知给kube-apiserver，进行绑定。</p>
<h2 id="亲和性"><a href="#亲和性" class="headerlink" title="亲和性"></a>亲和性</h2><p>原则</p>
<ul>
<li>同时指定了nodeSelector和nodeAffinity，必须同时满足两个条件</li>
<li>如果nodeAffinity指定了多个nodeSelectorTerms，满足一个即可</li>
<li>如果在nodeSelectorTerms中有多个matchExpressions,则一个节点必须满足全部才可以加</li>
<li>如果修改或删除了Pod所调度到的节点的标签，Pod不会被删除</li>
<li>软策略中的weight属性代表权重，范围1-100。如果存在多个软策略的话，权重越大越亲和。对于反亲和规则而言，权重越大越不亲和</li>
</ul>
<p>应用的运行对于kubernetes在亲和性上有一些要求，可以概况为以下几个方面：</p>
<ol>
<li>Pod固定调度的某些节点上</li>
<li>Pod不会调度到某些节点上</li>
<li>Pod的多个副本调度到相同节点上</li>
<li>Pod的多个副本调度不同节点上</li>
</ol>
<h3 id="调度到某些节点上"><a href="#调度到某些节点上" class="headerlink" title="调度到某些节点上"></a>调度到某些节点上</h3><h4 id="方式一、nodeSelector"><a href="#方式一、nodeSelector" class="headerlink" title="方式一、nodeSelector"></a>方式一、nodeSelector</h4><p>在对于Pod的定义中通过nodeSelector指定label，Pod将会只调度到具有该标签的node上。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">  labels:</span><br><span class="line">    <span class="built_in">env</span>: <span class="built_in">test</span></span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx</span><br><span class="line">    image: nginx</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">  nodeSelector:</span><br><span class="line">    disktype: ssd</span><br></pre></td></tr></table></figure>

<p>上述例子中，Pod将会只调度到包含disktype&#x3D;ssd的node上。</p>
<h4 id="方式二、nodeName"><a href="#方式二、nodeName" class="headerlink" title="方式二、nodeName"></a>方式二、nodeName</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: webpc</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: webpc</span><br><span class="line">    spec:</span><br><span class="line">      nodeName: web-server</span><br><span class="line">      ...</span><br></pre></td></tr></table></figure>

<p>上述例子中，将会只调度到主机名为web-server的node上。</p>
<h4 id="方式三、亲和性"><a href="#方式三、亲和性" class="headerlink" title="方式三、亲和性"></a>方式三、亲和性</h4><p>NodeAffinity 亲和性调度，用来取代nodeSelector的策略，支持IN，NOTLn，exists,doesNotExit,GT,Lt。</p>
<p>又分为两类：</p>
<ol>
<li>soft，表示调度的时候，无法满足节点的时候会选择非nodeSelector匹配的节点。PreferredDuringSchedulingIgnoreDuringExecution 优先满足制定规则，并不强求</li>
<li>hard，表示调度的时候，必须满足亲和性设置。requiredDuringSchedulingIgnoredDuringExecution 必须调度到满足条件的节点，如不满足，则一直重试。</li>
</ol>
<p>也可以分为三类：</p>
<ol>
<li>亲和节点 NodeAffinity</li>
<li>亲和Pod podAffinity</li>
<li>不亲和Pod podAntiAffinity</li>
</ol>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: StatefulSet</span><br><span class="line">metadata:</span><br><span class="line">  name: eureka</span><br><span class="line">spec:</span><br><span class="line">  serviceName: <span class="string">&quot;eureka&quot;</span></span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: eureka-pod</span><br><span class="line">  replicas: 3</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: eureka-pod</span><br><span class="line">    spec:</span><br><span class="line">      affinity:</span><br><span class="line">        nodeAffinity:</span><br><span class="line">          requiredDuringSchedulingIgnoredDuringExecution:</span><br><span class="line">            nodeSelectorTerms:</span><br><span class="line">              - matchExpressions:</span><br><span class="line">                - key: kubernetes.io/hostname</span><br><span class="line">                  operator: In</span><br><span class="line">                  values:</span><br><span class="line">                    - k8s-node-217</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证，新的Pod已经调度到k8s-node-217</span></span><br><span class="line">~<span class="comment"># kubectl get pods -o wide |grep eureka</span></span><br><span class="line">eureka-0                  1/1     Running             0          2d23h   10.200.128.142   uat-master     &lt;none&gt;           &lt;none&gt;</span><br><span class="line">eureka-1                  1/1     Running             0          2d23h   10.200.128.141   uat-master     &lt;none&gt;           &lt;none&gt;</span><br><span class="line">eureka-2                  0/1     ContainerCreating   0          1s      &lt;none&gt;           k8s-node-217   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上述示例中，terms满足一个条件就行（或的关系），但是match的条件必须全部满足（且的关系）。</p>
<h3 id="调度到不同的节点"><a href="#调度到不同的节点" class="headerlink" title="调度到不同的节点"></a>调度到不同的节点</h3><p>调度到不同的节点，在亲和性中的应用需要使用到topolgyKey。toplogyKey 对应的值是node上的一个标签的名称，比如节点zone&#x3D;A 标签，其他节点有zone&#x3D;B 标签。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">KIND:     StatefulSet</span><br><span class="line">VERSION:  apps/v1</span><br><span class="line"></span><br><span class="line">RESOURCE: affinity &lt;Object&gt;</span><br><span class="line"></span><br><span class="line">DESCRIPTION:</span><br><span class="line">     If specified, the pod<span class="string">&#x27;s scheduling constraints</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     Affinity is a group of affinity scheduling rules.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">FIELDS:</span></span><br><span class="line"><span class="string">   nodeAffinity	&lt;Object&gt;</span></span><br><span class="line"><span class="string">     Describes node affinity scheduling rules for the pod.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   podAffinity	&lt;Object&gt;</span></span><br><span class="line"><span class="string">     Describes pod affinity scheduling rules (e.g. co-locate this pod in the</span></span><br><span class="line"><span class="string">     same node, zone, etc. as some other pod(s)).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   podAntiAffinity	&lt;Object&gt;</span></span><br><span class="line"><span class="string">     Describes pod anti-affinity scheduling rules (e.g. avoid putting this pod</span></span><br><span class="line"><span class="string">     in the same node, zone, etc. as some other pod(s)).</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">kubectl explain --api-version=apps/v1 sts.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution.topologyKey</span><br><span class="line">KIND:     StatefulSet</span><br><span class="line">VERSION:  apps/v1</span><br><span class="line"></span><br><span class="line">FIELD:    topologyKey &lt;string&gt;</span><br><span class="line"></span><br><span class="line">DESCRIPTION:</span><br><span class="line">     This pod should be co-located (affinity) or not co-located (anti-affinity)</span><br><span class="line">     with the pods matching the labelSelector <span class="keyword">in</span> the specified namespaces, <span class="built_in">where</span></span><br><span class="line">     co-located is defined as running on a node whose value of the label with</span><br><span class="line">     key topologyKey matches that of any node on <span class="built_in">which</span> any of the selected pods</span><br><span class="line">     is running. Empty topologyKey is not allowed.</span><br></pre></td></tr></table></figure>

<p>topology 就是拓扑的意思，指的是一个拓扑域，一个范围的概念，比如一个node、一个机柜、一个机房，实际对应的是node的标签。而这里的topologyKey对应的是node上标签的Key。那么怎么样才算属于一个拓扑域呢？</p>
<p>如果使用<code>k8s.io/hostname</code>，则表示拓扑域为node范围，那么<code>k8s.io/hostname</code> 对应的值不一样的就是不同的拓扑域。比如Pod1在<code>k8s.io/hostname=n1</code>的node上，Pod2在<code>k8s.io/hostname=n2</code>的node上，Pod3在<code>k8s.io/hostname=n1</code>的node上。那么Pod1和Pod3在一个拓扑域，Pod2 则和其他两个Pod不在同一个拓扑域。因此，概况来说，拥有相同标签的key，就可以认定为在同一个拓扑域。</p>
<p>原则上，topologyKey可以是任何合法的标签key，但是有一些限制：</p>
<ol>
<li>topologyKey不可以为空</li>
<li>对于 <code>requiredDuringSchedulingIgnoredDuringExecution</code> 的 Pod 反亲和性，引入 LimitPodHardAntiAffinityTopology 准入控制器来限制 topologyKey 只能是 kubernetes.io&#x2F;hostname。如果要使用自定义拓扑域，则可以修改准入控制器，或者直接禁用它。</li>
<li>对于 preferredDuringSchedulingIgnoredDuringExecution 的 Pod 反亲和性，空的 topologyKey 表示所有拓扑域。除上述情况外，topologyKey 可以是任何合法的标签 key。</li>
</ol>
<p>此外，还有一些官网文档中提示的拓扑域可以使用：</p>
<ol>
<li>topology.kubernetes.io&#x2F;region</li>
<li>topology.kubernetes.io&#x2F;zone</li>
</ol>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: StatefulSet</span><br><span class="line">metadata:</span><br><span class="line">  name: eureka</span><br><span class="line">spec:</span><br><span class="line">  serviceName: <span class="string">&quot;eureka&quot;</span></span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: eureka-pod</span><br><span class="line">  replicas: 3</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: eureka-pod</span><br><span class="line">    spec:</span><br><span class="line">      affinity:</span><br><span class="line">        podAntiAffinity:</span><br><span class="line">          requiredDuringSchedulingIgnoredDuringExecution:</span><br><span class="line">            - topologyKey: kubernetes.io/hostname</span><br><span class="line">              labelSelector:</span><br><span class="line">                matchExpressions:</span><br><span class="line">                - key: app</span><br><span class="line">                  operator: In</span><br><span class="line">                  values:</span><br><span class="line">                  - eureka-pod</span><br></pre></td></tr></table></figure>

<p>上述示例中指定创建了label为<code>app=eureka-pod</code> 的statefulSet，并且指定副本数量为3。根据反亲和性规则，以<code>kubernetes.io/hostname</code>为key的拓扑域，将不会调度到node上已经运行了label为<code>app=eureka-pod</code>的Pod，这样就会将3个副本分别部署在不同hostname的node上。</p>
<p>验证：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~<span class="comment"># kubectl get pods -o wide |grep eureka</span></span><br><span class="line">eureka-0                  1/1     Running   0          5m47s   10.200.128.152   uat-master     &lt;none&gt;           &lt;none&gt;</span><br><span class="line">eureka-1                  0/1     Pending   0          38s     &lt;none&gt;           &lt;none&gt;         &lt;none&gt;           &lt;none&gt;</span><br><span class="line">eureka-2                  1/1     Running   0          108s    10.200.96.155    k8s-node-217   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p>由于示例中只有两个node，因此有一个Pod处于pending状态，但是其他的两个节点均被分配了Pod。</p>
<p>亲和性的进阶应用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  affinity:</span><br><span class="line">    podAntiAffinity:</span><br><span class="line">      requiredDuringSchedulingIgnoredDuringExecution:</span><br><span class="line">        - topologyKey: kubernetes.io/hostname</span><br><span class="line">          labelSelector:</span><br><span class="line">            matchExpressions:</span><br><span class="line">            - key: app</span><br><span class="line">              operator: In</span><br><span class="line">              values:</span><br><span class="line">              - eureka-pod</span><br><span class="line">    podAffinity:</span><br><span class="line">      requiredDuringSchedulingIgnoredDuringExecution:</span><br><span class="line">        - topologyKey: kubernetes.io/hostname</span><br><span class="line">          labelSelector:</span><br><span class="line">            matchExpressions:</span><br><span class="line">            - key: app</span><br><span class="line">              operator: In</span><br><span class="line">              values:</span><br><span class="line">              - geteway-pod</span><br></pre></td></tr></table></figure>

<p>上述例子中，根据反亲和性和亲和性规则，每个节点上都会有eureka-pod的Pod，和gateway-pod的Pod。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/labels-annotations-taints/">https://kubernetes.io/zh/docs/reference/labels-annotations-taints/</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备17063827号-2 </a>
      <img src="https://beian.miit.gov.cn/#/Integrated/index" alt="">
  </div>
  <div class="copyright">
    &copy; 2017 – 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">medivh</span>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"g1GwilqmVAUne2tDEDncEChG-gzGzoHsz","app_key":"YB2e5dSKMmMYYCtaSzxp9fdS","server_url":null,"security":true}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>



</body>
</html>
