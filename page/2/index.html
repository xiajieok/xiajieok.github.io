<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://img.mknight.cn/2018/1545104669394.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://img.mknight.cn/2018/1545104669394.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"econow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Medivh&#39;s castle">
<meta property="og:url" content="https://econow.cn/page/2/index.html">
<meta property="og:site_name" content="Medivh&#39;s castle">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="medivh">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://econow.cn/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Medivh's castle</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Medivh's castle</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">数据蜘蛛工作室</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">medivh</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">95</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">48</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/Grok%20Debugger%20%E6%9C%AC%E5%9C%B0%E5%8C%96%E5%AE%89%E8%A3%85.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Grok%20Debugger%20%E6%9C%AC%E5%9C%B0%E5%8C%96%E5%AE%89%E8%A3%85.html" class="post-title-link" itemprop="url">Grok Debugger本地化安装</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-30 17:45:56" itemprop="dateCreated datePublished" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>由于使用ELK对日志进行集中管理，grok表达式无法验证是否正确，所以使用Grok Debugger进行调试，但是由于国外网站上不去（<a target="_blank" rel="noopener" href="http://grokdebug.herokuapp.com/%EF%BC%89%EF%BC%8C%E4%BB%8A%E5%A4%A9%E5%8E%BB%E7%94%A8%E5%9B%BD%E5%86%85%E7%9A%84%E4%B8%80%E4%B8%AA%E7%BD%91%E7%AB%99%E5%8F%91%E7%8E%B0%E4%B9%9F%E8%BF%9B%E4%B8%8D%E5%8E%BB%E4%BA%86%EF%BC%88http://grok.qiexun.net/%EF%BC%89%EF%BC%8C%E5%A5%BD%E6%97%A0%E5%A5%88%E5%8F%AA%E8%83%BD%E8%87%AA%E5%B7%B1%E5%8A%A8%E6%89%8B%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA">http://grokdebug.herokuapp.com/），今天去用国内的一个网站发现也进不去了（http://grok.qiexun.net/），好无奈只能自己动手搭建一个</a>.</p>
</blockquote>
<p>以下内容参考网络搜索到的资料。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">yum -y install  openssl-devel gcc</span><br><span class="line"></span><br><span class="line">wget https://cache.ruby-china.com/pub/ruby/2.1/ruby-2.1.7.tar.gz</span><br><span class="line"></span><br><span class="line">tar zxvf ruby-2.1.7.tar.gz -C /usr/local/</span><br><span class="line">cd /usr/local/ruby-2.1.7</span><br><span class="line">./configure --prefix=/usr/local/ruby2.1.7</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">echo &#x27;export PATH=/usr/local/ruby2.1.7/bin:$PATH&#x27;&gt;&gt;/etc/profile</span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 安装rubygems工具</span><br><span class="line">[https://rubygems.org/pages/download](https://rubygems.org/pages/download)</span><br><span class="line">wget https://rubygems.org/rubygems/rubygems-3.0.3.tgz</span><br><span class="line">tar zxvf rubygems-3.0.3.tgz -C /usr/local/</span><br><span class="line">cd /usr/local/rubygems-3.0.3/</span><br><span class="line">ruby setup.rb</span><br><span class="line"></span><br><span class="line">#替换gem源</span><br><span class="line">gem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/</span><br><span class="line">gem sources -l</span><br><span class="line"></span><br><span class="line">#Grokbug的安装</span><br><span class="line">mkdir /usr/local/grokbug</span><br><span class="line">cd /usr/local/grokbug</span><br><span class="line">wget https://codeload.github.com/nickethier/grokdebug/zip/master</span><br><span class="line">unzip master</span><br><span class="line">mv grokdebug-master/* .</span><br><span class="line">rm -rf grokdebug-master/</span><br><span class="line"></span><br><span class="line">#查看缺少的组件，这一步的时候报了点错，但是似乎不影响后面的运行。</span><br><span class="line"></span><br><span class="line">ruby config.ru</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#安装组件及对应的版本，缺少什么就再安装什么</span><br><span class="line">gem install bundler</span><br><span class="line">gem install cabin -v=0.5.0</span><br><span class="line">gem install haml -v=3.1.7</span><br><span class="line">gem install jls-grok -v=0.10.10</span><br><span class="line">gem install json -v=1.7.5</span><br><span class="line">gem install kgio -v=2.8.0</span><br><span class="line">gem install rack -v=1.4.1</span><br><span class="line">gem install rack-protection -v=1.2.0</span><br><span class="line">gem install raindrops -v=0.11.0  </span><br><span class="line">gem install shotgun -v=0.9</span><br><span class="line">gem install tilt -v=1.3.3</span><br><span class="line">gem install sinatra -v=1.3.3</span><br><span class="line">gem install unicorn -v=4.6.3</span><br><span class="line"></span><br><span class="line">#替换Google的jquery源，将使用google的源替换为国内的新浪源</span><br><span class="line">cd views</span><br><span class="line">sed -i &#x27;s#//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js#//lib.sinaapp.com/js/jquery/1.8.1/jquery.min.js#g&#x27; index.haml</span><br><span class="line">sed -i &#x27;s#//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js#//lib.sinaapp.com/js/jquery-ui/1.9.2/jquery-ui.min.js#g&#x27; index.haml</span><br><span class="line">sed -i &#x27;s#//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js#//lib.sinaapp.com/js/jquery/1.7.2/jquery.min.js#g&#x27; patterns.haml</span><br><span class="line">sed -i &#x27;s#//ajax.googleapis.com/ajax/libs/jqueryui/1.9.0/themes/ui-lightness/jquery-ui.css#//lib.sinaapp.com/js/jquery-ui/1.9.0/themes/ui-lightness/jquery-ui.css#g&#x27; layout.haml</span><br><span class="line">sed -i &#x27;s#//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js#//lib.sinaapp.com/js/jquery/1.7.2/jquery.min.js#g&#x27; discover.haml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#启动服务，9333 就是访问的端口，可以自定义</span><br><span class="line">cd /usr/local/grokbug</span><br><span class="line">unicorn -p 9333 -c ./unicorn  #仅一次运行</span><br><span class="line">#后台运行</span><br><span class="line">nohup bundle exec unicorn -p 9333 -c ./unicorn &amp;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/Python%E5%B8%B8%E7%94%A8%E6%95%B4%E7%90%86.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Python%E5%B8%B8%E7%94%A8%E6%95%B4%E7%90%86.html" class="post-title-link" itemprop="url">Python常用整理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-30 17:45:56" itemprop="dateCreated datePublished" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="logging-日志模块写入中文编码错误解决方法"><a href="#logging-日志模块写入中文编码错误解决方法" class="headerlink" title="logging 日志模块写入中文编码错误解决方法"></a>logging 日志模块写入中文编码错误解决方法</h3><p>在logging.FileHandler(path) 中添加指定编码方式 encoding&#x3D;’utf-8’ 即可，logging.FileHandler(path, encoding&#x3D;’utf-8’) 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># @Time    : 18/8/16 10:40</span><br><span class="line"># @Author  : Medivh</span><br><span class="line"></span><br><span class="line">import functools</span><br><span class="line">import logging</span><br><span class="line">import logging.handlers</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">LOG_FILE = os.path.join(os.path.dirname(os.path.realpath(__file__)), &#x27;logs&#x27;, &#x27;logger.log&#x27;)</span><br><span class="line">handler = logging.handlers.RotatingFileHandler(LOG_FILE, maxBytes=1024 * 1024, backupCount=10, encoding=&#x27;utf-8&#x27;)</span><br><span class="line">fmt = &#x27;[%(levelname)s]: %(asctime)s - %(filename)s - %(funcName)s - %(threadName)s - %(message)s&#x27;</span><br><span class="line"></span><br><span class="line">formatter = logging.Formatter(fmt)</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(&#x27;logger&#x27;)</span><br><span class="line">logger.addHandler(handler)</span><br><span class="line">logger.setLevel(logging.INFO)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def log(func):</span><br><span class="line">    @functools.wraps(func)</span><br><span class="line">    def wrapper(*args, **kw):</span><br><span class="line">        logging.info(&#x27;call %s():&#x27; % func.__name__)</span><br><span class="line">        return func(*args, **kw)</span><br><span class="line"></span><br><span class="line">    return wrapper</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/%E4%BD%BF%E7%94%A8Cloudera%E9%83%A8%E7%BD%B2%E5%92%8C%E7%AE%A1%E7%90%86hadoop%E9%9B%86%E7%BE%A4.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E4%BD%BF%E7%94%A8Cloudera%E9%83%A8%E7%BD%B2%E5%92%8C%E7%AE%A1%E7%90%86hadoop%E9%9B%86%E7%BE%A4.html" class="post-title-link" itemprop="url">使用Cloudera部署和管理hadoop集群</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-30 17:45:56" itemprop="dateCreated datePublished" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Cloude Manager 概述：</p>
<p>CDH 是 Cloudera 公司对整体 hadoop 集群环境进行监控与管理的企业级大数据管理平台。</p>
<p>Cloudera Manager 分为：</p>
<p>Cloudera Manager Server：对整个集群提供监控与管理操作。Cloudera Manager Server 通过部署在不同设备上的 Cloudera Manager Agent 进行管理整体集群。Cloudera Manager Server 需要部署在一台设备上。</p>
<p>Cloudera Manager Agent：部署在每个需要监控与管理的设备上。负责采集运行数据与执行下发的管理命令。</p>
<p>DataBase：关系型数据库是 Cloudera Manager 执行管理操作时，存储整体集群情况数据</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>先安装 Cloudrea Manager，再通过 Cloudrea Manager 在节点上安装 Cloudrea Manager 客户端，CDH，管理工具。<br><a target="_blank" rel="noopener" href="https://www.cloudera.com/documentation/manager/5-1-x.html">官方文档</a></p>
<h3 id="一、环境需求"><a href="#一、环境需求" class="headerlink" title="一、环境需求:"></a>一、环境需求:</h3><ul>
<li>关闭 selinux</li>
<li>各节点可以 SSH 登陆</li>
<li>在&#x2F;etc&#x2F;hosts 中添加各节点的主机名</li>
</ul>
<h3 id="二、环境准备"><a href="#二、环境准备" class="headerlink" title="二、环境准备"></a>二、环境准备</h3><p>1、修改以下参数，否则检查主机正确性时会出现 “已启用“透明大页面”，它可能会导致重大的性能问题。” 的警告</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line"></span><br><span class="line"># vi /etc/rc.local</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br></pre></td></tr></table></figure>

<p>2、取代默认 JDK</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/java</span><br><span class="line">ln -s /usr/local/jdk1.8.0_91/ /usr/java/default</span><br></pre></td></tr></table></figure>

<p>因为默认情况下安装 Cloudrea Manager 的时候会自动安装一个 JDK7，所以在这里提前替换一下。如果之后检查的时候不生效，注意删除 JDK7，然后重启服务。正常的目录如下：<br><img src="https://img.mknight.cn/medivh/1550050311058.png" /></p>
<h3 id="三、安装-Cloudrea-Manager"><a href="#三、安装-Cloudrea-Manager" class="headerlink" title="三、安装 Cloudrea Manager"></a>三、安装 Cloudrea Manager</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/src</span><br><span class="line">wget http://archive.cloudera.com/cm5/installer/latest/cloudera-manager-installer.bin</span><br><span class="line">chmod +x cloudera-manager-installer.bin</span><br><span class="line">./cloudera-manager-installer.bin</span><br></pre></td></tr></table></figure>

<p>然后会出现以下画面，点击 Next 或者<Yes>,开始安装<br><img src="https://img.mknight.cn/medivh/1550039104564.png" /></p>
<img src="https://img.mknight.cn/medivh/1550039166335.png" />
最后安装完成，提示访问7180端口,账号密码都是admin
<img src="https://img.mknight.cn/medivh/1550039183944.png" />

<h3 id="四、数据库准备工作"><a href="#四、数据库准备工作" class="headerlink" title="四、数据库准备工作"></a>四、数据库准备工作</h3><h4 id="1-Mysql-Install"><a href="#1-Mysql-Install" class="headerlink" title="1. Mysql Install"></a>1. Mysql Install</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh  http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm</span><br><span class="line">yum install mysql-server</span><br></pre></td></tr></table></figure>

<h4 id="2-Installing-the-MySQL-JDBC-Driver"><a href="#2-Installing-the-MySQL-JDBC-Driver" class="headerlink" title="2. Installing the MySQL JDBC Driver"></a>2. Installing the MySQL JDBC Driver</h4><p>If you already have the JDBC driver installed on the hosts that need it, you can skip this section. However, MySQL 5.6 requires a 5.1 driver version 5.1.26 or higher.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/src</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.46.tar.gz</span><br><span class="line">tar zxvf mysql-connector-java-5.1.46.tar.gz</span><br><span class="line">mkdir -pv /usr/share/java</span><br><span class="line">cd mysql-connector-java-5.1.46</span><br><span class="line">sudo cp mysql-connector-java-5.1.46-bin.jar /usr/share/java/mysql-connector-java.jar</span><br></pre></td></tr></table></figure>

<h4 id="3-Creating-Databases-for-Cloudera-Software"><a href="#3-Creating-Databases-for-Cloudera-Software" class="headerlink" title="3. Creating Databases for Cloudera Software"></a>3. Creating Databases for Cloudera Software</h4><p>以下数据库名称仅供参考，只要匹配得上就行<br><img src="https://img.mknight.cn/medivh/1550139934136.png" /></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br><span class="line">&gt; create database scm;</span><br><span class="line">&gt; grant all on *.* to &#x27;scm&#x27;@&#x27;%&#x27; identified by &#x27;scm&#x27; with grant option;</span><br><span class="line">&gt; create database hive_metastore;</span><br><span class="line">&gt; grant all on hive_metastore.* to &#x27;hive&#x27;@&#x27;%&#x27; identified by &#x27;hive&#x27; with grant option;</span><br><span class="line">&gt; flush privileges;</span><br></pre></td></tr></table></figure>

<h4 id="4-Set-up-the-Cloudera-Manager-Database"><a href="#4-Set-up-the-Cloudera-Manager-Database" class="headerlink" title="4. Set up the Cloudera Manager Database"></a>4. Set up the Cloudera Manager Database</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/cloudera/cm/schema/scm_prepare_database.sh  mysql cm -hlocalhost -uscm -pscm --scm-host localhost scm scm scm</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.cloudera.com/documentation/enterprise/latest/topics/prepare_cm_database.html">详细参数参考</a></p>
<h3 id="五、安装-Cloudrea-Agent"><a href="#五、安装-Cloudrea-Agent" class="headerlink" title="五、安装 Cloudrea Agent"></a>五、安装 Cloudrea Agent</h3><h4 id="1-搜索主机"><a href="#1-搜索主机" class="headerlink" title="1.搜索主机"></a>1.搜索主机</h4><img src="https://img.mknight.cn/medivh/1550039268472.png" />
注意搜索的时候主机名以逗号隔开，选择后点击继续。
#### 2.选择版本
选择使用Parcel安装，选择CDH版本,默认即可
<img src="https://img.mknight.cn/medivh/1550039358949.png" />
然后选择是否安装JDK，如果已经安装了，这里就不需要勾选
<img src="https://img.mknight.cn/medivh/1550039397866.png" />
#### 3.授权
默认使用root用户，提供公钥或者密码来授权连接
<img src="https://img.mknight.cn/medivh/1550039466326.png" />
选择继续安装
<img src="https://img.mknight.cn/medivh/1550039533173.png" />
如果安装过程中，下载安装jdk 或 cloudera-manager-agent失败，可以在节点上手动安装，然后再在Cloudrea  Manager上继续安装。此处的JDK只是为了启动CM，和以后要用的JDK不是一回事！

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install jdk</span><br><span class="line">yum -y install oracle-j2sdk1.7</span><br><span class="line">yum -y install cloudera-manager-agent</span><br></pre></td></tr></table></figure>

<h4 id="4-分配-Parcelf"><a href="#4-分配-Parcelf" class="headerlink" title="4.分配 Parcelƒ"></a>4.分配 Parcelƒ</h4><p>下载 Parcel 并分配 Parcel 到各节点</p>
<img src="https://img.mknight.cn/medivh/1550039893581.png" />

<p>注意如果下载完后长时间不动，检查日志</p>
<p>分配完成后点击继续，进行主机检查<br><img src="https://img.mknight.cn/medivh/1550050454788.png" /><br>标注的为有可能出现问题的地方。解决后，选择重新检查即可。如果验证部分通过，下面的版本部分出现不适用也可以忽略。</p>
<h3 id="六、添加-Services"><a href="#六、添加-Services" class="headerlink" title="六、添加 Services"></a>六、添加 Services</h3><h4 id="1-选择服务"><a href="#1-选择服务" class="headerlink" title="1.选择服务"></a>1.选择服务</h4><img src="https://img.mknight.cn/medivh/1550140558695.png" />
此处会有add 的选项，点击

<p>根据个人需求选择安装服务类型，也可以 选择自定义<br><img src="https://img.mknight.cn/medivh/1550197444765.png" /></p>
<blockquote>
<p>The Select Services page allows you to select the services you want to install and configure. Make sure that you have the appropriate license key for the services you want to use. You can choose from Cloudera Essentials, Data Engineering, Analytic Database, Operational Database, All Services, and Custom Services. To include Cloudera Navigator data management, check the box labeled Include Cloudera Navigator.</p>
</blockquote>
<p>服务选择页面允许你选择你想要的服务，然后选择继续。</p>
<blockquote>
<p>After selecting the services you want to add, click Continue. The Assign Roles page displays.</p>
</blockquote>
<h4 id="2-Assign-Roles-角色分配"><a href="#2-Assign-Roles-角色分配" class="headerlink" title="2.Assign Roles 角色分配"></a>2.Assign Roles 角色分配</h4><blockquote>
<p>The Assign Roles page suggests role assignments for the hosts in your cluster. You can click on the hostname for a role to select a different host. You can also click the View By Host button to see all the roles assigned to a host.<br>To review the recommended role assignments, see Recommended Cluster Hosts and Role Distribution.<br>After assigning all of the roles for your services, click Continue. The Setup Database page displays.</p>
</blockquote>
<p>简单说就是根据实际情况来分配对应角色。<br><img src="https://img.mknight.cn/medivh/1550197498148.png" /></p>
<p><a target="_blank" rel="noopener" href="https://www.cloudera.com/documentation/enterprise/latest/topics/cm_ig_host_allocations.html#host_role_assignments">官网推荐分配策略参考</a><br>下面分别列出 3-10 和 3-20 台服务器的建议<br><img src="https://img.mknight.cn/medivh/1550196758734.png" /></p>
<img src="https://img.mknight.cn/medivh/1550196815297.png" />
下图为实际情况5个节点的分配
<img src="https://img.mknight.cn/medivh/1550196894404.png" />
#### 3.Setup Database
>On the Setup Database page, you can enter the database names, usernames, and passwords you created in Step 4: Install and Configure Databases.
现在开始填写数据库信息，地址、账号和密码，就是之前准备环境的时候创建的库。
>Select the database type and enter the database name, username, and password for each service. Click Test Connection to validate the settings. If the connection is successful, a green checkmark and the word Successful appears next to each service. If there are any problems, the error is reported next to the service that failed to connect.

<blockquote>
<p>After verifying that each connection is successful, click Continue. The Review Changes page displays.</p>
</blockquote>
<img src="https://img.mknight.cn/medivh/1550197550054.png" />
注意选择Mysql！填写完成后记得验证一下。下面的库就是之前创建好的
<img src="https://img.mknight.cn/medivh/1550197181087.png" />
现在表是空的，之后就会创建以下的表
<img src="https://img.mknight.cn/medivh/1550197226238.png" />
#### 4.启动服务
<img src="https://img.mknight.cn/medivh/1550197594729.png" />
一般情况下除了hive以外，其他的服务都会正常启动。这个时候就要去修改以下hive配置。另外开一个页面，按照截图修改！
<img src="https://img.mknight.cn/medivh/1550197756375.png" />
这样之前的hive元数据库就会自动创建表了。

<h2 id="集群验证"><a href="#集群验证" class="headerlink" title="集群验证"></a>集群验证</h2><h3 id="1-服务状态验证"><a href="#1-服务状态验证" class="headerlink" title="1.服务状态验证"></a>1.服务状态验证</h3><img src="https://img.mknight.cn/medivh/1550197833064.png" />
这样所有的服务都绿了。
### 2.主机状态
<img src="https://img.mknight.cn/medivh/1550198340635.png" />
状态正常，且心跳时间小于15秒
### 3.1任务测试一
登任意主机，执行下面任务（用Hadoop计算PI值，圆周率）
10指的是要运行10次map任务，10000指的是每个map任务，要投掷多少次，2个参数的乘积就是总的投掷次数。 
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop jar /opt/cloudera/parcels/CDH/lib/hadoop-mapreduce/hadoop-mapreduce-examples.jar pi 10 10000</span><br></pre></td></tr></table></figure>
<img src="https://img.mknight.cn/medivh/1550198625749.png" />
然后在群集-》Cluster1-》Yarn-》应用程序查看执行结果
<img src="https://img.mknight.cn/medivh/1550199361878.png" />

<p>执行结果：<br><img src="https://img.mknight.cn/medivh/1550198647297.png" /></p>
<h4 id="3-2-任务测试二"><a href="#3-2-任务测试二" class="headerlink" title="3.2 任务测试二"></a>3.2 任务测试二</h4><p>1.编辑一段文本，示例如下；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">aslkl hello</span><br><span class="line">hah</span><br><span class="line">hah</span><br><span class="line">hi</span><br><span class="line">en</span><br><span class="line">word</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>

<p>2.上传文件到 hdfs</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -mkdir /test</span><br><span class="line">#如果提示没有权限，记得修改一下</span><br><span class="line">hadoop fs -chmod 777 -R /</span><br><span class="line">hadoop fs -put s.txt  /test</span><br><span class="line">#上传</span><br><span class="line">hadoop jar /opt/cloudera/parcels/CDH/lib/hadoop-mapreduce/hadoop-mapreduce-examples.jar wordcount /test/s.txt /out/</span><br><span class="line">#执行</span><br><span class="line">hadoop fs -text  /out/*</span><br><span class="line">#查看结果</span><br></pre></td></tr></table></figure>

<h4 id="4-1-MapReduce-测试"><a href="#4-1-MapReduce-测试" class="headerlink" title="4.1 MapReduce 测试"></a>4.1 MapReduce 测试</h4><p>创建表<br><img src="https://img.mknight.cn/medivh/1550202246962.png" /><br>执行操作<br><img src="https://img.mknight.cn/medivh/1550202281115.png" /><br>OK！</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="1-优化访问速度"><a href="#1-优化访问速度" class="headerlink" title="1.优化访问速度"></a>1.优化访问速度</h3><img src="https://img.mknight.cn/medivh/1550199570686.png" />
### 2.部分命令
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service cloudera-scm-server stop </span><br><span class="line">service cloudera-scm-server-db stop</span><br><span class="line">#内置PostgreSQL</span><br><span class="line">service cloudera-scm-agent stop</span><br></pre></td></tr></table></figure>
### 3.邮件报警
#### 1.配置邮箱
点击 cloudera manager service 
<img src="https://img.mknight.cn/medivh/1550394449078.png" />
点击配置，搜索alert，根据实际情况填写邮箱信息。注意区分25和465端口，并且保证邮箱地址正确。
<img src="https://img.mknight.cn/medivh/1550394622296.png" />
页眉和页脚随意修改
<img src="https://img.mknight.cn/medivh/1550394734754.png" />
修改完成后点击保存，然后重启！

<h4 id="2-测试邮件"><a href="#2-测试邮件" class="headerlink" title="2.测试邮件"></a>2.测试邮件</h4><img src="https://img.mknight.cn/medivh/1550394787512.png" />
点击发送测试即可
<img src="https://img.mknight.cn/medivh/1550394808019.png" />
这样就收到了测试邮件。
<img src="https://img.mknight.cn/medivh/1550394890160.png" />
#### 3.可能出现的问题
* 日志报localhost和25端口 
<img src="https://img.mknight.cn/medivh/1550395083684.png" />
原因是修改配置后没有重启cloudera manager service 
* QQ邮箱报535错误
<img src="https://img.mknight.cn/medivh/1550394953596.png" />
检查用户名和授权码是否正确。注意QQ邮箱的是授权码不是纯粹的密码

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/Logstash%20%E8%BE%93%E5%87%BA%E5%88%B0%20hdfs.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Logstash%20%E8%BE%93%E5%87%BA%E5%88%B0%20hdfs.html" class="post-title-link" itemprop="url">Logstash 输出到 hdfs</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-30 17:45:56" itemprop="dateCreated datePublished" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>由于ES集群价格较为昂贵，相对来讲还是Hadoop平台便宜，耐用。</p>
</blockquote>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>logstash 可以直接把文件内容写入 hdfs 中， 并支持 hdfs 压缩格式。但是需要安装第三方插件，webhdfs插件，通过hdfs的web接口写入，即 <a target="_blank" rel="noopener" href="http://namenode00:50070/webhdfs/v1/">http://namenode00:50070/webhdfs/v1/</a> 接口。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/elk/logstash/bin/logstash-plugin install logstash-output-webhdfs-discontinued</span><br></pre></td></tr></table></figure>
<p>一般情况下不会出问题，至少我目前没有遇到过。</p>
<h3 id="检查hdfs端口是否可访问"><a href="#检查hdfs端口是否可访问" class="headerlink" title="检查hdfs端口是否可访问"></a>检查hdfs端口是否可访问</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl  hdfs:50070</span><br></pre></td></tr></table></figure>

<h2 id="配置output"><a href="#配置output" class="headerlink" title="配置output"></a>配置output</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">input&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">fileter&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output&#123;</span><br><span class="line">    if [serverType] == &quot;xxxx&quot; &#123;</span><br><span class="line">       webhdfs &#123;</span><br><span class="line">        host =&gt; &quot;x.x.x.x&quot; # hdfs 主机</span><br><span class="line">        port =&gt; 50070   # hdfs 端口</span><br><span class="line">        flush_size =&gt; 500</span><br><span class="line">        idle_flush_time =&gt; 10</span><br><span class="line">        user =&gt; &quot;hdfs&quot;   # hdfs 用户</span><br><span class="line">        path =&gt; &quot;/data/log/%&#123;+YYYYMMdd&#125;_xxxxx.log&quot;</span><br><span class="line">        compression =&gt; &quot;gzip&quot;   # 压缩模式</span><br><span class="line">        codec =&gt; &#x27;json&#x27;         </span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置好重启即可。</p>
<h2 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h2><p>上述配置文件中基本为必选项或者为建议参考值。</p>
<img src="https://img.mknight.cn/medivh/1568025146014.png"  />
<img src="https://img.mknight.cn/medivh/1568025165706.png"  />


<h3 id="压缩模式说明"><a href="#压缩模式说明" class="headerlink" title="压缩模式说明"></a>压缩模式说明</h3><img src="https://img.mknight.cn/medivh/1568025379386.png"  />

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/logstash/6.4/plugins-outputs-webhdfs.html">https://www.elastic.co/guide/en/logstash/6.4/plugins-outputs-webhdfs.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/OpenVpn%20%E6%9C%80%E6%96%B0%E7%89%88%E9%83%A8%E7%BD%B2.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/OpenVpn%20%E6%9C%80%E6%96%B0%E7%89%88%E9%83%A8%E7%BD%B2.html" class="post-title-link" itemprop="url">OpenVpn 最新版部署</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-30 17:45:56" itemprop="dateCreated datePublished" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="1、yum方式（推荐）"><a href="#1、yum方式（推荐）" class="headerlink" title="1、yum方式（推荐）"></a>1、yum方式（推荐）</h3><p>推荐使用yum方式安装，因为之前曾经发生过莫名其妙服务自己停止的情况。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install openvpn open-ssl -y</span><br><span class="line">yum install easy-rsa openssl  -y</span><br></pre></td></tr></table></figure>
<h3 id="2、编译安装"><a href="#2、编译安装" class="headerlink" title="2、编译安装"></a>2、编译安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yum install pam-devel open-ssl -y</span><br><span class="line"></span><br><span class="line">cd /usr/src</span><br><span class="line">wget http://www.oberhumer.com/opensource/lzo/download/lzo-2.06.tar.gz</span><br><span class="line">tar zxvf lzo-2.06.tar.gz</span><br><span class="line">cd lzo-2.06</span><br><span class="line">./configure --prefix=/usr/local/</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">cd /usr/src</span><br><span class="line">tar -zxvf openvpn-2.4.6.tar.gz</span><br><span class="line"> cd openvpn-2.4.6</span><br><span class="line">./configure --prefix=/usr/local/openvpn --with-lzo-lib=/usr/local/lzo/lib --with-lzo-headers=/usr/local/lzo/include/</span><br></pre></td></tr></table></figure>
<h2 id="证书配置"><a href="#证书配置" class="headerlink" title="证书配置"></a>证书配置</h2><p>当前配置是按照编译安装的目录，yum安装目录在&#x2F;etc&#x2F;openvpn</p>
<h3 id="创建-PKI-和-CA"><a href="#创建-PKI-和-CA" class="headerlink" title="创建 PKI 和 CA"></a>创建 PKI 和 CA</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@localhost 3.0.3]# pwd</span><br><span class="line">/etc/openvpn/server</span><br><span class="line">[root@localhost 3.0.3]# cp -r  /usr/share/easy-rsa .</span><br><span class="line">[root@localhost 3.0.3]# rm 3 3.0 </span><br><span class="line">[root@localhost 3.0.3]# cd /etc/openvpn/server/easy-rsa/3.0.3</span><br><span class="line">[root@localhost 3.0.3]# ./easyrsa init-pki  #创建空的pki</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line"></span><br><span class="line">init-pki complete; you may now create a CA or requests.</span><br><span class="line">Your newly created PKI dir is: /etc/openvpn/easy-rsa/3.0.3/pki</span><br><span class="line"></span><br><span class="line">[root@localhost 3.0.3]# ./easyrsa build-ca nopass #创建新的CA，不使用密码</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line">Generating a 2048 bit RSA private key</span><br><span class="line">......................+++</span><br><span class="line">................................................+++</span><br><span class="line">writing new private key to &#x27;/etc/openvpn/easy-rsa/3.0.3/pki/private/ca.key.pClvaQ1GLD&#x27;</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#x27;.&#x27;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Common Name (eg: your user, host, or server name) [Easy-RSA CA]: 回车</span><br><span class="line"></span><br><span class="line">CA creation complete and you may now import and sign cert requests.</span><br><span class="line">Your new CA certificate file for publishing is at:</span><br><span class="line">/etc/openvpn/easy-rsa/3.0.3/pki/ca.crt</span><br></pre></td></tr></table></figure>
<h4 id="创建服务端证书"><a href="#创建服务端证书" class="headerlink" title="创建服务端证书"></a>创建服务端证书</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost 3.0.3]# ./easyrsa gen-req server nopass</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line">Generating a 2048 bit RSA private key</span><br><span class="line">...........................+++</span><br><span class="line">..............................................................................+++</span><br><span class="line">writing new private key to &#x27;/etc/openvpn/easy-rsa/3.0.3/pki/private/server.key.wy7Q0fuG6A&#x27;</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#x27;.&#x27;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Common Name (eg: your user, host, or server name) [server]: 回车</span><br><span class="line"></span><br><span class="line">Keypair and certificate request completed. Your files are:</span><br><span class="line">req: /etc/openvpn/easy-rsa/3.0.3/pki/reqs/server.req</span><br><span class="line">key: /etc/openvpn/easy-rsa/3.0.3/pki/private/server.key</span><br></pre></td></tr></table></figure>
<h4 id="签约服务端证书"><a href="#签约服务端证书" class="headerlink" title="签约服务端证书"></a>签约服务端证书</h4><p>注意操作目录是在server目录里的  <code>/etc/openvpn/server/easy-rsa/3.0.3</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost 3.0.3]# ./easyrsa sign server server</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">You are about to sign the following certificate.</span><br><span class="line">Please check over the details shown below for accuracy. Note that this request</span><br><span class="line">has not been cryptographically verified. Please be sure it came from a trusted</span><br><span class="line">source or that you have verified the request checksum with the sender.</span><br><span class="line"></span><br><span class="line">Request subject, to be signed as a server certificate for 3650 days:</span><br><span class="line"></span><br><span class="line">subject=</span><br><span class="line">    commonName                = server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Type the word &#x27;yes&#x27; to continue, or any other input to abort.</span><br><span class="line">  Confirm request details: yes</span><br><span class="line">Using configuration from ./openssl-1.0.cnf</span><br><span class="line">Check that the request matches the signature</span><br><span class="line">Signature ok</span><br><span class="line">The Subject&#x27;s Distinguished Name is as follows</span><br><span class="line">commonName            :ASN.1 12:&#x27;server&#x27;</span><br><span class="line">Certificate is to be certified until Apr  7 14:54:08 2028 GMT (3650 days)</span><br><span class="line"></span><br><span class="line">Write out database with 1 new entries</span><br><span class="line">Data Base Updated</span><br><span class="line"></span><br><span class="line">Certificate created at: /etc/openvpn/easy-rsa/3.0.3/pki/issued/server.crt</span><br></pre></td></tr></table></figure>
<h4 id="创建-Diffie-Hellman"><a href="#创建-Diffie-Hellman" class="headerlink" title="创建 Diffie-Hellman"></a>创建 Diffie-Hellman</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost 3.0.3]# ./easyrsa gen-dh</span><br><span class="line">............................................................</span><br><span class="line">DH parameters of size 2048 created at /etc/openvpn/easy-rsa/3.0.3/pki/dh.pem</span><br></pre></td></tr></table></figure>
<h3 id="创建客户端证书"><a href="#创建客户端证书" class="headerlink" title="创建客户端证书"></a>创建客户端证书</h3><h4 id="复制文件"><a href="#复制文件" class="headerlink" title="复制文件"></a>复制文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp -r /usr/share/easy-rsa/ /etc/openvpn/client/easy-rsa</span><br><span class="line">cd /etc/openvpn/client/easy-rsa/</span><br><span class="line">rm 3 3.0</span><br><span class="line">cd 3.0.3/</span><br><span class="line">find /usr/share/doc/easy-rsa-3.0.3/vars.example -type f -name &quot;vars.example&quot; | xargs -i cp &#123;&#125; . &amp;&amp; mv vars.example vars</span><br></pre></td></tr></table></figure>
<h4 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h4><p>操作目录 <code>/etc/openvpn/server/easy-rsa/3.0.3</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost 3.0.3]# pwd</span><br><span class="line">/etc/openvpn/client/easy-rsa/3.0.3</span><br><span class="line">[root@localhost 3.0.3]# ./easyrsa init-pki #创建新的pki</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line"></span><br><span class="line">init-pki complete; you may now create a CA or requests.</span><br><span class="line">Your newly created PKI dir is: /etc/openvpn/client/easy-rsa/3.0.3/pki</span><br><span class="line">[root@localhost 3.0.3]# ./easyrsa gen-req joy01 nopass  #客户证书名为joy01，木有密码</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line">Generating a 2048 bit RSA private key</span><br><span class="line">....................................................+++</span><br><span class="line">............+++</span><br><span class="line">writing new private key to &#x27;/etc/openvpn/client/easy-rsa/3.0.3/pki/private/joy01.key.FkrLzXH9Bm&#x27;</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#x27;.&#x27;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Common Name (eg: your user, host, or server name) [joy01]: 回车</span><br><span class="line"></span><br><span class="line">Keypair and certificate request completed. Your files are:</span><br><span class="line">req: /etc/openvpn/client/easy-rsa/3.0.3/pki/reqs/joy01.req</span><br><span class="line">key: /etc/openvpn/client/easy-rsa/3.0.3/pki/private/joy01.key</span><br></pre></td></tr></table></figure>
<h4 id="签约客户端证书"><a href="#签约客户端证书" class="headerlink" title="签约客户端证书"></a>签约客户端证书</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost 3.0.3]# cd /etc/openvpn/server/easy-rsa/3.0.3/</span><br><span class="line">[root@localhost 3.0.3]# pwd</span><br><span class="line">/etc/openvpn/server/easy-rsa/3.0.3</span><br><span class="line">[root@localhost 3.0.3]# ./easyrsa import-req /etc/openvpn/client/easy-rsa/3.0.3/pki/reqs/joy01.req joy01</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line"></span><br><span class="line">The request has been successfully imported with a short name of: joy01</span><br><span class="line">You may now use this name to perform signing operations on this request.</span><br><span class="line"></span><br><span class="line">[root@localhost 3.0.3]# ./easyrsa sign client joy01</span><br><span class="line"></span><br><span class="line">Note: using Easy-RSA configuration from: ./vars</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">You are about to sign the following certificate.</span><br><span class="line">Please check over the details shown below for accuracy. Note that this request</span><br><span class="line">has not been cryptographically verified. Please be sure it came from a trusted</span><br><span class="line">source or that you have verified the request checksum with the sender.</span><br><span class="line"></span><br><span class="line">Request subject, to be signed as a client certificate for 3650 days:</span><br><span class="line"></span><br><span class="line">subject=</span><br><span class="line">    commonName                = joy01</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Type the word &#x27;yes&#x27; to continue, or any other input to abort.</span><br><span class="line">  Confirm request details: yes</span><br><span class="line">Using configuration from ./openssl-1.0.cnf</span><br><span class="line">Check that the request matches the signature</span><br><span class="line">Signature ok</span><br><span class="line">The Subject&#x27;s Distinguished Name is as follows</span><br><span class="line">commonName            :ASN.1 12:&#x27;joy01&#x27;</span><br><span class="line">Certificate is to be certified until Apr  8 01:54:57 2028 GMT (3650 days)</span><br><span class="line"></span><br><span class="line">Write out database with 1 new entries</span><br><span class="line">Data Base Updated</span><br><span class="line"></span><br><span class="line">Certificate created at: /etc/openvpn/easy-rsa/3.0.3/pki/issued/joy01.crt</span><br></pre></td></tr></table></figure>
<h3 id="整理证书"><a href="#整理证书" class="headerlink" title="整理证书"></a>整理证书</h3><h4 id="server-端证书"><a href="#server-端证书" class="headerlink" title="server 端证书"></a>server 端证书</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir /etc/openvpn/certs</span><br><span class="line">[root@localhost ~]# cd /etc/openvpn/certs/</span><br><span class="line">[root@localhost certs]# cp /etc/openvpn/easy-rsa/3.0.3/pki/dh.pem .</span><br><span class="line">[root@localhost certs]# cp /etc/openvpn/easy-rsa/3.0.3/pki/ca.crt .</span><br><span class="line">[root@localhost certs]# cp /etc/openvpn/easy-rsa/3.0.3/pki/issued/server.crt .</span><br><span class="line">[root@localhost certs]# cp /etc/openvpn/easy-rsa/3.0.3/pki/private/server.key .</span><br><span class="line">[root@localhost certs]# ll</span><br><span class="line">总用量 20</span><br><span class="line">-rw-------. 1 root root 1172 4月  11 10:02 ca.crt</span><br><span class="line">-rw-------. 1 root root  424 4月  11 10:03 dh.pem</span><br><span class="line">-rw-------. 1 root root 4547 4月  11 10:03 server.crt</span><br><span class="line">-rw-------. 1 root root 1704 4月  11 10:02 server.key</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="client-端"><a href="#client-端" class="headerlink" title="client 端"></a>client 端</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost certs]# mkdir /etc/openvpn/client/joy01/</span><br><span class="line">[root@localhost certs]# cp /etc/openvpn/easy-rsa/3.0.3/pki/ca.crt /etc/openvpn/client/joy01/</span><br><span class="line">[root@localhost certs]# cp /etc/openvpn/easy-rsa/3.0.3/pki/issued/joy01.crt /etc/openvpn/client/joy01/</span><br><span class="line">[root@localhost certs]# cp /etc/openvpn/client/easy-rsa/3.0.3/pki/private/joy01.key /etc/openvpn/client/joy01/</span><br><span class="line">[root@localhost certs]# ll /etc/openvpn/client/joy01/</span><br><span class="line">总用量 16</span><br><span class="line">-rw-------. 1 root root 1172 4月  11 10:07 ca.crt</span><br><span class="line">-rw-------. 1 root root 4431 4月  11 10:08 joy01.crt</span><br><span class="line">-rw-------. 1 root root 1704 4月  11 10:08 joy01.key</span><br></pre></td></tr></table></figure>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h3><p>一切操作只需要在服务器，client不需要！！！</p>
<h4 id="开启转发"><a href="#开启转发" class="headerlink" title="开启转发"></a>开启转发</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;net.ipv4.ip_forward = 1&#x27; &gt;&gt; /etc/sysctl.conf</span><br></pre></td></tr></table></figure>
<p>验证</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>
<img src="https://img.mknight.cn/2018/1544336390853.png" width="262"/> 

<h4 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h4><p>清空防火墙</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">ipatbles -Z</span><br></pre></td></tr></table></figure>
<p>接下来的配置之前需要先了解以下概念：</p>
<ul>
<li><p>NAT 的原理 简单的说就是当内网主机访问外网时，当内网主机的数据包要通过路由器时，路由器将数据包中的源内网 IP 地址改为路由器上的公网 IP 地址，同时记录下该数据包的消息；当外网服务器响应这次由内而外发出的请求或数据交换时，当外网服务器发出的数据包经过路由器时，原本是路由器上的公网 IP 地址被路由器改为内网 IP 。</p>
<ul>
<li>SNAT是source networkaddress translation的缩写，即源地址目标转换。比如，多个PC机使用ADSL路由器共享上网，每个PC机都配置了内网IP，PC机访问外部网络的时候，路由器将数据包的报头中的源地址替换成路由器的ip，当外部网络的服务器比如网站web服务器接到访问请求的时候，他的日志记录下来的是路由器的ip地址，而不是pc机的内网ip，这是因为，这个服务器收到的数据包的报头里边的“源地址”，已经被替换了，所以叫做SNAT，基于源地址的地址转换。  </li>
<li>DNAT是destination networkaddress translation的缩写，即目标网络地址转换，典型的应用是，有个web服务器放在内网配置内网ip，前端有个防火墙配置公网ip，互联网上的访问者使用公网ip来访问这个网站，当访问的时候，客户端发出一个数据包，这个数据包的报头里边，目标地址写的是防火墙的公网ip，防火墙会把这个数据包的报头改写一次，将目标地址改写成web服务器的内网ip，然后再把这个数据包发送到内网的web服务器上，这样，数据包就穿透了防火墙，并从公网ip变成了一个对内网地址的访问了，即DNAT，基于目标的网络地址转换。</li>
<li>MASQUERADE，地址伪装，属于nat的一种。算是snat中的一种特例，可以实现自动化的snat。MASQUERADE是用发送数据的网卡上的IP来替换源IP，因此，对于那些IP不固定的场合，比如拨号网络或者通过dhcp分配IP的情况下，就得用MASQUERADE。</li>
</ul>
</li>
<li><p>如果内网主机访问外网而经过路由时，源 IP 会发生改变，这种变更行为就是 SNAT；反之，当外网的数据经过路由发往内网主机时，数据包中的目的 IP (路由器上的公网 IP) 将修改为内网 IP，这种变更行为就是 DNAT 。与 SNAT 和 DNAT所对应的两个链分别是  POSTROUTING和PREROUTING。</p>
<ul>
<li>POSTROUTING是源地址转换，要把你的内网地址转换成公网地址才能让你上网。</li>
<li>PREROUTING是目的地址转换，要把别人的公网IP换成你们内部的IP，才让访问到你们内部受防火墙保护的机器</li>
</ul>
</li>
</ul>
<p>综上所述，简单理解就是从服务器网卡获取当前IP来做SNAT。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">iptables -A FORWARD -s 172.16.0.0/24 -j ACCEPT  </span><br><span class="line">iptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT  </span><br><span class="line"></span><br><span class="line">#检查</span><br><span class="line">iptables  -t  nat  -nL</span><br><span class="line"></span><br><span class="line">#转发</span><br><span class="line">iptables -t nat -A POSTROUTING -s 172.16.0.0/24  -j MASQUERADE</span><br><span class="line">  or</span><br><span class="line">iptables -t nat -A POSTROUTING -s 172.16.0.0/24 -o eth0 -j MASQUERADE</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>检查FORWARD<br><img src="https://img.mknight.cn/2018/1544336486389.png" width="716"/></p>
<p>检查MASQUERADE<br><img src="https://img.mknight.cn/2018/1544336462517.png" width="480"/>  </p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><h4 id="server端"><a href="#server端" class="headerlink" title="server端"></a>server端</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">port 1194</span><br><span class="line">proto udp</span><br><span class="line">dev tun</span><br><span class="line">ca ca.crt</span><br><span class="line">cert server.crt</span><br><span class="line">key server.key</span><br><span class="line">dh dh.pem</span><br><span class="line">server 172.16.0.0 255.255.255.0</span><br><span class="line">ifconfig-pool-persist ipp.txt</span><br><span class="line">client-config-dir ccd</span><br><span class="line">push &quot;redirect-gateway def1 bypass-dhcp&quot;</span><br><span class="line">push &quot;dhcp-option DNS 208.67.222.222&quot;</span><br><span class="line">push &quot;dhcp-option DNS 208.67.220.220&quot;</span><br><span class="line">client-to-client</span><br><span class="line">duplicate-cn</span><br><span class="line">keepalive 10 120</span><br><span class="line"></span><br><span class="line">;cipher BF-CBC</span><br><span class="line">;cipher AES-128-CBC</span><br><span class="line">;cipher DES-EDE3-CBC</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">comp-lzo</span><br><span class="line">;max-clients 100</span><br><span class="line">log         openvpn.log</span><br><span class="line">status openvpn-status.log</span><br><span class="line">verb 3</span><br><span class="line">mute 20</span><br></pre></td></tr></table></figure>
<blockquote>
<p>“redirect-gateway def1 bypass-dhcp”的目的是在所有客戶端的默认网络都重定向到服务器,它的目的就是客户端在使用不同的私有地址时可以确保能连上OpenVPN服务器。<br>但是如果有时候客户端无法正常上网，那么就得换种方式。<code>push &quot;route 10.110.1.0 255.255.255.0&quot;</code>就像这样推送服务器的路由。  </p>
</blockquote>
<p>如果想使用固定IP，那么就开启<code>&quot;client-config-dir ccd&quot;</code></p>
<ul>
<li>在服务器端创建ccd目录</li>
<li>按照用户名创建文件，类似”ifconfig-push 10.8.0.18 255.255.255.0”</li>
</ul>
<h4 id="client端"><a href="#client端" class="headerlink" title="client端"></a>client端</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">client</span><br><span class="line">dev tun</span><br><span class="line">proto udp</span><br><span class="line">remote 服务器外网IP</span><br><span class="line">resolv-retry infinite</span><br><span class="line">nobind</span><br><span class="line">user nobody</span><br><span class="line">group nobody</span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line">ca ca.crt</span><br><span class="line">cert xiajie.crt</span><br><span class="line">key xiajie.key</span><br><span class="line">comp-lzo</span><br><span class="line">verb 3</span><br><span class="line">redirect-gateway def1</span><br></pre></td></tr></table></figure>

<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl -f enable openvpn@server</span><br><span class="line">systemctl start openvpn@server</span><br></pre></td></tr></table></figure>
<h2 id="服务检查"><a href="#服务检查" class="headerlink" title="服务检查"></a>服务检查</h2><h3 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h3><img src="https://img.mknight.cn/2018/1544337135904.png" width="668"/>
### 客户端（Windows）

<img src="https://img.mknight.cn/2018/1544337254592.png" width="642"/>


<h2 id="疑难杂症"><a href="#疑难杂症" class="headerlink" title="疑难杂症"></a>疑难杂症</h2><ul>
<li>客户端直接无法访问，虚拟IP不通，内网不通<br>检查服务器端配置文件<code>client-to-client</code></li>
<li>如果还是不通，或者无法访问外网，检查<code>push &quot;redirect-gateway def1 bypass-dhcp&quot;</code>是否注释或者有没有推送路由。  </li>
<li>如果追求速度就选择UDP，如果选择可靠质量就选择TCP。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/Rsync+Inotify%20%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Rsync+Inotify%20%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5.html" class="post-title-link" itemprop="url">Rsync+Inotify 实时同步</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-30 17:45:56" itemprop="dateCreated datePublished" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>需求：实时同步A机器文件到B机器</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A 192.168.1.225</span><br><span class="line">B 192.168.1.226</span><br></pre></td></tr></table></figure>

<h3 id="基本架构"><a href="#基本架构" class="headerlink" title="基本架构"></a>基本架构</h3><img src="https://img.mknight.cn/2018/1540378473281.png" width="924"/>

<h3 id="rsync"><a href="#rsync" class="headerlink" title="rsync"></a>rsync</h3><p>A</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install rsync</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后修改配置文件<br>&#x2F;etc&#x2F;rsyncd.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pid file = /var/run/rsync.pid</span><br><span class="line">log file = /var/log/rsync.log</span><br><span class="line">lock file=/var/run/rsync.lock</span><br><span class="line">secrets file = /etc/rsync.pwss</span><br><span class="line">transfer logging = yes</span><br><span class="line">address=192.168.1.226</span><br><span class="line">[data]</span><br><span class="line">path = /home/joy/imkefu/apache-tomcat-8.0.45/webapps/ROOT/WEB-INF/classes</span><br><span class="line">comment = data</span><br><span class="line">port = 873</span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line">timeout = 600</span><br><span class="line">max connections = 200</span><br><span class="line">use chroot = no</span><br><span class="line">read only = no</span><br><span class="line">hosts allow = 192.168.1.225</span><br></pre></td></tr></table></figure>
<p>设置验证文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#/etc/rsync.pass</span><br><span class="line">123456</span><br><span class="line"></span><br><span class="line">#chmod 600 /etc/rsync.pass</span><br></pre></td></tr></table></figure>
<p>启动服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start rsyncd</span><br></pre></td></tr></table></figure>

<p>B</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install rsync</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>设置验证文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#/etc/rsync.pass</span><br><span class="line">123456</span><br><span class="line"></span><br><span class="line">#chmod 600 /etc/rsync.pass</span><br></pre></td></tr></table></figure>
<h3 id="Inotify"><a href="#Inotify" class="headerlink" title="Inotify"></a>Inotify</h3><h4 id="安装inotify"><a href="#安装inotify" class="headerlink" title="安装inotify"></a>安装inotify</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/src</span><br><span class="line">wget http://github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz</span><br><span class="line">tar zxf inotify-tools-3.14.tar.gz</span><br><span class="line">cd inotify-tools-3.14</span><br><span class="line">./configure –prefix=/usr/local/inotify-3.14</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h4 id="同步脚本"><a href="#同步脚本" class="headerlink" title="同步脚本"></a>同步脚本</h4><p>A</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">#currentdate=`date +%Y%m%d%H%M`</span><br><span class="line"></span><br><span class="line">src=/home/joy/imkefu/apache-tomcat-8.0.45/webapps/ROOT/WEB-INF/classes/</span><br><span class="line">des=data</span><br><span class="line">user=root</span><br><span class="line">host=192.168.1.226</span><br><span class="line">/usr/local/inotify/bin/inotifywait -mrq --timefmt &#x27;%d/%m/%y %H:%M&#x27; --format &#x27;%T %w%f%e&#x27; -e modify,delete,create,attrib $src | while read files</span><br><span class="line">do</span><br><span class="line">/usr/bin/rsync -vzrtopg  --progress --delete --password-file=/etc/rsyncd.pass $src $user@$host::$des</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>然后执行该脚本。。。</p>
<h3 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h3><ul>
<li>可以先拿无关目录测试</li>
<li>检查pass文件权限必须是600</li>
<li>module名字必须保持一致</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/%20Linux%E7%A3%81%E7%9B%98%20LVM.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%20Linux%E7%A3%81%E7%9B%98%20LVM.html" class="post-title-link" itemprop="url">Linux磁盘 LVM</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-30 17:45:56" itemprop="dateCreated datePublished" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="GPT分区"><a href="#GPT分区" class="headerlink" title="GPT分区"></a>GPT分区</h2><h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><p>您的Linux实例上已经安装了parted工具和e2fsprogs工具。</p>
<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><p>运行命令parted &#x2F;dev&#x2F;vdd开始分区。<br>运行命令mklabel gpt，将默认的MBR分区格式转为GPT分区格式。<br>运行命令mkpart primary 1 100%，划分一个主分区，并设置分区的开始位置和结束位置。<br>运行命令align-check optimal 1检查分区是否对齐。</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ecshost~ ]# yum install -y parted</span><br><span class="line">[root@ecshost~ ]# yum install -y e2fsprogs</span><br></pre></td></tr></table></figure>

<img src="https://img.mknight.cn/medivh/1562063734050.png"  />

<img src="https://img.mknight.cn/medivh/1562063851890.png"  />


<h2 id="名词解释："><a href="#名词解释：" class="headerlink" title="名词解释："></a>名词解释：</h2><ul>
<li><p>PV（Phsical Volume，物理卷），PV是VG的组成部分，有分区构成，多块盘的时候，可以把一块盘格式化成一个主分区，然后用这个分区做成一个PV，只有一块盘的时候，可以这块盘的某一个分区做成一个PV，实际上一个PV就一个分区。</p>
</li>
<li><p>VG（Volume Group， 卷组），有若干个PV组成，作用就是将PV组成到以前，然后再重新划分空间。</p>
</li>
<li><p>LV（Logical Volume，逻辑卷），LV就是从VG中划分出来的卷，LV的使用要比PV灵活的多，可以在空间不够的情况下，增加空间。</p>
</li>
</ul>
<img src="https://img.mknight.cn/medivh/1560482143355.png"  />

<p>就像图中所示，三块物理磁盘组成物理卷工170G；然后三个pv组成一个VG为170G；最后从VG里面分出多个LV。其中VG可以当成一块大盘。</p>
<h2 id="实现LVM"><a href="#实现LVM" class="headerlink" title="实现LVM"></a>实现LVM</h2><p>针对于&#x2F;dev&#x2F;vdc磁盘为例<br>###1、格式化磁盘<br><img src="https://img.mknight.cn/medivh/1560484200006.png"  /><br><img src="https://img.mknight.cn/medivh/1560484253384.png"  /></p>
<p>###2、创建PV<br>命令“pvcreate ＋分区”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvcreate /dev/vdc1</span><br></pre></td></tr></table></figure>
<img src="https://img.mknight.cn/medivh/1560484437686.png"  />
###3、创建VG
命令“vgcreate ＋分区号＋分区号"
<img src="https://img.mknight.cn/medivh/1560484533113.png"  />
###4、创建lv
命令“lvcreate -L Size(要建的LV大小） -n LV名+VG名”，也可以用命令“lvdisplay和lvscan”来查看LV的详细信息
<img src="https://img.mknight.cn/medivh/1560491383392.png"  />

<h3 id="5、调整大小"><a href="#5、调整大小" class="headerlink" title="5、调整大小"></a>5、调整大小</h3><p>建立好lV后我们还可以通过命令“lvextend -L +Size（就是增加多少空间）＋LV的绝对路径”来增加LV的空间大小。也可以通过“lvreduce -L -Size（就是减小多少空间）＋LV的绝对路径”来减少LV的空间大小</p>
<h3 id="6、操作"><a href="#6、操作" class="headerlink" title="6、操作"></a>6、操作</h3><p>以上的PV、VG、LV、都可以通过“pvremove +分区号、vgremove +VG名称、lvremove +lv的绝对路径（如lvremove &#x2F;dev&#x2F;vg_liwei&#x2F;lv_liwei）”命令来删除。这里就不截图了。</p>
<h3 id="７、使用"><a href="#７、使用" class="headerlink" title="７、使用"></a>７、使用</h3><p>做完以上的这一切以后，通过命令“mkfs.ext3 +LV的路径”来格式化分区，然后进行挂载后就可以用了。</p>
<h2 id="LVM扩容"><a href="#LVM扩容" class="headerlink" title="LVM扩容"></a>LVM扩容</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pvcreate /dev/sdc  ##创建新PV</span><br><span class="line">vgextend centos /dev/sdc   ##将新的PV加入到现有的VG</span><br><span class="line">lvextend -l +2559  /dev/centos/root  ##LV扩容lvresize或者lvextend</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 scsi_host]# df -Th</span><br><span class="line">Filesystem              Type      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root xfs        17G   17G  152K 100% /</span><br><span class="line">##文件系统仍未扩容</span><br><span class="line">##需要扩容的是xfs，则需要xfs_growfs命令</span><br><span class="line">xfs_growfs /dev/centos/root   ##扩容xfs文件系统</span><br><span class="line">##如果是ext3,ext4等，需要使用resizefs命令</span><br><span class="line">##再次查看df</span><br><span class="line">[root@node1 scsi_host]# df -Th</span><br><span class="line">Filesystem              Type      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root xfs        27G   17G   10G  63% /</span><br><span class="line">##完成文件系统扩容</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/elasticsearch%E4%BD%BF%E7%94%A8%E7%BB%8F%E9%AA%8C.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/elasticsearch%E4%BD%BF%E7%94%A8%E7%BB%8F%E9%AA%8C.html" class="post-title-link" itemprop="url">elasticsearch使用经验</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-30 17:45:56" itemprop="dateCreated datePublished" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="设定副本和切片数量"><a href="#设定副本和切片数量" class="headerlink" title="设定副本和切片数量"></a>设定副本和切片数量</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">number_of_replicas 是数据备份数，如果只有一台机器，设置为0</span><br><span class="line">number_of_shards  是数据分片数，默认为5，有时候设置为3</span><br></pre></td></tr></table></figure>
<p>默认情况下每个索引都会生成5个切片，当然会占用大量磁盘空间。如果是对于安全性要求一般的情况下可以通过设置模板来改变数量。</p>
<h3 id="配置模板文件"><a href="#配置模板文件" class="headerlink" title="配置模板文件"></a>配置模板文件</h3><ul>
<li>index的名字必须要和指定的json文件中的templete名相匹配，定义的mapping才会生效。logstash的output配置的template_name名可以随便。</li>
<li>对于按照日期生成的规则解决办法，就是将template名末尾加一个*号通配符即可：<code> &quot;template&quot;:&quot;logstash-nginx_joy_app*&quot;</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/elk/logstash/config/es_nginx.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	&quot;template&quot;:&quot;logstash-nginx_joy_app*&quot;,</span><br><span class="line">	&quot;settings&quot;:</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;index.number_of_shards&quot;: 2,</span><br><span class="line">		&quot;number_of_replicas&quot;: 1</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="配置logstash文件"><a href="#配置logstash文件" class="headerlink" title="配置logstash文件"></a>配置logstash文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">output &#123;</span><br><span class="line">  if [fields][service] == &quot;nginx_joy_app&quot;&#123;</span><br><span class="line">    elasticsearch &#123;</span><br><span class="line">        hosts =&gt; [&quot;10.110.1.19:9200&quot;]</span><br><span class="line">        index =&gt; &quot;logstash-nginx_joy_app-%&#123;+YYYY.MM.dd.HH&#125;&quot;</span><br><span class="line">        document_type =&gt; &quot;logstash-nginx_joy_app&quot;</span><br><span class="line">		manage_template =&gt; true</span><br><span class="line">		template_overwrite =&gt; true</span><br><span class="line">		template_name =&gt; &quot;logstash-nginx_joy_app*&quot;</span><br><span class="line">		template =&gt; &quot;/usr/local/elk/logstash/config/es_nginx.json&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>这样就按照模板规则来生成对应索引了。<br><img src="https://img.mknight.cn/medivh/1562138906913.png"  /></p>
<h2 id="日常语法"><a href="#日常语法" class="headerlink" title="日常语法"></a>日常语法</h2><h3 id="按照字段搜索"><a href="#按照字段搜索" class="headerlink" title="按照字段搜索"></a>按照字段搜索</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字段名: 值</span><br></pre></td></tr></table></figure>
<img src="https://img.mknight.cn/medivh/1562139077948.png"  />

<h3 id="字符串查询"><a href="#字符串查询" class="headerlink" title="字符串查询"></a>字符串查询</h3><p>查询一个或者多个的短语</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;短语&quot;</span><br></pre></td></tr></table></figure>
<img src="https://img.mknight.cn/medivh/1562139426035.png"  />

<h3 id="正则查询"><a href="#正则查询" class="headerlink" title="正则查询"></a>正则查询</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">status: 50*</span><br></pre></td></tr></table></figure>
<img src="https://img.mknight.cn/medivh/1562139875229.png"  />

<h3 id="范围查询"><a href="#范围查询" class="headerlink" title="范围查询"></a>范围查询</h3><p>允许一个字段值在某个区间。[] 包含该值，{}不包含。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">status: &#123;200 TO *&#125;</span><br></pre></td></tr></table></figure>
<img src="https://img.mknight.cn/medivh/1562140194294.png"  />

<h3 id="布尔查询"><a href="#布尔查询" class="headerlink" title="布尔查询"></a>布尔查询</h3><p>布尔运算符（AND，OR，NOT）允许通过逻辑运算符组合多个子查询。</p>
<p>运算符AND&#x2F;OR&#x2F;NOT必须大写。</p>
<p>NOT type: mysql</p>
<p>mysql.method: SELECT AND mysql.size: [10000 TO *]</p>
<p>(mysql.method: INSERT OR mysql.method: UPDATE) AND responsetime: [30 TO *]</p>
<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><p>Logstash中的 logstash-filter-useragent 插件可以帮助我们过滤出浏览器版本、型号以及系统版本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if [user_ua] != &quot;-&quot; &#123;</span><br><span class="line">      useragent &#123;</span><br><span class="line">         target =&gt; &quot;agent&quot;   #agent将过来出的user agent的信息配置到了单独的字段中</span><br><span class="line">         source =&gt; &quot;user_ua&quot;   #这个表示对message里面的哪个字段进行分析</span><br><span class="line">       &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<h2 id="跨多个es节点的负载均衡"><a href="#跨多个es节点的负载均衡" class="headerlink" title="跨多个es节点的负载均衡"></a>跨多个es节点的负载均衡</h2><p>如果想使用kibana访问es集群，那么只需要按照如下操作即可：</p>
<ul>
<li>安装Elasticsearch</li>
<li>将节点配置为仅协调节点。在配置文件中配置：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">＃3。您希望此节点既不是主节点，也不是数据节点，也不是摄取节点，但是</span><br><span class="line">＃充当“搜索负载均衡器”（从节点获取数据，</span><br><span class="line">＃聚合结果等）</span><br><span class="line">＃</span><br><span class="line">node.master：false</span><br><span class="line">node.data：false</span><br><span class="line">node.ingest：false</span><br></pre></td></tr></table></figure></li>
<li>配置es节点加入集群<code>cluster.name:xxxx</code>，注意保持一致</li>
<li>将该节点启动后使用kibana调用当前es地址</li>
<li>kibana.yml 配置多个es地址：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">elasticsearch.hosts：</span><br><span class="line">  -  http：// elasticsearch1：9200</span><br><span class="line">  -  http：// elasticsearch2：9200</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/_search：所有索引，所有type下的所有数据都搜索出来</span><br><span class="line">/index1/_search：指定一个index，搜索其下所有type的数据</span><br><span class="line">/index1,index2/_search：同时搜索两个index下的数据</span><br><span class="line">/*1,*2/_search：按照通配符去匹配多个索引</span><br><span class="line">/index1/type1/_search：搜索一个index下指定的type的数据</span><br><span class="line">/index1/type1,type2/_search：可以搜索一个index下多个type的数据</span><br><span class="line">/index1,index2/type1,type2/_search：搜索多个index下的多个type的数据</span><br><span class="line">/_all/type1,type2/_search：_all，可以代表搜索所有index下的指定type的数据</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="时区问题"><a href="#时区问题" class="headerlink" title="时区问题"></a>时区问题</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line">  ruby &#123;</span><br><span class="line">       code =&gt; &quot;event.set(&#x27;index_day&#x27;, event.timestamp.time.localtime.strftime(&#x27;%Y.%m.%d.%H&#x27;))&quot;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  ....</span><br><span class="line">  index =&gt; &quot;logstash-nginx_joy_app-%&#123;index_day&#125;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="状态检查"><a href="#状态检查" class="headerlink" title="状态检查"></a>状态检查</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1. elasticsearch启动后查看是否启动成功：</span><br><span class="line">curl -XGET&quot;http://$(hostname):9200/_cluster/health?pretty=true&quot;</span><br><span class="line">2. 停止elasticsearch应用：</span><br><span class="line">curl -XPOST &quot;http:// $(hostname):9200/_shutdown&quot;</span><br><span class="line">3. 查看集群健康：</span><br><span class="line">curl $(hostname):9200/_cluster/health?pretty</span><br><span class="line">4. 检查集群状态：</span><br><span class="line">curl $(hostname):9200/_cluster/stats?pretty</span><br><span class="line">5. 节点状态：</span><br><span class="line">curl $(hostname):9200/_nodes/process?pretty</span><br><span class="line">curl $(hostname):9200/_nodes/node1/process?pretty</span><br><span class="line">6. 当你不知道有那些属性可以查看时：</span><br><span class="line">curl &#x27;$(hostname):9200/_cat/&#x27;，会返回可以查看的属性</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="磁盘扩容流程重启节点机器的流程"><a href="#磁盘扩容流程重启节点机器的流程" class="headerlink" title="磁盘扩容流程重启节点机器的流程"></a>磁盘扩容流程重启节点机器的流程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.data : /opt/data1,/opt/data2</span><br></pre></td></tr></table></figure>

<p>关闭自动平衡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -XPUT &quot;http://xxxx:9200/_cluster/settings&quot; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;transient&quot; : &#123; </span><br><span class="line">      &quot;cluster.routing.allocation.enable&quot; : &quot;none&quot; </span><br><span class="line">  &#125; </span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>重启节点</p>
<p>开启平衡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -XPUT &quot;http://xxxx.52:9200/_cluster/settings&quot; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;transient&quot;: &#123;</span><br><span class="line">    &quot;cluster.routing.allocation.enable&quot;: &quot;all&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/kibana%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E2%80%94%E2%80%94SearchGuard.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/kibana%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E2%80%94%E2%80%94SearchGuard.html" class="post-title-link" itemprop="url">kibana权限管理——SearchGuard</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-30 17:45:56" itemprop="dateCreated datePublished" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>首先根据es版本来选择search-guard,当前环境为5.4.1，因此选择对应版本。其他5.x参考 <a target="_blank" rel="noopener" href="https://docs.search-guard.com/v5/search-guard-versions">https://docs.search-guard.com/v5/search-guard-versions</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.search-guard.com/v5/search-guard-installation">https://docs.search-guard.com/v5/search-guard-installation</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[joy@es_a2_1_19 elasticsearch]$ bin/elasticsearch-plugin install -b  com.floragunn:search-guard-5:5.4.1-15</span><br><span class="line">-&gt; Downloading com.floragunn:search-guard-5:5.4.1-15 from maven central</span><br><span class="line">[=================================================] 100%</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">@     WARNING: plugin requires additional permissions     @</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">* java.io.FilePermission /proc/sys/net/core/somaxconn read</span><br><span class="line">* java.lang.RuntimePermission accessClassInPackage.sun.misc</span><br><span class="line">* java.lang.RuntimePermission accessClassInPackage.sun.nio.ch</span><br><span class="line">* java.lang.RuntimePermission accessClassInPackage.sun.security.x509</span><br><span class="line">* java.lang.RuntimePermission accessDeclaredMembers</span><br><span class="line">* java.lang.RuntimePermission getClassLoader</span><br><span class="line">* java.lang.RuntimePermission loadLibrary.*</span><br><span class="line">* java.lang.RuntimePermission setContextClassLoader</span><br><span class="line">* java.lang.RuntimePermission shutdownHooks</span><br><span class="line">* java.lang.reflect.ReflectPermission suppressAccessChecks</span><br><span class="line">* java.security.SecurityPermission getProperty.ssl.KeyManagerFactory.algorithm</span><br><span class="line">* java.security.SecurityPermission setProperty.ocsp.enable</span><br><span class="line">* java.util.PropertyPermission com.sun.security.enableCRLDP write</span><br><span class="line">* java.util.PropertyPermission es.set.netty.runtime.available.processors write</span><br><span class="line">* java.util.PropertyPermission java.security.debug write</span><br><span class="line">* java.util.PropertyPermission java.security.krb5.conf write</span><br><span class="line">* java.util.PropertyPermission javax.security.auth.useSubjectCredsOnly write</span><br><span class="line">* java.util.PropertyPermission sun.nio.ch.bugLevel write</span><br><span class="line">* java.util.PropertyPermission sun.security.krb5.debug write</span><br><span class="line">* java.util.PropertyPermission sun.security.spnego.debug write</span><br><span class="line">* javax.security.auth.AuthPermission doAs</span><br><span class="line">* javax.security.auth.AuthPermission modifyPrivateCredentials</span><br><span class="line">* javax.security.auth.kerberos.ServicePermission * accept</span><br><span class="line">See http://docs.oracle.com/javase/8/docs/technotes/guides/security/permissions.html</span><br><span class="line">for descriptions of what these permissions allow and the associated risks.</span><br><span class="line">-&gt; Installed search-guard-5</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[joy@es_a2_1_19 tools]$ sh install_demo_configuration.sh</span><br><span class="line">## Search Guard Demo Installer ##</span><br><span class="line">Warning: Do not use on production or public reachable systems</span><br><span class="line">Continue? [y/N] y</span><br><span class="line">Elasticsearch install type: .tar.gz</span><br><span class="line">Elasticsearch config dir: /home/joy/elasticsearch/config</span><br><span class="line">Detected Elasticsearch Version: 5.4.1</span><br><span class="line">Detected Search Guard Version: 5.4.1-15</span><br><span class="line"></span><br><span class="line">### Success</span><br><span class="line">### Execute this script now on all your nodes and then start all nodes</span><br><span class="line">### After the whole cluster is up execute:</span><br><span class="line">/home/joy/elasticsearch/plugins/search-guard-5/tools/sgadmin.sh -cd /home/joy/elasticsearch/plugins/search-guard-5/sgconfig -cn searchguard_demo -ks /home/joy/elasticsearch/config/kirk.jks -ts /home/joy/elasticsearch/config/truststore.jks -nhnv</span><br><span class="line">### or run ./sgadmin_demo.sh</span><br><span class="line">### Then open https://localhost:9200 an login with admin/admin</span><br><span class="line">### (Just ignore the ssl certificate warning because we installed a self signed demo certificate)</span><br></pre></td></tr></table></figure>
<p>elasticsearch.yml将会自动增加下列内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">######## Start Search Guard Demo Configuration ########</span><br><span class="line">searchguard.ssl.transport.keystore_filepath: keystore.jks</span><br><span class="line">searchguard.ssl.transport.truststore_filepath: truststore.jks</span><br><span class="line">searchguard.ssl.transport.enforce_hostname_verification: false</span><br><span class="line">searchguard.ssl.http.enabled: true</span><br><span class="line">searchguard.ssl.http.keystore_filepath: keystore.jks</span><br><span class="line">searchguard.ssl.http.truststore_filepath: truststore.jks</span><br><span class="line">searchguard.authcz.admin_dn:</span><br><span class="line">  - CN=kirk,OU=client,O=client,L=test, C=de</span><br><span class="line"></span><br><span class="line">cluster.name: searchguard_demo</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">######## End Search Guard Demo Configuration ########</span><br></pre></td></tr></table></figure>

<p>但是最终还是失败了，以后再看</p>
<p><a target="_blank" rel="noopener" href="https://my.oschina.net/huangweibin/blog/820858">https://my.oschina.net/huangweibin/blog/820858</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/marility/p/9392645.html">https://www.cnblogs.com/marility/p/9392645.html</a><br><a target="_blank" rel="noopener" href="http://xiaoqiangge.com/aritcle/1536058241842.html">http://xiaoqiangge.com/aritcle/1536058241842.html</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/sinat_39562444/article/details/88235809">https://blog.csdn.net/sinat_39562444&#x2F;article&#x2F;details&#x2F;88235809</a></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://github.com/floragunncom/search-guard">https://github.com/floragunncom/search-guard</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://econow.cn/PPTP-VPN%20%E4%BD%BF%E7%94%A8.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="medivh">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Medivh's castle">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Medivh's castle">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/PPTP-VPN%20%E4%BD%BF%E7%94%A8.html" class="post-title-link" itemprop="url">远程办公工具配置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-30 17:45:56" itemprop="dateCreated datePublished" datetime="2023-10-30T17:45:56+08:00">2023-10-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>公司内网环境VPN有两种连接方式，PPTP和L2TP。其中PPTP连接较为简单，L2TP作为备用方式（OS X 系统只支持L2TP）</p>
</blockquote>
<h2 id="PPTP"><a href="#PPTP" class="headerlink" title="PPTP"></a>PPTP</h2><p>推荐使用该方式，操作简单</p>
<h3 id="Mac"><a href="#Mac" class="headerlink" title="Mac"></a>Mac</h3><p>1 网络-》增加</p>
<img src="https://img.mknight.cn/medivh/1553150666742.png" />


<p>2 选择VPN类型</p>
<img src="https://img.mknight.cn/medivh/1553150619851.png" />

<p>3 填写信息<br><img src="https://img.mknight.cn/medivh/1555220994661.png"  /></p>
<p>4 点击应用，选择存储配置<br><img src="https://img.mknight.cn/medivh/1553150821150.png" /></p>
<p>5 点击连接</p>
<p>6 输入密码即可<br><img src="https://img.mknight.cn/medivh/1553150930004.png" /></p>
<p>7 正常状态</p>
<img src="https://img.mknight.cn/medivh/1555220885060.png"  />


<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>1 新建连接<br><img src="https://img.mknight.cn/medivh/1553151087777.png" /><br>2 选择连接到工作区<br><img src="https://img.mknight.cn/medivh/1553151118428.png" /><br>3 选择第一种<br><img src="https://img.mknight.cn/medivh/1553151166006.png" /><br>4 填写IP地址，点击创建<br><img src="https://img.mknight.cn/medivh/1555220947107.png"  /></p>
<p>5 连接</p>
<img src="https://img.mknight.cn/medivh/1553151257736.png" />

<p>6 输入用户名和密码<br><img src="https://img.mknight.cn/medivh/1553151297480.png" /></p>
<p>7 如果顺利，就会提示已连接<br><img src="https://img.mknight.cn/medivh/1553151325810.png" /></p>
<h2 id="L2TP"><a href="#L2TP" class="headerlink" title="L2TP"></a>L2TP</h2><p>对于一些新款设备只支持该方式。</p>
<h3 id="Mac-1"><a href="#Mac-1" class="headerlink" title="Mac"></a>Mac</h3><p>对于windows系统来说可以直接配置，不需要修改一下文件。<br>准备工作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/ppp/options</span><br><span class="line"></span><br><span class="line">#在options文件中输入：</span><br><span class="line"></span><br><span class="line">plugin L2TP.ppp</span><br><span class="line">l2tpnoipsec</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1、新建<br><img src="https://img.mknight.cn/medivh/1555221072317.png"  /></p>
<p>2、填写信息<br><img src="https://img.mknight.cn/medivh/1555221109294.png"  /></p>
<p>3、密码<br>该部分分为用户密码和共享密钥(123456)<br><img src="https://img.mknight.cn/medivh/1555221192662.png"  /></p>
<p>4、连接</p>
<img src="https://img.mknight.cn/medivh/1555221249767.png"  />


<p>5、如果出现一下情况，请检查前面的修改配置文件。<br><img src="https://img.mknight.cn/medivh/1555221742632.png"  /></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备17063827号-2 </a>
      <img src="https://beian.miit.gov.cn/#/Integrated/index" alt="">
  </div>
  <div class="copyright">
    &copy; 2017 – 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">medivh</span>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
